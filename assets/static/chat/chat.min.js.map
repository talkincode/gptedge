{"version":3,"file":"chat.min.js","sources":["../node_modules/webix-jet/dist/es6/jet.js","../node_modules/@xbs/jet-helpers/rLayout.js","../node_modules/@xbs/jet-helpers/jetWin.js","../node_modules/jet-restate/index.js","../sources/libs/rtc.js","../sources/libs/phone.js","../sources/views/call/panel.js","../sources/views/chat/common/form.js","../sources/helpers/customcheckbox.js","../sources/helpers/icons.js","../sources/views/chat/common/people.js","../sources/views/chat/common/toolbar.js","../sources/views/chat/common/window.js","../sources/views/chat/info/form.js","../sources/views/chat/info/index.js","../sources/views/chat/info/info.js","../sources/views/chat/info/people.js","../sources/views/chat/members/index.js","../sources/views/chat/new/form.js","../sources/views/chat/new/index.js","../sources/views/list.js","../sources/views/chats.js","../sources/helpers/search.js","../sources/views/sidebar.js","../sources/views/compact/sidemenu.js","../sources/views/messages/emojis.js","../sources/views/messages/emojisuggest.js","../sources/views/messages/toolbar.js","../sources/helpers/chatcomments.js","../sources/views/messages/index.js","../sources/views/top.js","../sources/views/users.js","../sources/export_views.js","../sources/models/Local.js","../node_modules/remote-client/dist/remote.es6.js","../sources/models/Backend.js","../sources/models/Operations.js","../sources/models/Upload.js","../sources/models/Helpers.js","../sources/helpers/emojis.js","../sources/models/Emojis.js","../sources/app.js","../sources/locales/en.js"],"sourcesContent":["class NavigationBlocked {\r\n}\n\nclass JetBase {\r\n    constructor(webix, config) {\r\n        this.webixJet = true;\r\n        this.webix = webix;\r\n        this._events = [];\r\n        this._subs = {};\r\n        this._data = {};\r\n        if (config && config.params)\r\n            webix.extend(this._data, config.params);\r\n    }\r\n    getRoot() {\r\n        return this._root;\r\n    }\r\n    destructor() {\r\n        this._detachEvents();\r\n        this._destroySubs();\r\n        this._events = this._container = this.app = this._parent = this._root = null;\r\n    }\r\n    setParam(id, value, url) {\r\n        if (this._data[id] !== value) {\r\n            this._data[id] = value;\r\n            this._segment.update(id, value, 0);\r\n            if (url) {\r\n                return this.show(null);\r\n            }\r\n        }\r\n    }\r\n    getParam(id, parent) {\r\n        const value = this._data[id];\r\n        if (typeof value !== \"undefined\" || !parent) {\r\n            return value;\r\n        }\r\n        const view = this.getParentView();\r\n        if (view) {\r\n            return view.getParam(id, parent);\r\n        }\r\n    }\r\n    getUrl() {\r\n        return this._segment.suburl();\r\n    }\r\n    getUrlString() {\r\n        return this._segment.toString();\r\n    }\r\n    getParentView() {\r\n        return this._parent;\r\n    }\r\n    $$(id) {\r\n        if (typeof id === \"string\") {\r\n            const root = this.getRoot();\r\n            return root.queryView((obj => (obj.config.id === id || obj.config.localId === id) &&\r\n                (obj.$scope === root.$scope)), \"self\");\r\n        }\r\n        else {\r\n            return id;\r\n        }\r\n    }\r\n    on(obj, name, code) {\r\n        const id = obj.attachEvent(name, code);\r\n        this._events.push({ obj, id });\r\n        return id;\r\n    }\r\n    contains(view) {\r\n        for (const key in this._subs) {\r\n            const kid = this._subs[key].view;\r\n            if (kid === view || kid.contains(view)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    getSubView(name) {\r\n        const sub = this.getSubViewInfo(name);\r\n        if (sub) {\r\n            return sub.subview.view;\r\n        }\r\n    }\r\n    getSubViewInfo(name) {\r\n        const sub = this._subs[name || \"default\"];\r\n        if (sub) {\r\n            return { subview: sub, parent: this };\r\n        }\r\n        if (name === \"_top\") {\r\n            this._subs[name] = { url: \"\", id: null, popup: true };\r\n            return this.getSubViewInfo(name);\r\n        }\r\n        // when called from a child view, searches for nearest parent with subview\r\n        if (this._parent) {\r\n            return this._parent.getSubViewInfo(name);\r\n        }\r\n        return null;\r\n    }\r\n    _detachEvents() {\r\n        const events = this._events;\r\n        for (let i = events.length - 1; i >= 0; i--) {\r\n            events[i].obj.detachEvent(events[i].id);\r\n        }\r\n    }\r\n    _destroySubs() {\r\n        // destroy sub views\r\n        for (const key in this._subs) {\r\n            const subView = this._subs[key].view;\r\n            // it possible that subview was not loaded with any content yet\r\n            // so check on null\r\n            if (subView) {\r\n                subView.destructor();\r\n            }\r\n        }\r\n        // reset to prevent memory leaks\r\n        this._subs = {};\r\n    }\r\n    _init_url_data() {\r\n        const url = this._segment.current();\r\n        this._data = {};\r\n        this.webix.extend(this._data, url.params, true);\r\n    }\r\n    _getDefaultSub() {\r\n        if (this._subs.default) {\r\n            return this._subs.default;\r\n        }\r\n        for (const key in this._subs) {\r\n            const sub = this._subs[key];\r\n            if (!sub.branch && sub.view && key !== \"_top\") {\r\n                const child = sub.view._getDefaultSub();\r\n                if (child) {\r\n                    return child;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    _routed_view() {\r\n        const parent = this.getParentView();\r\n        if (!parent) {\r\n            return true;\r\n        }\r\n        const sub = parent._getDefaultSub();\r\n        if (!sub && sub !== this) {\r\n            return false;\r\n        }\r\n        return parent._routed_view();\r\n    }\r\n}\n\nfunction parse(url) {\r\n    // remove starting /\r\n    if (url[0] === \"/\") {\r\n        url = url.substr(1);\r\n    }\r\n    // split url by \"/\"\r\n    const parts = url.split(\"/\");\r\n    const chunks = [];\r\n    // for each page in url\r\n    for (let i = 0; i < parts.length; i++) {\r\n        const test = parts[i];\r\n        const result = {};\r\n        // detect params\r\n        // support old \t\t\tsome:a=b:c=d\r\n        // and new notation\t\tsome?a=b&c=d\r\n        let pos = test.indexOf(\":\");\r\n        if (pos === -1) {\r\n            pos = test.indexOf(\"?\");\r\n        }\r\n        if (pos !== -1) {\r\n            const params = test.substr(pos + 1).split(/[\\:\\?\\&]/g);\r\n            // create hash of named params\r\n            for (const param of params) {\r\n                const dchunk = param.split(\"=\");\r\n                result[dchunk[0]] = decodeURIComponent(dchunk[1]);\r\n            }\r\n        }\r\n        // store parsed values\r\n        chunks[i] = {\r\n            page: (pos > -1 ? test.substr(0, pos) : test),\r\n            params: result,\r\n            isNew: true\r\n        };\r\n    }\r\n    // return array of page objects\r\n    return chunks;\r\n}\r\nfunction url2str(stack) {\r\n    const url = [];\r\n    for (const chunk of stack) {\r\n        url.push(\"/\" + chunk.page);\r\n        const params = obj2str(chunk.params);\r\n        if (params) {\r\n            url.push(\"?\" + params);\r\n        }\r\n    }\r\n    return url.join(\"\");\r\n}\r\nfunction obj2str(obj) {\r\n    const str = [];\r\n    for (const key in obj) {\r\n        if (typeof obj[key] === \"object\")\r\n            continue;\r\n        if (str.length) {\r\n            str.push(\"&\");\r\n        }\r\n        str.push(key + \"=\" + encodeURIComponent(obj[key]));\r\n    }\r\n    return str.join(\"\");\r\n}\n\nclass Route {\r\n    constructor(route, index) {\r\n        this._next = 1;\r\n        if (typeof route === \"string\") {\r\n            this.route = {\r\n                url: parse(route),\r\n                path: route\r\n            };\r\n        }\r\n        else {\r\n            this.route = route;\r\n        }\r\n        this.index = index;\r\n    }\r\n    current() {\r\n        return this.route.url[this.index];\r\n    }\r\n    next() {\r\n        return this.route.url[this.index + this._next];\r\n    }\r\n    suburl() {\r\n        return this.route.url.slice(this.index);\r\n    }\r\n    shift(params) {\r\n        const route = new Route(this.route, this.index + this._next);\r\n        route.setParams(route.route.url, params, route.index);\r\n        return route;\r\n    }\r\n    setParams(url, params, index) {\r\n        if (params) {\r\n            const old = url[index].params;\r\n            for (var key in params)\r\n                old[key] = params[key];\r\n        }\r\n    }\r\n    refresh() {\r\n        const url = this.route.url;\r\n        for (let i = this.index + 1; i < url.length; i++) {\r\n            url[i].isNew = true;\r\n        }\r\n    }\r\n    toString() {\r\n        const str = url2str(this.suburl());\r\n        return str ? str.substr(1) : \"\";\r\n    }\r\n    _join(path, kids) {\r\n        let url = this.route.url;\r\n        if (path === null) { // change of parameters, route elements are not affected\r\n            return url;\r\n        }\r\n        const old = this.route.url;\r\n        let reset = true;\r\n        url = old.slice(0, this.index + (kids ? this._next : 0));\r\n        if (path) {\r\n            url = url.concat(parse(path));\r\n            for (let i = 0; i < url.length; i++) {\r\n                if (old[i]) {\r\n                    url[i].view = old[i].view;\r\n                }\r\n                if (reset && old[i] && url[i].page === old[i].page) {\r\n                    url[i].isNew = false;\r\n                }\r\n                else if (url[i].isNew) {\r\n                    // if some segment was marked as new, all subsegments must be updated as well\r\n                    reset = false;\r\n                }\r\n            }\r\n        }\r\n        return url;\r\n    }\r\n    append(path) {\r\n        const url = this._join(path, true);\r\n        this.route.path = url2str(url);\r\n        this.route.url = url;\r\n        return this.route.path;\r\n    }\r\n    show(path, view, kids) {\r\n        const url = this._join(path.url, kids);\r\n        this.setParams(url, path.params, this.index + (kids ? this._next : 0));\r\n        return new Promise((res, rej) => {\r\n            const redirect = url2str(url);\r\n            const obj = {\r\n                url,\r\n                redirect,\r\n                confirm: Promise.resolve()\r\n            };\r\n            const app = view ? view.app : null;\r\n            // when creating a new route, it possible that it will not have any content\r\n            // guard is not necessary in such case\r\n            if (app) {\r\n                const result = app.callEvent(\"app:guard\", [obj.redirect, view, obj]);\r\n                if (!result) {\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n            }\r\n            obj.confirm.catch(err => rej(err)).then(() => {\r\n                if (obj.redirect === null) {\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n                if (obj.redirect !== redirect) {\r\n                    app.show(obj.redirect);\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n                this.route.path = redirect;\r\n                this.route.url = url;\r\n                res();\r\n            });\r\n        });\r\n    }\r\n    size(n) {\r\n        this._next = n;\r\n    }\r\n    split() {\r\n        const route = {\r\n            url: this.route.url.slice(this.index + 1),\r\n            path: \"\"\r\n        };\r\n        if (route.url.length) {\r\n            route.path = url2str(route.url);\r\n        }\r\n        return new Route(route, 0);\r\n    }\r\n    update(name, value, index) {\r\n        const chunk = this.route.url[this.index + (index || 0)];\r\n        if (!chunk) {\r\n            this.route.url.push({ page: \"\", params: {} });\r\n            return this.update(name, value, index);\r\n        }\r\n        if (name === \"\") {\r\n            chunk.page = value;\r\n        }\r\n        else {\r\n            chunk.params[name] = value;\r\n        }\r\n        this.route.path = url2str(this.route.url);\r\n    }\r\n}\n\nclass JetView extends JetBase {\r\n    constructor(app, config) {\r\n        super(app.webix);\r\n        this.app = app;\r\n        //this.$config = config;\r\n        this._children = [];\r\n    }\r\n    ui(ui, config) {\r\n        config = config || {};\r\n        const container = config.container || ui.container;\r\n        const jetview = this.app.createView(ui);\r\n        this._children.push(jetview);\r\n        jetview.render(container, this._segment, this);\r\n        if (typeof ui !== \"object\" || (ui instanceof JetBase)) {\r\n            // raw webix UI\r\n            return jetview;\r\n        }\r\n        else {\r\n            return jetview.getRoot();\r\n        }\r\n    }\r\n    show(path, config) {\r\n        config = config || {};\r\n        // convert parameters object to url\r\n        if (typeof path === \"object\") {\r\n            for (const key in path) {\r\n                this.setParam(key, path[key]);\r\n            }\r\n            path = null;\r\n        }\r\n        else {\r\n            // deligate to app in case of root prefix\r\n            if (path.substr(0, 1) === \"/\") {\r\n                return this.app.show(path, config);\r\n            }\r\n            // local path, do nothing\r\n            if (path.indexOf(\"./\") === 0) {\r\n                path = path.substr(2);\r\n            }\r\n            // parent path, call parent view\r\n            if (path.indexOf(\"../\") === 0) {\r\n                const parent = this.getParentView();\r\n                if (parent) {\r\n                    return parent.show(path.substr(3), config);\r\n                }\r\n                else {\r\n                    return this.app.show(\"/\" + path.substr(3));\r\n                }\r\n            }\r\n            const sub = this.getSubViewInfo(config.target);\r\n            if (sub) {\r\n                if (sub.parent !== this) {\r\n                    return sub.parent.show(path, config);\r\n                }\r\n                else if (config.target && config.target !== \"default\") {\r\n                    return this._renderFrameLock(config.target, sub.subview, {\r\n                        url: path,\r\n                        params: config.params,\r\n                    });\r\n                }\r\n            }\r\n            else {\r\n                if (path) {\r\n                    return this.app.show(\"/\" + path, config);\r\n                }\r\n            }\r\n        }\r\n        return this._show(this._segment, { url: path, params: config.params }, this);\r\n    }\r\n    _show(segment, path, view) {\r\n        return segment.show(path, view, true).then(() => {\r\n            this._init_url_data();\r\n            return this._urlChange();\r\n        }).then(() => {\r\n            if (segment.route.linkRouter) {\r\n                this.app.getRouter().set(segment.route.path, { silent: true });\r\n                this.app.callEvent(\"app:route\", [segment.route.path]);\r\n            }\r\n        });\r\n    }\r\n    init(_$view, _$) {\r\n        // stub\r\n    }\r\n    ready(_$view, _$url) {\r\n        // stub\r\n    }\r\n    config() {\r\n        this.app.webix.message(\"View:Config is not implemented\");\r\n    }\r\n    urlChange(_$view, _$url) {\r\n        // stub\r\n    }\r\n    destroy() {\r\n        // stub\r\n    }\r\n    destructor() {\r\n        this.destroy();\r\n        this._destroyKids();\r\n        // destroy actual UI\r\n        if (this._root) {\r\n            this._root.destructor();\r\n            super.destructor();\r\n        }\r\n    }\r\n    use(plugin, config) {\r\n        plugin(this.app, this, config);\r\n    }\r\n    refresh() {\r\n        const url = this.getUrl();\r\n        this.destroy();\r\n        this._destroyKids();\r\n        this._destroySubs();\r\n        this._detachEvents();\r\n        if (this._container.tagName) {\r\n            this._root.destructor();\r\n        }\r\n        this._segment.refresh();\r\n        return this._render(this._segment);\r\n    }\r\n    render(root, url, parent) {\r\n        if (typeof url === \"string\") {\r\n            url = new Route(url, 0);\r\n        }\r\n        this._segment = url;\r\n        this._parent = parent;\r\n        this._init_url_data();\r\n        root = root || document.body;\r\n        const _container = (typeof root === \"string\") ? this.webix.toNode(root) : root;\r\n        if (this._container !== _container) {\r\n            this._container = _container;\r\n            return this._render(url);\r\n        }\r\n        else {\r\n            return this._urlChange().then(() => this.getRoot());\r\n        }\r\n    }\r\n    _render(url) {\r\n        const config = this.config();\r\n        if (config.then) {\r\n            return config.then(cfg => this._render_final(cfg, url));\r\n        }\r\n        else {\r\n            return this._render_final(config, url);\r\n        }\r\n    }\r\n    _render_final(config, url) {\r\n        // get previous view in the same slot\r\n        let slot = null;\r\n        let container = null;\r\n        let show = false;\r\n        if (!this._container.tagName) {\r\n            slot = this._container;\r\n            if (slot.popup) {\r\n                container = document.body;\r\n                show = true;\r\n            }\r\n            else {\r\n                container = this.webix.$$(slot.id);\r\n            }\r\n        }\r\n        else {\r\n            container = this._container;\r\n        }\r\n        // view already destroyed\r\n        if (!this.app || !container) {\r\n            return Promise.reject(null);\r\n        }\r\n        let response;\r\n        const current = this._segment.current();\r\n        // using wrapper object, so ui can be changed from app:render event\r\n        const result = { ui: {} };\r\n        this.app.copyConfig(config, result.ui, this._subs);\r\n        this.app.callEvent(\"app:render\", [this, url, result]);\r\n        result.ui.$scope = this;\r\n        /* destroy old HTML attached views before creating new one */\r\n        if (!slot && current.isNew && current.view) {\r\n            current.view.destructor();\r\n        }\r\n        try {\r\n            // special handling for adding inside of multiview - preserve old id\r\n            if (slot && !show) {\r\n                const oldui = container;\r\n                const parent = oldui.getParentView();\r\n                if (parent && parent.name === \"multiview\" && !result.ui.id) {\r\n                    result.ui.id = oldui.config.id;\r\n                }\r\n            }\r\n            this._root = this.app.webix.ui(result.ui, container);\r\n            const asWin = this._root;\r\n            // check for url added to ignore this.ui calls\r\n            if (show && asWin.setPosition && !asWin.isVisible()) {\r\n                asWin.show();\r\n            }\r\n            // check, if we are replacing some older view\r\n            if (slot) {\r\n                if (slot.view && slot.view !== this && slot.view !== this.app) {\r\n                    slot.view.destructor();\r\n                }\r\n                slot.id = this._root.config.id;\r\n                if (this.getParentView() || !this.app.app)\r\n                    slot.view = this;\r\n                else {\r\n                    // when we have subapp, set whole app as a view\r\n                    // so on destruction, the whole app will be destroyed\r\n                    slot.view = this.app;\r\n                }\r\n            }\r\n            if (current.isNew) {\r\n                current.view = this;\r\n                current.isNew = false;\r\n            }\r\n            response = Promise.resolve(this._init(this._root, url)).then(() => {\r\n                return this._urlChange().then(() => {\r\n                    this._initUrl = null;\r\n                    return this.ready(this._root, url.suburl());\r\n                });\r\n            });\r\n        }\r\n        catch (e) {\r\n            response = Promise.reject(e);\r\n        }\r\n        return response.catch(err => this._initError(this, err));\r\n    }\r\n    _init(view, url) {\r\n        return this.init(view, url.suburl());\r\n    }\r\n    _urlChange() {\r\n        this.app.callEvent(\"app:urlchange\", [this, this._segment]);\r\n        const waits = [];\r\n        for (const key in this._subs) {\r\n            const frame = this._subs[key];\r\n            const wait = this._renderFrameLock(key, frame, null);\r\n            if (wait) {\r\n                waits.push(wait);\r\n            }\r\n        }\r\n        return Promise.all(waits).then(() => {\r\n            return this.urlChange(this._root, this._segment.suburl());\r\n        });\r\n    }\r\n    _renderFrameLock(key, frame, path) {\r\n        // if subview is not occupied by some rendering yet\r\n        if (!frame.lock) {\r\n            // retreive and store rendering end promise\r\n            const lock = this._renderFrame(key, frame, path);\r\n            if (lock) {\r\n                // clear lock after frame rendering\r\n                // as promise.finally is not supported by  Webix lesser than 6.2\r\n                // using a more verbose notation\r\n                frame.lock = lock.then(() => frame.lock = null, () => frame.lock = null);\r\n            }\r\n        }\r\n        // return rendering end promise\r\n        return frame.lock;\r\n    }\r\n    _renderFrame(key, frame, path) {\r\n        //default route\r\n        if (key === \"default\") {\r\n            if (this._segment.next()) {\r\n                // we have a next segment in url, render it\r\n                let params = path ? path.params : null;\r\n                if (frame.params) {\r\n                    params = this.webix.extend(params || {}, frame.params);\r\n                }\r\n                return this._createSubView(frame, this._segment.shift(params));\r\n            }\r\n            else if (frame.view && frame.popup) {\r\n                // there is no next segment, delete the existing sub-view\r\n                frame.view.destructor();\r\n                frame.view = null;\r\n            }\r\n        }\r\n        //if new path provided, set it to the frame\r\n        if (path !== null) {\r\n            frame.url = path.url;\r\n            if (frame.params) {\r\n                path.params = this.webix.extend(path.params || {}, frame.params);\r\n            }\r\n        }\r\n        // in case of routed sub-view\r\n        if (frame.route) {\r\n            // we have a new path for sub-view\r\n            if (path !== null) {\r\n                return frame.route.show(path, frame.view).then(() => {\r\n                    return this._createSubView(frame, frame.route);\r\n                });\r\n            }\r\n            // do not trigger onChange for isolated sub-views\r\n            if (frame.branch) {\r\n                return;\r\n            }\r\n        }\r\n        let view = frame.view;\r\n        // if view doesn't exists yet, init it\r\n        if (!view && frame.url) {\r\n            if (typeof frame.url === \"string\") {\r\n                // string, so we have isolated subview url\r\n                frame.route = new Route(frame.url, 0);\r\n                if (path)\r\n                    frame.route.setParams(frame.route.route.url, path.params, 0);\r\n                if (frame.params)\r\n                    frame.route.setParams(frame.route.route.url, frame.params, 0);\r\n                return this._createSubView(frame, frame.route);\r\n            }\r\n            else {\r\n                // object, so we have an embeded subview\r\n                if (typeof frame.url === \"function\" && !(view instanceof frame.url)) {\r\n                    view = new (this.app._override(frame.url))(this.app, \"\");\r\n                }\r\n                if (!view) {\r\n                    view = frame.url;\r\n                }\r\n            }\r\n        }\r\n        // trigger onChange for already existed view\r\n        if (view) {\r\n            return view.render(frame, (frame.route || this._segment), this);\r\n        }\r\n    }\r\n    _initError(view, err) {\r\n        /*\r\n            if view is destroyed, ignore any view related errors\r\n        */\r\n        if (this.app) {\r\n            this.app.error(\"app:error:initview\", [err, view]);\r\n        }\r\n        return true;\r\n    }\r\n    _createSubView(sub, suburl) {\r\n        return this.app.createFromURL(suburl.current()).then(view => {\r\n            return view.render(sub, suburl, this);\r\n        });\r\n    }\r\n    _destroyKids() {\r\n        // destroy child views\r\n        const uis = this._children;\r\n        for (let i = uis.length - 1; i >= 0; i--) {\r\n            if (uis[i] && uis[i].destructor) {\r\n                uis[i].destructor();\r\n            }\r\n        }\r\n        // reset vars for better GC processing\r\n        this._children = [];\r\n    }\r\n}\n\n// wrapper for raw objects and Jet 1.x structs\r\nclass JetViewRaw extends JetView {\r\n    constructor(app, config) {\r\n        super(app, config);\r\n        this._ui = config.ui;\r\n    }\r\n    config() {\r\n        return this._ui;\r\n    }\r\n}\n\nclass SubRouter {\r\n    constructor(cb, config, app) {\r\n        this.path = \"\";\r\n        this.app = app;\r\n    }\r\n    set(path, config) {\r\n        this.path = path;\r\n        const a = this.app;\r\n        a.app.getRouter().set(a._segment.append(this.path), { silent: true });\r\n    }\r\n    get() {\r\n        return this.path;\r\n    }\r\n}\n\nlet _once = true;\r\nclass JetAppBase extends JetBase {\r\n    constructor(config) {\r\n        const webix = (config || {}).webix || window.webix;\r\n        config = webix.extend({\r\n            name: \"App\",\r\n            version: \"1.0\",\r\n            start: \"/home\"\r\n        }, config, true);\r\n        super(webix, config);\r\n        this.config = config;\r\n        this.app = this.config.app;\r\n        this.ready = Promise.resolve();\r\n        this._services = {};\r\n        this.webix.extend(this, this.webix.EventSystem);\r\n    }\r\n    getUrl() {\r\n        return this._subSegment.suburl();\r\n    }\r\n    getUrlString() {\r\n        return this._subSegment.toString();\r\n    }\r\n    getService(name) {\r\n        let obj = this._services[name];\r\n        if (typeof obj === \"function\") {\r\n            obj = this._services[name] = obj(this);\r\n        }\r\n        return obj;\r\n    }\r\n    setService(name, handler) {\r\n        this._services[name] = handler;\r\n    }\r\n    destructor() {\r\n        this.getSubView().destructor();\r\n        super.destructor();\r\n    }\r\n    // copy object and collect extra handlers\r\n    copyConfig(obj, target, config) {\r\n        // raw ui config\r\n        if (obj instanceof JetBase ||\r\n            (typeof obj === \"function\" && obj.prototype instanceof JetBase)) {\r\n            obj = { $subview: obj };\r\n        }\r\n        // subview placeholder\r\n        if (typeof obj.$subview != \"undefined\") {\r\n            return this.addSubView(obj, target, config);\r\n        }\r\n        // process sub-properties\r\n        const isArray = obj instanceof Array;\r\n        target = target || (isArray ? [] : {});\r\n        for (const method in obj) {\r\n            let point = obj[method];\r\n            // view class\r\n            if (typeof point === \"function\" && point.prototype instanceof JetBase) {\r\n                point = { $subview: point };\r\n            }\r\n            if (point && typeof point === \"object\" &&\r\n                !(point instanceof this.webix.DataCollection) && !(point instanceof RegExp) && !(point instanceof Map)) {\r\n                if (point instanceof Date) {\r\n                    target[method] = new Date(point);\r\n                }\r\n                else {\r\n                    const copy = this.copyConfig(point, (point instanceof Array ? [] : {}), config);\r\n                    if (copy !== null) {\r\n                        if (isArray)\r\n                            target.push(copy);\r\n                        else\r\n                            target[method] = copy;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                target[method] = point;\r\n            }\r\n        }\r\n        return target;\r\n    }\r\n    getRouter() {\r\n        return this.$router;\r\n    }\r\n    clickHandler(e, target) {\r\n        if (e) {\r\n            target = target || (e.target || e.srcElement);\r\n            if (target && target.getAttribute) {\r\n                const trigger = target.getAttribute(\"trigger\");\r\n                if (trigger) {\r\n                    this._forView(target, view => view.app.trigger(trigger));\r\n                    e.cancelBubble = true;\r\n                    return e.preventDefault();\r\n                }\r\n                const route = target.getAttribute(\"route\");\r\n                if (route) {\r\n                    this._forView(target, view => view.show(route));\r\n                    e.cancelBubble = true;\r\n                    return e.preventDefault();\r\n                }\r\n            }\r\n        }\r\n        const parent = target.parentNode;\r\n        if (parent) {\r\n            this.clickHandler(e, parent);\r\n        }\r\n    }\r\n    getRoot() {\r\n        return this.getSubView().getRoot();\r\n    }\r\n    refresh() {\r\n        if (!this._subSegment) {\r\n            return Promise.resolve(null);\r\n        }\r\n        return this.getSubView().refresh().then(view => {\r\n            this.callEvent(\"app:route\", [this.getUrl()]);\r\n            return view;\r\n        });\r\n    }\r\n    loadView(url) {\r\n        const views = this.config.views;\r\n        let result = null;\r\n        if (url === \"\") {\r\n            return Promise.resolve(this._loadError(\"\", new Error(\"Webix Jet: Empty url segment\")));\r\n        }\r\n        try {\r\n            if (views) {\r\n                if (typeof views === \"function\") {\r\n                    // custom loading strategy\r\n                    result = views(url);\r\n                }\r\n                else {\r\n                    // predefined hash\r\n                    result = views[url];\r\n                }\r\n                if (typeof result === \"string\") {\r\n                    url = result;\r\n                    result = null;\r\n                }\r\n            }\r\n            if (!result) {\r\n                if (url === \"_hidden\") {\r\n                    result = { hidden: true };\r\n                }\r\n                else if (url === \"_blank\") {\r\n                    result = {};\r\n                }\r\n                else {\r\n                    url = url.replace(/\\./g, \"/\");\r\n                    result = this.require(\"jet-views\", url);\r\n                }\r\n            }\r\n        }\r\n        catch (e) {\r\n            result = this._loadError(url, e);\r\n        }\r\n        // custom handler can return view or its promise\r\n        if (!result.then) {\r\n            result = Promise.resolve(result);\r\n        }\r\n        // set error handler\r\n        result = result\r\n            .then(module => module.__esModule ? module.default : module)\r\n            .catch(err => this._loadError(url, err));\r\n        return result;\r\n    }\r\n    _forView(target, handler) {\r\n        const view = this.webix.$$(target);\r\n        if (view) {\r\n            handler(view.$scope);\r\n        }\r\n    }\r\n    _loadViewDynamic(url) {\r\n        return null;\r\n    }\r\n    createFromURL(chunk) {\r\n        let view;\r\n        if (chunk.isNew || !chunk.view) {\r\n            view = this.loadView(chunk.page)\r\n                .then(ui => this.createView(ui, name, chunk.params));\r\n        }\r\n        else {\r\n            view = Promise.resolve(chunk.view);\r\n        }\r\n        return view;\r\n    }\r\n    _override(ui) {\r\n        const over = this.config.override;\r\n        if (over) {\r\n            let dv;\r\n            while (ui) {\r\n                dv = ui;\r\n                ui = over.get(ui);\r\n            }\r\n            return dv;\r\n        }\r\n        return ui;\r\n    }\r\n    createView(ui, name, params) {\r\n        ui = this._override(ui);\r\n        let obj;\r\n        if (typeof ui === \"function\") {\r\n            if (ui.prototype instanceof JetAppBase) {\r\n                // UI class\r\n                return new ui({ app: this, name, params, router: SubRouter });\r\n            }\r\n            else if (ui.prototype instanceof JetBase) {\r\n                // UI class\r\n                return new ui(this, { name, params });\r\n            }\r\n            else {\r\n                // UI factory functions\r\n                ui = ui(this);\r\n            }\r\n        }\r\n        if (ui instanceof JetBase) {\r\n            obj = ui;\r\n        }\r\n        else {\r\n            // UI object\r\n            obj = new JetViewRaw(this, { name, ui });\r\n        }\r\n        return obj;\r\n    }\r\n    // show view path\r\n    show(url, config) {\r\n        if (url && this.app && url.indexOf(\"//\") == 0)\r\n            return this.app.show(url.substr(1), config);\r\n        return this.render(this._container, url || this.config.start, config);\r\n    }\r\n    // event helpers\r\n    trigger(name, ...rest) {\r\n        this.apply(name, rest);\r\n    }\r\n    apply(name, data) {\r\n        this.callEvent(name, data);\r\n    }\r\n    action(name) {\r\n        return this.webix.bind(function (...rest) {\r\n            this.apply(name, rest);\r\n        }, this);\r\n    }\r\n    on(name, handler) {\r\n        this.attachEvent(name, handler);\r\n    }\r\n    use(plugin, config) {\r\n        plugin(this, null, config);\r\n    }\r\n    error(name, er) {\r\n        this.callEvent(name, er);\r\n        this.callEvent(\"app:error\", er);\r\n        /* tslint:disable */\r\n        if (this.config.debug) {\r\n            for (var i = 0; i < er.length; i++) {\r\n                console.error(er[i]);\r\n                if (er[i] instanceof Error) {\r\n                    let text = er[i].message;\r\n                    if (text.indexOf(\"Module build failed\") === 0) {\r\n                        text = text.replace(/\\x1b\\[[0-9;]*m/g, \"\");\r\n                        document.body.innerHTML = `<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>${text}</pre>`;\r\n                    }\r\n                    else {\r\n                        text += \"<br><br>Check console for more details\";\r\n                        this.webix.message({ type: \"error\", text: text, expire: -1 });\r\n                    }\r\n                }\r\n            }\r\n            debugger;\r\n        }\r\n        /* tslint:enable */\r\n    }\r\n    // renders top view\r\n    render(root, url, config) {\r\n        this._container = (typeof root === \"string\") ?\r\n            this.webix.toNode(root) :\r\n            (root || document.body);\r\n        const firstInit = !this.$router;\r\n        let path = null;\r\n        if (firstInit) {\r\n            if (_once && \"tagName\" in this._container) {\r\n                this.webix.event(document.body, \"click\", e => this.clickHandler(e));\r\n                _once = false;\r\n            }\r\n            if (typeof url === \"string\") {\r\n                url = new Route(url, 0);\r\n            }\r\n            this._subSegment = this._first_start(url);\r\n            this._subSegment.route.linkRouter = true;\r\n        }\r\n        else {\r\n            if (typeof url === \"string\") {\r\n                path = url;\r\n            }\r\n            else {\r\n                if (this.app) {\r\n                    path = url.split().route.path || this.config.start;\r\n                }\r\n                else {\r\n                    path = url.toString();\r\n                }\r\n            }\r\n        }\r\n        const params = config ? config.params : this.config.params || null;\r\n        const top = this.getSubView();\r\n        const segment = this._subSegment;\r\n        const ready = segment\r\n            .show({ url: path, params }, top)\r\n            .then(() => this.createFromURL(segment.current()))\r\n            .then(view => view.render(root, segment))\r\n            .then(base => {\r\n            this.$router.set(segment.route.path, { silent: true });\r\n            this.callEvent(\"app:route\", [this.getUrl()]);\r\n            return base;\r\n        });\r\n        this.ready = this.ready.then(() => ready);\r\n        return ready;\r\n    }\r\n    getSubView() {\r\n        if (this._subSegment) {\r\n            const view = this._subSegment.current().view;\r\n            if (view)\r\n                return view;\r\n        }\r\n        return new JetView(this, {});\r\n    }\r\n    require(type, url) { return null; }\r\n    _first_start(route) {\r\n        this._segment = route;\r\n        const cb = (a) => setTimeout(() => {\r\n            this.show(a).catch(e => {\r\n                if (!(e instanceof NavigationBlocked))\r\n                    throw e;\r\n            });\r\n        }, 1);\r\n        this.$router = new (this.config.router)(cb, this.config, this);\r\n        // start animation for top-level app\r\n        if (this._container === document.body && this.config.animation !== false) {\r\n            const node = this._container;\r\n            this.webix.html.addCss(node, \"webixappstart\");\r\n            setTimeout(() => {\r\n                this.webix.html.removeCss(node, \"webixappstart\");\r\n                this.webix.html.addCss(node, \"webixapp\");\r\n            }, 10);\r\n        }\r\n        if (!route) {\r\n            // if no url defined, check router first\r\n            let urlString = this.$router.get();\r\n            if (!urlString) {\r\n                urlString = this.config.start;\r\n                this.$router.set(urlString, { silent: true });\r\n            }\r\n            route = new Route(urlString, 0);\r\n        }\r\n        else if (this.app) {\r\n            const now = route.current().view;\r\n            route.current().view = this;\r\n            if (route.next()) {\r\n                route.refresh();\r\n                route = route.split();\r\n            }\r\n            else {\r\n                route = new Route(this.config.start, 0);\r\n            }\r\n            route.current().view = now;\r\n        }\r\n        return route;\r\n    }\r\n    // error during view resolving\r\n    _loadError(url, err) {\r\n        this.error(\"app:error:resolve\", [err, url]);\r\n        return { template: \" \" };\r\n    }\r\n    addSubView(obj, target, config) {\r\n        const url = obj.$subview !== true ? obj.$subview : null;\r\n        const name = obj.name || (url ? this.webix.uid() : \"default\");\r\n        target.id = obj.id || \"s\" + this.webix.uid();\r\n        const view = config[name] = {\r\n            id: target.id,\r\n            url,\r\n            branch: obj.branch,\r\n            popup: obj.popup,\r\n            params: obj.params\r\n        };\r\n        return view.popup ? null : target;\r\n    }\r\n}\n\nclass HashRouter {\r\n    constructor(cb, config) {\r\n        this.config = config || {};\r\n        this._detectPrefix();\r\n        this.cb = cb;\r\n        window.onpopstate = () => this.cb(this.get());\r\n    }\r\n    set(path, config) {\r\n        if (this.config.routes) {\r\n            const compare = path.split(\"?\", 2);\r\n            for (const key in this.config.routes) {\r\n                if (this.config.routes[key] === compare[0]) {\r\n                    path = key + (compare.length > 1 ? \"?\" + compare[1] : \"\");\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        if (this.get() !== path) {\r\n            window.history.pushState(null, null, this.prefix + this.sufix + path);\r\n        }\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        let path = this._getRaw().replace(this.prefix, \"\").replace(this.sufix, \"\");\r\n        path = (path !== \"/\" && path !== \"#\") ? path : \"\";\r\n        if (this.config.routes) {\r\n            const compare = path.split(\"?\", 2);\r\n            const key = this.config.routes[compare[0]];\r\n            if (key) {\r\n                path = key + (compare.length > 1 ? \"?\" + compare[1] : \"\");\r\n            }\r\n        }\r\n        return path;\r\n    }\r\n    _detectPrefix() {\r\n        // use \"#!\" for backward compatibility\r\n        const sufix = this.config.routerPrefix;\r\n        this.sufix = \"#\" + ((typeof sufix === \"undefined\") ? \"!\" : sufix);\r\n        this.prefix = document.location.href.split(\"#\", 2)[0];\r\n    }\r\n    _getRaw() {\r\n        return document.location.href;\r\n    }\r\n}\n\nlet isPatched = false;\r\nfunction patch(w) {\r\n    if (isPatched || !w) {\r\n        return;\r\n    }\r\n    isPatched = true;\r\n    // custom promise for IE8\r\n    const win = window;\r\n    if (!win.Promise) {\r\n        win.Promise = w.promise;\r\n    }\r\n    const version = w.version.split(\".\");\r\n    // will be fixed in webix 5.3\r\n    if (version[0] * 10 + version[1] * 1 < 53) {\r\n        w.ui.freeze = function (handler) {\r\n            // disabled because webix jet 5.0 can't handle resize of scrollview correctly\r\n            // w.ui.$freeze = true;\r\n            const res = handler();\r\n            if (res && res.then) {\r\n                res.then(function (some) {\r\n                    w.ui.$freeze = false;\r\n                    w.ui.resize();\r\n                    return some;\r\n                });\r\n            }\r\n            else {\r\n                w.ui.$freeze = false;\r\n                w.ui.resize();\r\n            }\r\n            return res;\r\n        };\r\n    }\r\n    // adding views as classes\r\n    const baseAdd = w.ui.baselayout.prototype.addView;\r\n    const baseRemove = w.ui.baselayout.prototype.removeView;\r\n    const config = {\r\n        addView(view, index) {\r\n            // trigger logic only for widgets inside of jet-view\r\n            // ignore case when addView used with already initialized widget\r\n            if (this.$scope && this.$scope.webixJet && !view.queryView) {\r\n                const jview = this.$scope;\r\n                const subs = {};\r\n                view = jview.app.copyConfig(view, {}, subs);\r\n                baseAdd.apply(this, [view, index]);\r\n                for (const key in subs) {\r\n                    jview._renderFrame(key, subs[key], null).then(() => {\r\n                        jview._subs[key] = subs[key];\r\n                    });\r\n                }\r\n                return view.id;\r\n            }\r\n            else {\r\n                return baseAdd.apply(this, arguments);\r\n            }\r\n        },\r\n        removeView() {\r\n            baseRemove.apply(this, arguments);\r\n            if (this.$scope && this.$scope.webixJet) {\r\n                const subs = this.$scope._subs;\r\n                // check all sub-views, destroy and clean the removed one\r\n                for (const key in subs) {\r\n                    const test = subs[key];\r\n                    if (!w.$$(test.id)) {\r\n                        test.view.destructor();\r\n                        delete subs[key];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n    w.extend(w.ui.layout.prototype, config, true);\r\n    w.extend(w.ui.baselayout.prototype, config, true);\r\n    // wrapper for using Jet Apps as views\r\n    w.protoUI({\r\n        name: \"jetapp\",\r\n        $init(cfg) {\r\n            this.$app = new this.app(cfg);\r\n            const id = w.uid().toString();\r\n            cfg.body = { id };\r\n            this.$ready.push(function () {\r\n                this.callEvent(\"onInit\", [this.$app]);\r\n                this.$app.render({ id });\r\n            });\r\n        }\r\n    }, w.ui.proxy, w.EventSystem);\r\n}\n\nclass JetApp extends JetAppBase {\r\n    constructor(config) {\r\n        config.router = config.router || HashRouter;\r\n        super(config);\r\n        patch(this.webix);\r\n    }\r\n    require(type, url) {\r\n        return require(type + \"/\" + url);\r\n    }\r\n}\n\nclass StoreRouter {\r\n    constructor(cb, config, app) {\r\n        this.storage = config.storage || app.webix.storage.session;\r\n        this.name = (config.storeName || config.id + \":route\");\r\n        this.cb = cb;\r\n    }\r\n    set(path, config) {\r\n        this.storage.put(this.name, path);\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        return this.storage.get(this.name);\r\n    }\r\n}\n\nclass UrlRouter extends HashRouter {\r\n    _detectPrefix() {\r\n        this.prefix = \"\";\r\n        this.sufix = this.config.routerPrefix || \"\";\r\n    }\r\n    _getRaw() {\r\n        return document.location.pathname + (document.location.search || \"\");\r\n    }\r\n}\n\nclass EmptyRouter {\r\n    constructor(cb, _$config) {\r\n        this.path = \"\";\r\n        this.cb = cb;\r\n    }\r\n    set(path, config) {\r\n        this.path = path;\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        return this.path;\r\n    }\r\n}\n\nfunction UnloadGuard(app, view, config) {\r\n    view.on(app, `app:guard`, function (_$url, point, promise) {\r\n        if (point === view || point.contains(view)) {\r\n            const res = config();\r\n            if (res === false) {\r\n                promise.confirm = Promise.reject(new NavigationBlocked());\r\n            }\r\n            else {\r\n                promise.confirm = promise.confirm.then(() => res);\r\n            }\r\n        }\r\n    });\r\n}\n\n//     (c) 2012-2018 Airbnb, Inc.\n\n// var has = require('has');\nfunction has(store, key) {\n  return Object.prototype.hasOwnProperty.call(store, key);\n}\n// var forEach = require('for-each');\nfunction forEach(obj, handler, context) {\n  for (var key in obj) {\n    if (has(obj, key)) {\n      handler.call((context || obj), obj[key], key, obj);\n    }\n  }\n}\n// var trim = require('string.prototype.trim');\nfunction trim(str) {\n  return str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n}\n// var warning = require('warning');\nfunction warn(message) {\n  message = 'Warning: ' + message;\n  if (typeof console !== 'undefined') {\n    console.error(message);\n  }\n\n  try { throw new Error(message); } catch (x) {}\n}\n\nvar replace = String.prototype.replace;\nvar split = String.prototype.split;\n\n// #### Pluralization methods\n// The string that separates the different phrase possibilities.\nvar delimiter = '||||';\n\nvar russianPluralGroups = function (n) {\n  var end = n % 10;\n  if (n !== 11 && end === 1) {\n    return 0;\n  }\n  if (2 <= end && end <= 4 && !(n >= 12 && n <= 14)) {\n    return 1;\n  }\n  return 2;\n};\n\n// Mapping from pluralization group plural logic.\nvar pluralTypes = {\n  arabic: function (n) {\n    // http://www.arabeyes.org/Plural_Forms\n    if (n < 3) { return n; }\n    var lastTwo = n % 100;\n    if (lastTwo >= 3 && lastTwo <= 10) return 3;\n    return lastTwo >= 11 ? 4 : 5;\n  },\n  bosnian_serbian: russianPluralGroups,\n  chinese: function () { return 0; },\n  croatian: russianPluralGroups,\n  french: function (n) { return n > 1 ? 1 : 0; },\n  german: function (n) { return n !== 1 ? 1 : 0; },\n  russian: russianPluralGroups,\n  lithuanian: function (n) {\n    if (n % 10 === 1 && n % 100 !== 11) { return 0; }\n    return n % 10 >= 2 && n % 10 <= 9 && (n % 100 < 11 || n % 100 > 19) ? 1 : 2;\n  },\n  czech: function (n) {\n    if (n === 1) { return 0; }\n    return (n >= 2 && n <= 4) ? 1 : 2;\n  },\n  polish: function (n) {\n    if (n === 1) { return 0; }\n    var end = n % 10;\n    return 2 <= end && end <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2;\n  },\n  icelandic: function (n) { return (n % 10 !== 1 || n % 100 === 11) ? 1 : 0; },\n  slovenian: function (n) {\n    var lastTwo = n % 100;\n    if (lastTwo === 1) {\n      return 0;\n    }\n    if (lastTwo === 2) {\n      return 1;\n    }\n    if (lastTwo === 3 || lastTwo === 4) {\n      return 2;\n    }\n    return 3;\n  }\n};\n\n\n// Mapping from pluralization group to individual language codes/locales.\n// Will look up based on exact match, if not found and it's a locale will parse the locale\n// for language code, and if that does not exist will default to 'en'\nvar pluralTypeToLanguages = {\n  arabic: ['ar'],\n  bosnian_serbian: ['bs-Latn-BA', 'bs-Cyrl-BA', 'srl-RS', 'sr-RS'],\n  chinese: ['id', 'id-ID', 'ja', 'ko', 'ko-KR', 'lo', 'ms', 'th', 'th-TH', 'zh'],\n  croatian: ['hr', 'hr-HR'],\n  german: ['fa', 'da', 'de', 'en', 'es', 'fi', 'el', 'he', 'hi-IN', 'hu', 'hu-HU', 'it', 'nl', 'no', 'pt', 'sv', 'tr'],\n  french: ['fr', 'tl', 'pt-br'],\n  russian: ['ru', 'ru-RU'],\n  lithuanian: ['lt'],\n  czech: ['cs', 'cs-CZ', 'sk'],\n  polish: ['pl'],\n  icelandic: ['is'],\n  slovenian: ['sl-SL']\n};\n\nfunction langToTypeMap(mapping) {\n  var ret = {};\n  forEach(mapping, function (langs, type) {\n    forEach(langs, function (lang) {\n      ret[lang] = type;\n    });\n  });\n  return ret;\n}\n\nfunction pluralTypeName(locale) {\n  var langToPluralType = langToTypeMap(pluralTypeToLanguages);\n  return langToPluralType[locale]\n    || langToPluralType[split.call(locale, /-/, 1)[0]]\n    || langToPluralType.en;\n}\n\nfunction pluralTypeIndex(locale, count) {\n  return pluralTypes[pluralTypeName(locale)](count);\n}\n\nfunction escape(token) {\n  return token.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n\nfunction constructTokenRegex(opts) {\n  var prefix = (opts && opts.prefix) || '%{';\n  var suffix = (opts && opts.suffix) || '}';\n\n  if (prefix === delimiter || suffix === delimiter) {\n    throw new RangeError('\"' + delimiter + '\" token is reserved for pluralization');\n  }\n\n  return new RegExp(escape(prefix) + '(.*?)' + escape(suffix), 'g');\n}\n\nvar dollarRegex = /\\$/g;\nvar dollarBillsYall = '$$';\nvar defaultTokenRegex = /%\\{(.*?)\\}/g;\n\n// ### transformPhrase(phrase, substitutions, locale)\n//\n// Takes a phrase string and transforms it by choosing the correct\n// plural form and interpolating it.\n//\n//     transformPhrase('Hello, %{name}!', {name: 'Spike'});\n//     // \"Hello, Spike!\"\n//\n// The correct plural form is selected if substitutions.smart_count\n// is set. You can pass in a number instead of an Object as `substitutions`\n// as a shortcut for `smart_count`.\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', {smart_count: 1}, 'en');\n//     // \"1 new message\"\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', {smart_count: 2}, 'en');\n//     // \"2 new messages\"\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', 5, 'en');\n//     // \"5 new messages\"\n//\n// You should pass in a third argument, the locale, to specify the correct plural type.\n// It defaults to `'en'` with 2 plural forms.\nfunction transformPhrase(phrase, substitutions, locale, tokenRegex) {\n  if (typeof phrase !== 'string') {\n    throw new TypeError('Polyglot.transformPhrase expects argument #1 to be string');\n  }\n\n  if (substitutions == null) {\n    return phrase;\n  }\n\n  var result = phrase;\n  var interpolationRegex = tokenRegex || defaultTokenRegex;\n\n  // allow number as a pluralization shortcut\n  var options = typeof substitutions === 'number' ? { smart_count: substitutions } : substitutions;\n\n  // Select plural form: based on a phrase text that contains `n`\n  // plural forms separated by `delimiter`, a `locale`, and a `substitutions.smart_count`,\n  // choose the correct plural form. This is only done if `count` is set.\n  if (options.smart_count != null && result) {\n    var texts = split.call(result, delimiter);\n    result = trim(texts[pluralTypeIndex(locale || 'en', options.smart_count)] || texts[0]);\n  }\n\n  // Interpolate: Creates a `RegExp` object for each interpolation placeholder.\n  result = replace.call(result, interpolationRegex, function (expression, argument) {\n    if (!has(options, argument) || options[argument] == null) { return expression; }\n    // Ensure replacement value is escaped to prevent special $-prefixed regex replace tokens.\n    return replace.call(options[argument], dollarRegex, dollarBillsYall);\n  });\n\n  return result;\n}\n\n// ### Polyglot class constructor\nfunction Polyglot(options) {\n  var opts = options || {};\n  this.phrases = {};\n  this.extend(opts.phrases || {});\n  this.currentLocale = opts.locale || 'en';\n  var allowMissing = opts.allowMissing ? transformPhrase : null;\n  this.onMissingKey = typeof opts.onMissingKey === 'function' ? opts.onMissingKey : allowMissing;\n  this.warn = opts.warn || warn;\n  this.tokenRegex = constructTokenRegex(opts.interpolation);\n}\n\n// ### polyglot.locale([locale])\n//\n// Get or set locale. Internally, Polyglot only uses locale for pluralization.\nPolyglot.prototype.locale = function (newLocale) {\n  if (newLocale) this.currentLocale = newLocale;\n  return this.currentLocale;\n};\n\n// ### polyglot.extend(phrases)\n//\n// Use `extend` to tell Polyglot how to translate a given key.\n//\n//     polyglot.extend({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     });\n//\n// The key can be any string.  Feel free to call `extend` multiple times;\n// it will override any phrases with the same key, but leave existing phrases\n// untouched.\n//\n// It is also possible to pass nested phrase objects, which get flattened\n// into an object with the nested keys concatenated using dot notation.\n//\n//     polyglot.extend({\n//       \"nav\": {\n//         \"hello\": \"Hello\",\n//         \"hello_name\": \"Hello, %{name}\",\n//         \"sidebar\": {\n//           \"welcome\": \"Welcome\"\n//         }\n//       }\n//     });\n//\n//     console.log(polyglot.phrases);\n//     // {\n//     //   'nav.hello': 'Hello',\n//     //   'nav.hello_name': 'Hello, %{name}',\n//     //   'nav.sidebar.welcome': 'Welcome'\n//     // }\n//\n// `extend` accepts an optional second argument, `prefix`, which can be used\n// to prefix every key in the phrases object with some string, using dot\n// notation.\n//\n//     polyglot.extend({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     }, \"nav\");\n//\n//     console.log(polyglot.phrases);\n//     // {\n//     //   'nav.hello': 'Hello',\n//     //   'nav.hello_name': 'Hello, %{name}'\n//     // }\n//\n// This feature is used internally to support nested phrase objects.\nPolyglot.prototype.extend = function (morePhrases, prefix) {\n  forEach(morePhrases, function (phrase, key) {\n    var prefixedKey = prefix ? prefix + '.' + key : key;\n    if (typeof phrase === 'object') {\n      this.extend(phrase, prefixedKey);\n    } else {\n      this.phrases[prefixedKey] = phrase;\n    }\n  }, this);\n};\n\n// ### polyglot.unset(phrases)\n// Use `unset` to selectively remove keys from a polyglot instance.\n//\n//     polyglot.unset(\"some_key\");\n//     polyglot.unset({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     });\n//\n// The unset method can take either a string (for the key), or an object hash with\n// the keys that you would like to unset.\nPolyglot.prototype.unset = function (morePhrases, prefix) {\n  if (typeof morePhrases === 'string') {\n    delete this.phrases[morePhrases];\n  } else {\n    forEach(morePhrases, function (phrase, key) {\n      var prefixedKey = prefix ? prefix + '.' + key : key;\n      if (typeof phrase === 'object') {\n        this.unset(phrase, prefixedKey);\n      } else {\n        delete this.phrases[prefixedKey];\n      }\n    }, this);\n  }\n};\n\n// ### polyglot.clear()\n//\n// Clears all phrases. Useful for special cases, such as freeing\n// up memory if you have lots of phrases but no longer need to\n// perform any translation. Also used internally by `replace`.\nPolyglot.prototype.clear = function () {\n  this.phrases = {};\n};\n\n// ### polyglot.replace(phrases)\n//\n// Completely replace the existing phrases with a new set of phrases.\n// Normally, just use `extend` to add more phrases, but under certain\n// circumstances, you may want to make sure no old phrases are lying around.\nPolyglot.prototype.replace = function (newPhrases) {\n  this.clear();\n  this.extend(newPhrases);\n};\n\n\n// ### polyglot.t(key, options)\n//\n// The most-used method. Provide a key, and `t` will return the\n// phrase.\n//\n//     polyglot.t(\"hello\");\n//     => \"Hello\"\n//\n// The phrase value is provided first by a call to `polyglot.extend()` or\n// `polyglot.replace()`.\n//\n// Pass in an object as the second argument to perform interpolation.\n//\n//     polyglot.t(\"hello_name\", {name: \"Spike\"});\n//     => \"Hello, Spike\"\n//\n// If you like, you can provide a default value in case the phrase is missing.\n// Use the special option key \"_\" to specify a default.\n//\n//     polyglot.t(\"i_like_to_write_in_language\", {\n//       _: \"I like to write in %{language}.\",\n//       language: \"JavaScript\"\n//     });\n//     => \"I like to write in JavaScript.\"\n//\nPolyglot.prototype.t = function (key, options) {\n  var phrase, result;\n  var opts = options == null ? {} : options;\n  if (typeof this.phrases[key] === 'string') {\n    phrase = this.phrases[key];\n  } else if (typeof opts._ === 'string') {\n    phrase = opts._;\n  } else if (this.onMissingKey) {\n    var onMissingKey = this.onMissingKey;\n    result = onMissingKey(key, opts, this.currentLocale, this.tokenRegex);\n  } else {\n    this.warn('Missing translation for key: \"' + key + '\"');\n    result = key;\n  }\n  if (typeof phrase === 'string') {\n    result = transformPhrase(phrase, opts, this.currentLocale, this.tokenRegex);\n  }\n  return result;\n};\n\n\n// ### polyglot.has(key)\n//\n// Check if polyglot has a translation for given key\nPolyglot.prototype.has = function (key) {\n  return has(this.phrases, key);\n};\n\n// export transformPhrase\nPolyglot.transformPhrase = function transform(phrase, substitutions, locale) {\n  return transformPhrase(phrase, substitutions, locale);\n};\n\nvar webixPolyglot = Polyglot;\n\nfunction Locale(app, _view, config) {\r\n    config = config || {};\r\n    const storage = config.storage;\r\n    let lang = storage ? (storage.get(\"lang\") || \"en\") : (config.lang || \"en\");\r\n    function setLangData(name, data, silent) {\r\n        if (data.__esModule) {\r\n            data = data.default;\r\n        }\r\n        const pconfig = { phrases: data };\r\n        if (config.polyglot) {\r\n            app.webix.extend(pconfig, config.polyglot);\r\n        }\r\n        const poly = service.polyglot = new webixPolyglot(pconfig);\r\n        poly.locale(name);\r\n        service._ = app.webix.bind(poly.t, poly);\r\n        lang = name;\r\n        if (storage) {\r\n            storage.put(\"lang\", lang);\r\n        }\r\n        if (config.webix) {\r\n            const locName = config.webix[name];\r\n            if (locName) {\r\n                app.webix.i18n.setLocale(locName);\r\n            }\r\n        }\r\n        if (!silent) {\r\n            return app.refresh();\r\n        }\r\n        return Promise.resolve();\r\n    }\r\n    function getLang() { return lang; }\r\n    function setLang(name, silent) {\r\n        // ignore setLang if loading by path is disabled\r\n        if (config.path === false) {\r\n            return;\r\n        }\r\n        const path = (config.path ? config.path + \"/\" : \"\") + name;\r\n        const data = app.require(\"jet-locales\", path);\r\n        setLangData(name, data, silent);\r\n    }\r\n    const service = {\r\n        getLang, setLang, setLangData, _: null, polyglot: null\r\n    };\r\n    app.setService(\"locale\", service);\r\n    setLang(lang, true);\r\n}\n\nfunction show(view, config, value) {\r\n    if (config.urls) {\r\n        value = config.urls[value] || value;\r\n    }\r\n    else if (config.param) {\r\n        value = { [config.param]: value };\r\n    }\r\n    view.show(value);\r\n}\r\nfunction Menu(app, view, config) {\r\n    const frame = view.getSubViewInfo().parent;\r\n    const ui = view.$$(config.id || config);\r\n    let silent = false;\r\n    ui.attachEvent(\"onchange\", function () {\r\n        if (!silent) {\r\n            show(frame, config, this.getValue());\r\n        }\r\n    });\r\n    ui.attachEvent(\"onafterselect\", function () {\r\n        if (!silent) {\r\n            let id = null;\r\n            if (ui.setValue) {\r\n                id = this.getValue();\r\n            }\r\n            else if (ui.getSelectedId) {\r\n                id = ui.getSelectedId();\r\n            }\r\n            show(frame, config, id);\r\n        }\r\n    });\r\n    view.on(app, `app:route`, function () {\r\n        let name = \"\";\r\n        if (config.param) {\r\n            name = view.getParam(config.param, true);\r\n        }\r\n        else {\r\n            const segment = frame.getUrl()[1];\r\n            if (segment) {\r\n                name = segment.page;\r\n            }\r\n        }\r\n        if (name) {\r\n            silent = true;\r\n            if (ui.setValue && ui.getValue() !== name) {\r\n                ui.setValue(name);\r\n            }\r\n            else if (ui.select && ui.exists(name) && ui.getSelectedId() !== name) {\r\n                ui.select(name);\r\n            }\r\n            silent = false;\r\n        }\r\n    });\r\n}\n\nconst baseicons = {\r\n    good: \"check\",\r\n    error: \"warning\",\r\n    saving: \"refresh fa-spin\"\r\n};\r\nconst basetext = {\r\n    good: \"Ok\",\r\n    error: \"Error\",\r\n    saving: \"Connecting...\"\r\n};\r\nfunction Status(app, view, config) {\r\n    let status = \"good\";\r\n    let count = 0;\r\n    let iserror = false;\r\n    let expireDelay = config.expire;\r\n    if (!expireDelay && expireDelay !== false) {\r\n        expireDelay = 2000;\r\n    }\r\n    const texts = config.texts || basetext;\r\n    const icons = config.icons || baseicons;\r\n    if (typeof config === \"string\") {\r\n        config = { target: config };\r\n    }\r\n    function refresh(content) {\r\n        const area = view.$$(config.target);\r\n        if (area) {\r\n            if (!content) {\r\n                content = \"<div class='status_\" +\r\n                    status +\r\n                    \"'><span class='webix_icon fa-\" +\r\n                    icons[status] + \"'></span> \" + texts[status] + \"</div>\";\r\n            }\r\n            area.setHTML(content);\r\n        }\r\n    }\r\n    function success() {\r\n        count--;\r\n        setStatus(\"good\");\r\n    }\r\n    function fail(err) {\r\n        count--;\r\n        setStatus(\"error\", err);\r\n    }\r\n    function start(promise) {\r\n        count++;\r\n        setStatus(\"saving\");\r\n        if (promise && promise.then) {\r\n            promise.then(success, fail);\r\n        }\r\n    }\r\n    function getStatus() {\r\n        return status;\r\n    }\r\n    function hideStatus() {\r\n        if (count === 0) {\r\n            refresh(\" \");\r\n        }\r\n    }\r\n    function setStatus(mode, err) {\r\n        if (count < 0) {\r\n            count = 0;\r\n        }\r\n        if (mode === \"saving\") {\r\n            status = \"saving\";\r\n            refresh();\r\n        }\r\n        else {\r\n            iserror = (mode === \"error\");\r\n            if (count === 0) {\r\n                status = iserror ? \"error\" : \"good\";\r\n                if (iserror) {\r\n                    app.error(\"app:error:server\", [err.responseText || err]);\r\n                }\r\n                else {\r\n                    if (expireDelay) {\r\n                        setTimeout(hideStatus, expireDelay);\r\n                    }\r\n                }\r\n                refresh();\r\n            }\r\n        }\r\n    }\r\n    function track(data) {\r\n        const dp = app.webix.dp(data);\r\n        if (dp) {\r\n            view.on(dp, \"onAfterDataSend\", start);\r\n            view.on(dp, \"onAfterSaveError\", (_id, _obj, response) => fail(response));\r\n            view.on(dp, \"onAfterSave\", success);\r\n        }\r\n    }\r\n    app.setService(\"status\", {\r\n        getStatus,\r\n        setStatus,\r\n        track\r\n    });\r\n    if (config.remote) {\r\n        view.on(app.webix, \"onRemoteCall\", start);\r\n    }\r\n    if (config.ajax) {\r\n        view.on(app.webix, \"onBeforeAjax\", (_mode, _url, _data, _request, _headers, _files, promise) => {\r\n            start(promise);\r\n        });\r\n    }\r\n    if (config.data) {\r\n        track(config.data);\r\n    }\r\n}\n\nfunction Theme(app, _view, config) {\r\n    config = config || {};\r\n    const storage = config.storage;\r\n    let theme = storage ?\r\n        (storage.get(\"theme\") || \"flat-default\")\r\n        :\r\n            (config.theme || \"flat-default\");\r\n    const service = {\r\n        getTheme() { return theme; },\r\n        setTheme(name, silent) {\r\n            const parts = name.split(\"-\");\r\n            const links = document.getElementsByTagName(\"link\");\r\n            for (let i = 0; i < links.length; i++) {\r\n                const lname = links[i].getAttribute(\"title\");\r\n                if (lname) {\r\n                    if (lname === name || lname === parts[0]) {\r\n                        links[i].disabled = false;\r\n                    }\r\n                    else {\r\n                        links[i].disabled = true;\r\n                    }\r\n                }\r\n            }\r\n            app.webix.skin.set(parts[0]);\r\n            // remove old css\r\n            app.webix.html.removeCss(document.body, \"theme-\" + theme);\r\n            // add new css\r\n            app.webix.html.addCss(document.body, \"theme-\" + name);\r\n            theme = name;\r\n            if (storage) {\r\n                storage.put(\"theme\", name);\r\n            }\r\n            if (!silent) {\r\n                app.refresh();\r\n            }\r\n        }\r\n    };\r\n    app.setService(\"theme\", service);\r\n    service.setTheme(theme, true);\r\n}\n\nfunction copyParams(data, url, route) {\r\n    for (let i = 0; i < route.length; i++) {\r\n        data[route[i]] = url[i + 1] ? url[i + 1].page : \"\";\r\n    }\r\n}\r\nfunction UrlParam(app, view, config) {\r\n    const route = config.route || config;\r\n    const data = {};\r\n    view.on(app, \"app:urlchange\", function (subview, segment) {\r\n        if (view === subview) {\r\n            copyParams(data, segment.suburl(), route);\r\n            segment.size(route.length + 1);\r\n        }\r\n    });\r\n    const os = view.setParam;\r\n    const og = view.getParam;\r\n    view.setParam = function (name, value, show) {\r\n        const index = route.indexOf(name);\r\n        if (index >= 0) {\r\n            data[name] = value;\r\n            this._segment.update(\"\", value, index + 1);\r\n            if (show) {\r\n                return view.show(null);\r\n            }\r\n        }\r\n        else {\r\n            return os.call(this, name, value, show);\r\n        }\r\n    };\r\n    view.getParam = function (key, mode) {\r\n        const val = data[key];\r\n        if (typeof val !== \"undefined\") {\r\n            return val;\r\n        }\r\n        return og.call(this, key, mode);\r\n    };\r\n    copyParams(data, view.getUrl(), route);\r\n}\n\nfunction User(app, _view, config) {\r\n    config = config || {};\r\n    const login = config.login || \"/login\";\r\n    const logout = config.logout || \"/logout\";\r\n    const afterLogin = config.afterLogin || app.config.start;\r\n    const afterLogout = config.afterLogout || \"/login\";\r\n    const ping = config.ping || 5 * 60 * 1000;\r\n    const model = config.model;\r\n    let user = config.user;\r\n    const service = {\r\n        getUser() {\r\n            return user;\r\n        },\r\n        getStatus(server) {\r\n            if (!server) {\r\n                return user !== null;\r\n            }\r\n            return model.status().catch(() => null).then(data => {\r\n                user = data;\r\n            });\r\n        },\r\n        login(name, pass) {\r\n            return model.login(name, pass).then(data => {\r\n                user = data;\r\n                if (!data) {\r\n                    throw new Error(\"Access denied\");\r\n                }\r\n                app.callEvent(\"app:user:login\", [user]);\r\n                app.show(afterLogin);\r\n            });\r\n        },\r\n        logout() {\r\n            user = null;\r\n            return model.logout().then(res => {\r\n                app.callEvent(\"app:user:logout\", []);\r\n                return res;\r\n            });\r\n        }\r\n    };\r\n    function canNavigate(url, obj) {\r\n        if (url === logout) {\r\n            service.logout();\r\n            obj.redirect = afterLogout;\r\n        }\r\n        else if (url !== login && !service.getStatus()) {\r\n            obj.redirect = login;\r\n        }\r\n    }\r\n    app.setService(\"user\", service);\r\n    app.attachEvent(`app:guard`, function (url, _$root, obj) {\r\n        if (config.public && config.public(url)) {\r\n            return true;\r\n        }\r\n        if (typeof user === \"undefined\") {\r\n            obj.confirm = service.getStatus(true).then(() => canNavigate(url, obj));\r\n        }\r\n        return canNavigate(url, obj);\r\n    });\r\n    if (ping) {\r\n        setInterval(() => service.getStatus(true), ping);\r\n    }\r\n}\n\n/*\r\nMIT License\r\nCopyright (c) 2019 XB Software\r\n*/\r\nlet webix = window.webix;\r\nif (webix) {\r\n    patch(webix);\r\n}\r\nconst plugins = {\r\n    UnloadGuard, Locale, Menu, Theme, User, Status, UrlParam\r\n};\r\nconst errors = { NavigationBlocked };\r\nconst w = window;\r\nif (!w.Promise) {\r\n    w.Promise = w.webix.promise;\r\n}\n\nexport { plugins, errors, JetApp, JetView, HashRouter, StoreRouter, UrlRouter, EmptyRouter, SubRouter };\n//# sourceMappingURL=jet.js.map\n","let once = false;\n\nexport function initRLayout(){\n    if (once) return;\n    once = true;\n\n    webix.protoUI(\n        {\n            name: \"r-layout\",\n            sizeTrigger(app, handler, value) {\n                this._compactValue = value;\n                this._compactHandler = handler;\n                this._app = app;\n\n                const config = app.config;\n                this._forceCompact = typeof config.params.forceCompact !== \"undefined\";\n                this._compactWidth = config.compactWidth;\n\n                if (!this._forceCompact) this._checkTrigger(this.$view.width, value);\n            },\n            _checkTrigger(x, value) {\n                if (this._compactWidth) {\n                    if (\n                        (x <= this._compactWidth && !value) ||\n                        (x > this._compactWidth && value)\n                    ) {\n                        this._compactWidth = null;\n                        this._compactHandler(!value);\n                        return false;\n                    }\n                }\n                return true;\n            },\n            $setSize(x, y) {\n                if (this._forceCompact || this._checkTrigger(x, this._compactValue))\n                    webix.ui.layout.prototype.$setSize.call(this, x, y);\n                if (this._app) this._app.callEvent(\"view:resize\", []); //edit popup resize\n            },\n        },\n        webix.ui.layout\n    );\n}\n","export function initJetWin(app) {\n\tlet appId;\n\n\tconst service = {\n\t\tupdateConfig(config){\n\t\t\tconst appView = app.getRoot();\n\t\t\tconst appNode = appView.$view;\n\n\t\t\tif(!appId){\n\t\t\t\tif(appNode.id)\n\t\t\t\t\tappId = appNode.id;\n\t\t\t\telse \n\t\t\t\t\tappNode.id = appId = \"webix_\" + webix.uid();\n\n\t\t\t\twebix.html.addStyle(`.webix_win_inside *:not(.webix_modal_box):not(.webix_modal_cover){ z-index: 0; }`);\n\t\t\t\twebix.html.addStyle(`#${appId}{ position: relative; }`);\n\t\t\t\twebix.html.addStyle(`#${appId} .webix_window{ z-index:2 !important; }`);\n\t\t\t\twebix.html.addStyle(`#${appId} .webix_disabled{ z-index:1 !important; }`);\n\t\t\t}\n\t\t\telse if(appId && !appNode.id) //app refresh\n\t\t\t\tappNode.id = appId;\n\n\t\t\tconfig.container = appId;\n\n\t\t\tif(config.fullscreen){\n\t\t\t\tconfig._fillApp = true;\n\t\t\t\tdelete config.fullscreen;\n\t\t\t}\n\n\t\t\tif(!config.on)\n\t\t\t\tconfig.on = {};\n\n\t\t\tlet firstShow = true;\n\t\t\tconst defaultHandler = config.on.onShow;\n\n\t\t\tconfig.on.onShow = function(){\n\t\t\t\tif(defaultHandler)\n\t\t\t\t\tdefaultHandler.apply(this, arguments);\n\n\t\t\t\tif(firstShow){\n\t\t\t\t\tthis.$setSize = (x, y) => {\n\t\t\t\t\t\tsetSize(this, appView, true);\n\t\t\t\t\t\twebix.ui.window.prototype.$setSize.apply(this, [x, y]);\n\t\t\t\t\t};\n\t\t\t\t\tsetHandlers(this, app);\n\t\t\t\t\tfirstShow = null;\n\t\t\t\t}\n\n\t\t\t\twebix.callEvent(\"onClick\", []);\n\t\t\t\twebix.html.addCss(appNode, \"webix_win_inside\");\n\t\t\t\tappView.disable();\n\n\t\t\t\tsetSize(this, appView);\n\t\t\t}\n\n\t\t\treturn config;\n\t\t}\n\t};\n\n\tapp.setService(\"jet-win\", service);\n}\n\nfunction setSize(win, appView, silent){\n\tconst appWidth = appView.$width;\n\tconst appHeight = appView.$height;\n\n\tif(win.config._fillApp)\n\t\twin.define({\n\t\t\twidth: appWidth,\n\t\t\theight: appHeight,\n\t\t});\n\telse {\n\t\twin.define({\n\t\t\tleft: (appWidth - win.$width) / 2,\n\t\t\ttop: (appHeight - win.$height) / 2,\n\t\t});\n\t}\n\n\tif(!silent)\n\t\twin.resize();\n}\n\nfunction setHandlers(win, app){\n\tconst appView = app.getRoot();\n\n\twin.attachEvent(\"onHide\", ()=> {\n\t\tif(!appView.$destructed){\n\t\t\twebix.html.removeCss(appView.$view, \"webix_win_inside\");\n\t\t\tappView.enable();\n\t\t}\n\t});\n\n\tconst resizeEv = app.attachEvent(\"view:resize\", ()=> {\n\t\tsetSize(win, appView);\n\t});\n\n\twin.attachEvent(\"onDestruct\", ()=> {\n\t\tapp.detachEvent(resizeEv);\n\t});\n}\n","var index = 1;\nfunction uid() {\n\treturn index++;\n}\n\nvar empty = undefined;\n\nexport function ignoreInitial(code) {\n\tlet init = false;\n\treturn function() {\n\t\tif (init) return code.apply(this, arguments);\n\t\telse init = true;\n\t};\n}\n\nvar context = null;\nexport function withContext(value, code) {\n\tcontext = value;\n\tcode();\n\tcontext = null;\n}\n\nexport function filter(rule, handler) {\n\treturn function(v, o, obj, meta) {\n\t\tif (rule(v, meta)) handler.apply(this, arguments);\n\t};\n}\n\nexport function link(source, target, key) {\n\tObject.defineProperty(target, key, {\n\t\tget: () => source[key],\n\t\tset: value => (source[key] = value),\n\t});\n}\n\nexport function debounce(handler, delay) {\n\tdelay = delay || 200;\n\tlet timer = null;\n\tlet data = null;\n\treturn function() {\n\t\tdata = arguments;\n\t\tif (!timer) {\n\t\t\ttimer = setTimeout(() => {\n\t\t\t\tclearTimeout(timer);\n\t\t\t\ttimer = null;\n\n\t\t\t\thandler.apply(this, data);\n\t\t\t}, delay);\n\t\t}\n\t};\n}\n\nexport function createState(data, config) {\n\tconfig = config || {};\n\tconst handlers = {};\n\tconst out = {};\n\n\tconst observe = function(mask, handler) {\n\t\tconst key = uid();\n\t\thandlers[key] = { mask, handler };\n\t\tif (mask === \"*\") handler(out, empty, mask);\n\t\telse handler(out[mask], empty, mask);\n\n\t\treturn key;\n\t};\n\n\tconst extend = function(data, sconfig){\n\t\tsconfig = sconfig || config;\n\t\t// normal js object\n\t\tfor (const key in data) {\n\t\t\tif (data.hasOwnProperty(key)) {\n\t\t\t\tconst test = data[key];\n\t\t\t\tif (sconfig.nested && typeof test === \"object\" && test) {\n\t\t\t\t\tout[key] = createState(test, sconfig);\n\t\t\t\t} else {\n\t\t\t\t\treactive(out, test, key, notify);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tconst observeEnd = function(id) {\n\t\tdelete handlers[id];\n\t};\n\n\tconst queue = [];\n\tlet waitInQueue = false;\n\n\tvar batch = function(code) {\n\t\tif (typeof code !== \"function\") {\n\t\t\tconst values = code;\n\t\t\tcode = () => {\n\t\t\t\tfor (const key in values) out[key] = values[key];\n\t\t\t};\n\t\t}\n\n\t\twaitInQueue = true;\n\t\tcode(out);\n\t\twaitInQueue = false;\n\t\twhile (queue.length) {\n\t\t\tconst obj = queue.shift();\n\t\t\tnotify.apply(this, obj);\n\t\t}\n\t};\n\n\tconst notify = function(key, old, value, meta) {\n\t\tif (waitInQueue) {\n\t\t\tqueue.push([key, old, value, meta]);\n\t\t\treturn;\n\t\t}\n\n\t\tconst list = Object.keys(handlers);\n\t\tfor (let i = 0; i < list.length; i++) {\n\t\t\tconst obj = handlers[list[i]];\n\t\t\tif (!obj) continue;\n\t\t\tif (obj.mask === \"*\" || obj.mask === key) {\n\t\t\t\tobj.handler(value, old, key, meta);\n\t\t\t}\n\t\t}\n\t};\n\n\tObject.defineProperty(out, \"$changes\", {\n\t\tvalue: {\n\t\t\tattachEvent: observe,\n\t\t\tdetachEvent: observeEnd,\n\t\t},\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$observe\", {\n\t\tvalue: observe,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$batch\", {\n\t\tvalue: batch,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$extend\", {\n\t\tvalue: extend,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\n\tout.$extend(data, config);\n\treturn out;\n}\n\nfunction reactive(obj, val, key, notify) {\n\tObject.defineProperty(obj, key, {\n\t\tget: function() {\n\t\t\treturn val;\n\t\t},\n\t\tset: function(value) {\n\t\t\tvar changed = false;\n\t\t\tif (val === null || value === null) {\n\t\t\t\tchanged = val !== value;\n\t\t\t} else {\n\t\t\t\tchanged = val.valueOf() != value.valueOf();\n\t\t\t}\n\n\t\t\tif (changed) {\n\t\t\t\tvar old = val;\n\t\t\t\tval = value;\n\t\t\t\tnotify(key, old, value, context);\n\t\t\t}\n\t\t},\n\t\tenumerable: true,\n\t\tconfigurable: false,\n\t});\n}","// https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Signaling_and_video_calling\n\nfunction reportError(e) {\n\tconsole.error(e);\n}\n\nfunction defer() {\n\tlet resolve;\n\tconst promise = new Promise(res => {\n\t\tresolve = res;\n\t});\n\tpromise.resolve = resolve;\n\treturn promise;\n}\n\nexport default function rtc(sendSignal, rtcConfig, handler, locale, node) {\n\trtcConfig = rtcConfig || {\n\t\ticeServers: [\n\t\t\t{\n\t\t\t\turls: \"stun:turn.webix.com:5349\",\n\t\t\t},\n\t\t\t{\n\t\t\t\turls: \"turn:turn.webix.com:5349\",\n\t\t\t\tusername: \"demo\",\n\t\t\t\tcredential: \"redro43a\",\n\t\t\t},\n\t\t],\n\t};\n\n\tlet conn = new RTCPeerConnection(rtcConfig);\n\tconst ready = defer();\n\n\tconst trigger = obj => {\n\t\tif (obj) handler(obj);\n\t\telse handler({ action: \"streams\", conn });\n\t};\n\n\t// The local ICE layer calls your icecandidate event handler\n\t// when it needs you to transmit an ICE candidate to the other peer\n\tconn.onicecandidate = ev => {\n\t\t// accept candidate\n\t\tif (ev.candidate) {\n\t\t\tsendSignal(\"new-ice-candidate\", ev.candidate);\n\t\t}\n\t};\n\n\t// handler is called by the local WebRTC layer\n\t// when a track is added to the connection\n\tconn.ontrack = () => {\n\t\ttrigger();\n\t};\n\n\t// is called whenever the WebRTC infrastructure needs\n\t// you to start the session negotiation process anew.\n\tconn.onnegotiationneeded = () => {\n\t\tconn\n\t\t\t.createOffer()\n\t\t\t.then(offer => conn.setLocalDescription(offer))\n\t\t\t.then(() => sendSignal(\"offer\", conn.localDescription))\n\t\t\t.catch(reportError);\n\t};\n\n\tconn.oniceconnectionstatechange = () => {\n\t\tswitch (conn.iceConnectionState) {\n\t\t\tcase \"closed\":\n\t\t\tcase \"failed\":\n\t\t\t\tend(true);\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tconn.onicegatheringstatechange = () => {\n\t\tswitch (conn.signalingState) {\n\t\t\tcase \"closed\":\n\t\t\t\tend(true);\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tconst handleGetUserMediaError = (e, type) => {\n\t\t//get user media after call end\n\t\tif (!conn) return;\n\n\t\tswitch (e.name) {\n\t\t\tcase \"NotFoundError\":\n\t\t\t\twebix.alert({\n\t\t\t\t\tcontainer: node,\n\t\t\t\t\ttext:\n\t\t\t\t\t\tlocale(\"Could not find your\") +\n\t\t\t\t\t\t\" \" +\n\t\t\t\t\t\tlocale(type == \"audio\" ? \"microphone\" : \"camera\"),\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase \"SecurityError\":\n\t\t\tcase \"PermissionDeniedError\":\n\t\t\t\tend(true);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\twebix.alert({\n\t\t\t\t\tcontainer: node,\n\t\t\t\t\ttext:\n\t\t\t\t\t\tlocale(\"Error opening your\") +\n\t\t\t\t\t\t\" \" +\n\t\t\t\t\t\tlocale(type == \"audio\" ? \"microphone\" : \"camera\"),\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tconst start = (mode, emode, reset) => {\n\t\tif (reset) sendSignal(\"reset\", \"\");\n\t};\n\n\tconst restart = () => {\n\t\tconn.restartIce();\n\t};\n\n\tconst onOffer = msg => {\n\t\tvar desc = new RTCSessionDescription(msg);\n\t\tif (conn.getSenders().length === 0) {\n\t\t\tconn\n\t\t\t\t.setRemoteDescription(desc)\n\t\t\t\t.then(() => conn.createAnswer())\n\t\t\t\t.then(answer => conn.setLocalDescription(answer))\n\t\t\t\t.then(() => {\n\t\t\t\t\tready.resolve();\n\t\t\t\t\tsendSignal(\"answer\", conn.localDescription);\n\t\t\t\t})\n\t\t\t\t.catch(reportError);\n\t\t} else {\n\t\t\tconn\n\t\t\t\t.setRemoteDescription(desc)\n\t\t\t\t.then(() => conn.createAnswer())\n\t\t\t\t.then(answer => conn.setLocalDescription(answer))\n\t\t\t\t.then(() => {\n\t\t\t\t\tsendSignal(\"answer\", conn.localDescription);\n\t\t\t\t})\n\t\t\t\t.catch(reportError);\n\t\t}\n\t};\n\n\tconst onAnswer = msg => {\n\t\tvar desc = new RTCSessionDescription(msg);\n\t\treturn conn\n\t\t\t.setRemoteDescription(desc)\n\t\t\t.then(() => {\n\t\t\t\tready.resolve();\n\t\t\t})\n\t\t\t.catch(reportError);\n\t};\n\n\tconst onCandidate = msg => {\n\t\tready\n\t\t\t.then(() => {\n\t\t\t\tvar candidate = new RTCIceCandidate(msg);\n\t\t\t\treturn conn.addIceCandidate(candidate);\n\t\t\t})\n\t\t\t.catch(reportError);\n\t};\n\n\tconst end = final => {\n\t\tif (conn) {\n\t\t\tconn.ontrack = null;\n\t\t\tconn.onremovetrack = null;\n\t\t\tconn.onremovestream = null;\n\t\t\tconn.onicecandidate = null;\n\t\t\tconn.oniceconnectionstatechange = null;\n\t\t\tconn.onsignalingstatechange = null;\n\t\t\tconn.onicegatheringstatechange = null;\n\t\t\tconn.onnegotiationneeded = null;\n\t\t\tconn.close();\n\t\t\tconn = null;\n\t\t}\n\n\t\ttrigger({ action: \"end\", final });\n\t};\n\n\tconst status = () => {\n\t\treturn conn && conn.remoteDescription ? 1 : 0;\n\t};\n\n\tconst enable = (kind, mode) => {\n\t\tconst promise = webix.promise.defer();\n\n\t\tlet tracks = conn\n\t\t\t.getSenders()\n\t\t\t.map(a => a.track || {})\n\t\t\t.reduce((p, c) => p.concat(c), []);\n\n\t\ttracks = tracks.filter(a => a.kind === kind);\n\n\t\tif (mode && !tracks.length) {\n\t\t\ttrigger({ action: \"upgrade\", kind, promise });\n\t\t} else {\n\t\t\ttracks.forEach(a => (a.enabled = mode));\n\t\t\tpromise.resolve();\n\t\t}\n\n\t\treturn promise;\n\t};\n\n\tconst mediaValues = {\n\t\taudio: {\n\t\t\techoCancellation: true,\n\t\t\tnoiseSuppression: true,\n\t\t},\n\t\tvideo: {\n\t\t\tfacingMode: \"user\",\n\t\t},\n\t};\n\n\tconst upgrade = (type, promise) => {\n\t\treturn navigator.mediaDevices\n\t\t\t.getUserMedia({ [type]: mediaValues[type] })\n\t\t\t.then(local => {\n\t\t\t\tlocal.getTracks().forEach(track => conn.addTrack(track, local));\n\t\t\t\ttrigger();\n\t\t\t\tpromise.resolve();\n\t\t\t})\n\t\t\t.catch(e => {\n\t\t\t\tpromise.reject();\n\t\t\t\thandleGetUserMediaError(e, type);\n\t\t\t});\n\t};\n\n\treturn {\n\t\tstart,\n\t\tend,\n\t\trestart,\n\t\tstatus,\n\t\tenable,\n\t\tonOffer,\n\t\tonAnswer,\n\t\tupgrade,\n\t\tonCandidate,\n\t};\n}\n","import rtc from \"./rtc\";\n\nfunction setStream(nodes, type, value) {\n\tconst track = value.track;\n\n\tif (!track) return;\n\n\tconst kind = track.kind;\n\tconst tag = nodes[type][kind];\n\n\tconst stream = new MediaStream();\n\tstream.addTrack(track);\n\n\ttag.srcObject = stream;\n}\n\nexport default function phone(\n\tsendSignal,\n\trtcConfig,\n\tnodes,\n\trole,\n\tmode,\n\tlocale,\n\tnode\n) {\n\tmode = webix.extend(mode || {}, {\n\t\taudio: true,\n\t\tvideo: false,\n\t});\n\n\tconst emode = {\n\t\taudio: true,\n\t\tvideo: false,\n\t};\n\n\tlet baseConn;\n\n\tconst handler = ({ action, conn, final, kind, promise }) => {\n\t\tif (action === \"upgrade\") {\n\t\t\tmode[kind] = true;\n\t\t\tbaseConn.upgrade(kind, promise);\n\t\t} else if (action === \"end\") {\n\t\t\tif (nodes.remote.audio.srcObject)\n\t\t\t\tnodes.remote.audio.srcObject.getTracks().forEach(track => track.stop());\n\t\t\tif (nodes.local.audio.srcObject)\n\t\t\t\tnodes.local.audio.srcObject.getTracks().forEach(track => track.stop());\n\t\t\tif (nodes.remote.video.srcObject)\n\t\t\t\tnodes.remote.video.srcObject.getTracks().forEach(track => track.stop());\n\t\t\tif (nodes.local.video.srcObject)\n\t\t\t\tnodes.local.video.srcObject.getTracks().forEach(track => track.stop());\n\n\t\t\tnodes.local.audio.removeAttribute(\"src\");\n\t\t\tnodes.local.audio.removeAttribute(\"srcObject\");\n\t\t\tnodes.remote.audio.removeAttribute(\"src\");\n\t\t\tnodes.remote.audio.removeAttribute(\"srcObject\");\n\t\t\tnodes.local.video.removeAttribute(\"src\");\n\t\t\tnodes.local.video.removeAttribute(\"srcObject\");\n\t\t\tnodes.remote.video.removeAttribute(\"src\");\n\t\t\tnodes.remote.video.removeAttribute(\"srcObject\");\n\n\t\t\tif (final) nodes.end();\n\t\t} else if (action === \"streams\") {\n\t\t\tconn.getSenders().forEach(a => setStream(nodes, \"local\", a));\n\t\t\tconn.getReceivers().forEach(a => setStream(nodes, \"remote\", a));\n\t\t}\n\t};\n\n\tconst events = (type, msg) => {\n\t\tswitch (type) {\n\t\t\tcase \"reset\":\n\t\t\t\tbaseConn.end();\n\t\t\t\tbaseConn = init();\n\t\t\t\tbreak;\n\t\t\tcase \"offer\":\n\t\t\t\tbaseConn.onOffer(msg);\n\t\t\t\tbreak;\n\t\t\tcase \"answer\":\n\t\t\t\tbaseConn.onAnswer(msg);\n\t\t\t\tbreak;\n\t\t\tcase \"new-ice-candidate\":\n\t\t\t\tbaseConn.onCandidate(msg);\n\t\t\t\tbreak;\n\t\t\tcase \"await-offer\":\n\t\t\t\tsendSignal(\"active\", { ...emode });\n\t\t\t\tbaseConn.restart();\n\t\t\t\tbreak;\n\t\t\tcase \"active\":\n\t\t\t\tfor (var key in msg) {\n\t\t\t\t\tconst trigger = nodes.active[\"remote\"]\n\t\t\t\t\t\t? nodes.active[\"remote\"][key]\n\t\t\t\t\t\t: null;\n\t\t\t\t\tif (trigger) trigger(msg[key]);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tconst init = () => {\n\t\tsendSignal(\"active\", { ...emode });\n\t\treturn rtc(sendSignal, rtcConfig, handler, locale, node);\n\t};\n\tbaseConn = init();\n\n\tconst end = () => {\n\t\tif (baseConn) baseConn.end();\n\t};\n\tconst enable = (key, value) => {\n\t\tconst promise = baseConn.enable(key, value);\n\n\t\tpromise\n\t\t\t.then(() => {\n\t\t\t\temode[key] = value;\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\temode[key] = mode[key] = false;\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tsendSignal(\"active\", { ...emode });\n\t\t\t});\n\n\t\treturn promise;\n\t};\n\n\tswitch (role) {\n\t\tcase 1:\n\t\t\tbaseConn.start(mode, emode);\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tsendSignal(\"await-offer\", \"\");\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tbaseConn.start(mode, emode, true);\n\t\t\tbreak;\n\t}\n\n\treturn { events, enable, end };\n}\n","import { JetView } from \"webix-jet\";\nimport { createState } from \"jet-restate\";\n\nimport phone from \"../../libs/phone\";\n\nexport default class CallPanel extends JetView {\n\tconfig() {\n\t\tthis.time = 0;\n\t\tthis.Helpers = this.app.getService(\"helpers\");\n\t\tthis.Back = this.app.getService(\"backend\");\n\t\tthis.callStatuses = this.Back.callStatuses;\n\t\tthis.State = this.getParam(\"state\", true);\n\t\tthis.LocalState = createState({\n\t\t\taudio: true,\n\t\t\tvideo: false,\n\t\t\tremoteVideo: false,\n\t\t\tremoteAudio: false,\n\t\t});\n\t\tthis.Initiator = this.State.callUsers[0] === this.app.config.user;\n\n\t\tif (this.State.callStatus === this.callStatuses[\"active\"]) {\n\t\t\t// loading page while call already active\n\t\t\t// most probably due to page reloading\n\t\t\t// we need to force user to interact with page, or players will not start\n\t\t\tthis.AfterRefresh = true;\n\t\t}\n\n\t\tconst users = this.app.getService(\"local\")._users;\n\n\t\treturn {\n\t\t\ttype: \"clean\",\n\t\t\twidth: this.getParam(\"compact\", true) ? 0 : 380,\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\tcss: \"webix_chat_call\",\n\t\t\t\t\tlocalId: \"fullscreen\",\n\t\t\t\t\trows: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tanimate: false,\n\t\t\t\t\t\t\tborderless: true,\n\t\t\t\t\t\t\tcells: [this.GetAudioConfig(users), this.GetVideoConfig()],\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tborderless: true,\n\t\t\t\t\t\t\tcss: \"webix_chat_video webix_chat_audio\",\n\t\t\t\t\t\t\tminHeight: 96,\n\t\t\t\t\t\t\tgravity: 0.0001,\n\t\t\t\t\t\t\ttemplate: `\n\t\t\t\t\t\t\t\t<div style=\"position: relative; width: 100%; height: 100%;\">\n\t\t\t\t\t\t\t\t\t<div class=\"webix_chat_video_remote\">\n\t\t\t\t\t\t\t\t\t\t<audio autoplay></audio>\n\t\t\t\t\t\t\t\t\t\t<video autoplay playsinline></video>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class=\"webix_chat_video_local\">\n\t\t\t\t\t\t\t\t\t\t<audio autoplay></audio>\n\t\t\t\t\t\t\t\t\t\t<video autoplay playsinline></video>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t${this.Helpers.avatar(\n\t\t\t\t\t\t\t\t\t\tusers.getItem(this.app.config.user),\n\t\t\t\t\t\t\t\t\t\t\"webix_chat_video_local_avatar\"\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`,\n\t\t\t\t\t\t\tlocalId: \"connection\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\tthis.GetActionsConfig(),\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tinit() {\n\t\tconst video = this.$$(\"connection\").$view;\n\t\tthis.localVideo = video.querySelector(\".webix_chat_video_local\");\n\t\tthis.localAvatar = video.querySelector(\".webix_chat_video_local_avatar\");\n\t\tthis.remoteVideo = video.querySelector(\".webix_chat_video_remote\");\n\n\t\tthis.on(this.Back.pubsub(), \"signal\", ({ msg, type }) => {\n\t\t\t// do nothing, until user confirms that they want to join the call\n\t\t\tif (this.AfterRefresh) return;\n\n\t\t\tif (msg) msg = JSON.parse(msg);\n\t\t\tif (this.Phone) this.Phone.events(type, msg);\n\t\t});\n\n\t\tthis.on(this.app, \"updateCallTime\", time => this.UpdateCallTime(time));\n\n\t\tthis.on(this.State.$changes, \"callStatus\", status =>\n\t\t\tthis.HandleCallStatusChange(status)\n\t\t);\n\n\t\tthis.on(this.LocalState.$changes, \"remoteVideo\", () => this.ShowVideo());\n\t}\n\n\t/**\n\t * Returns an audio config\n\t * @param {Object} users - users collection\n\t * @returns {Object} configuration for the audio call\n\t */\n\tGetAudioConfig(users) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn {\n\t\t\tlocalId: \"audio\",\n\t\t\ttype: \"clean\",\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\tcss: \"webix_chat_audio_time\",\n\t\t\t\t\tlocalId: \"audio-timer\",\n\t\t\t\t\tbatch: \"active\",\n\t\t\t\t\theight: 56,\n\t\t\t\t\ttemplate: () => {\n\t\t\t\t\t\treturn `${_(\"Active call\")} (${this.Helpers.normalizeTime(\n\t\t\t\t\t\t\tthis.time\n\t\t\t\t\t\t)})`;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tgravity: 0.0001,\n\t\t\t\t\tcss: \"webix_chat_audio\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\theight: 270,\n\t\t\t\t\tcss: \"webix_chat_audio\",\n\t\t\t\t\ttemplate: () => {\n\t\t\t\t\t\tconst user = users.getItem(\n\t\t\t\t\t\t\tthis.State.callUsers[this.Initiator ? 1 : 0]\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst avatar = this.Helpers.avatar(\n\t\t\t\t\t\t\tuser,\n\t\t\t\t\t\t\t\"webix_chat_call_avatar webix_chat_avatar\"\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\tavatar + \"<p class='webix_chat_call_name'>\" + user.name + \"</p>\"\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tbatch: \"outgoing\",\n\t\t\t\t\tcss: \"webix_chat_audio\",\n\t\t\t\t\theight: 30,\n\t\t\t\t\ttemplate: _(\"Ringing\"),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tbatch: \"income\",\n\t\t\t\t\tcss: \"webix_chat_audio\",\n\t\t\t\t\theight: 30,\n\t\t\t\t\ttemplate: _(\"Is calling you\"),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tbatch: \"income\",\n\t\t\t\t\theight: 42,\n\t\t\t\t\tcss: \"webix_chat_audio\",\n\t\t\t\t\tcols: [\n\t\t\t\t\t\t{},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"button\",\n\t\t\t\t\t\t\theight: 0,\n\t\t\t\t\t\t\twidth: 86,\n\t\t\t\t\t\t\tvalue: _(\"Accept\"),\n\t\t\t\t\t\t\tcss: \"webix_chat_accept\",\n\t\t\t\t\t\t\tclick: () => this.AcceptCall(),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"button\",\n\t\t\t\t\t\t\twidth: 86,\n\t\t\t\t\t\t\tvalue: _(\"Reject\"),\n\t\t\t\t\t\t\tcss: \"webix_danger\",\n\t\t\t\t\t\t\tclick: () => this.RejectCall(),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tbatch: \"refresh\",\n\t\t\t\t\theight: 42,\n\t\t\t\t\tcss: \"webix_chat_audio\",\n\t\t\t\t\tcols: [\n\t\t\t\t\t\t{},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"button\",\n\t\t\t\t\t\t\theight: 0,\n\t\t\t\t\t\t\twidth: 86,\n\t\t\t\t\t\t\tvalue: _(\"Join call\"),\n\t\t\t\t\t\t\tcss: \"webix_chat_accept\",\n\t\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\t\tthis.AfterRefresh = false;\n\t\t\t\t\t\t\t\tthis.Start(true);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"button\",\n\t\t\t\t\t\t\twidth: 86,\n\t\t\t\t\t\t\tvalue: _(\"End call\"),\n\t\t\t\t\t\t\tcss: \"webix_danger\",\n\t\t\t\t\t\t\tclick: () => this.EndCall(),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tgravity: 0.0001,\n\t\t\t\t\tcss: \"webix_chat_audio\",\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\t/**\n\t * Returns a video config\n\t * @param {Object} users - users collection\n\t * @returns {Object} configuration for the video call\n\t */\n\tGetVideoConfig() {\n\t\treturn {\n\t\t\tlocalId: \"video\",\n\t\t\ttype: \"clean\",\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\tcss: \"webix_chat_video_time\",\n\t\t\t\t\theight: 56,\n\t\t\t\t\ttype: \"clean\",\n\t\t\t\t\tcols: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlocalId: \"video-timer\",\n\t\t\t\t\t\t\ttemplate: () => {\n\t\t\t\t\t\t\t\treturn this.Helpers.normalizeTime(this.time);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"icon\",\n\t\t\t\t\t\t\tlocalId: \"fullscreen-icon\",\n\t\t\t\t\t\t\ticon: \"chi-fullscreen\",\n\t\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\t\tthis.SetFullscreen(!this.fullscreen);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{ width: 6 },\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\t/**\n\t * Returns configuration for the actions buttons\n\t * @returns {Object} config object of the actions controls (buttons, toggles, etc.)\n\t */\n\tGetActionsConfig() {\n\t\treturn {\n\t\t\theight: 80,\n\t\t\tcss: \"webix_chat_call_actions\",\n\t\t\tlocalId: \"call-actions\",\n\t\t\trows: [\n\t\t\t\t{},\n\t\t\t\t{\n\t\t\t\t\theight: 44,\n\t\t\t\t\tcols: [\n\t\t\t\t\t\t{},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"toggle\",\n\t\t\t\t\t\t\ttype: \"icon\",\n\t\t\t\t\t\t\toffIcon: \"chi-video-off\",\n\t\t\t\t\t\t\tonIcon: \"chi-video\",\n\t\t\t\t\t\t\tlocalId: \"video-toggle\",\n\t\t\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\t\t\twidth: 44,\n\t\t\t\t\t\t\tclick: () => this.EnableVideo(true),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{ width: 32 },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"toggle\",\n\t\t\t\t\t\t\ttype: \"icon\",\n\t\t\t\t\t\t\toffIcon: \"chi-audio-off\",\n\t\t\t\t\t\t\tonIcon: \"chi-audio\",\n\t\t\t\t\t\t\tlocalId: \"audio-toggle\",\n\t\t\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\t\t\twidth: 44,\n\t\t\t\t\t\t\tvalue: true,\n\t\t\t\t\t\t\tclick: () => this.EnableAudio(true),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{ width: 32 },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"button\",\n\t\t\t\t\t\t\ttype: \"icon\",\n\t\t\t\t\t\t\ticon: \"chi-hangup\",\n\t\t\t\t\t\t\tcss: \"webix_danger\",\n\t\t\t\t\t\t\twidth: 44,\n\t\t\t\t\t\t\tclick: () => this.EndCall(),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t],\n\t\t};\n\t}\n\n\t/**\n\t * Manages visual parts of a call (view, controls, etc.)\n\t * @param {string} type - call type (\"video\", \"audio\")\n\t * @param {string} batch - shows whether the call is \"incoming\" or \"outgoing\"\n\t * @param {boolean} actions - defines whether to show action controls panel\n\t */\n\tControlVisibility(type, batch, actions) {\n\t\tconst view = this.$$(type);\n\t\tview.show();\n\t\tif (batch) view.showBatch(batch);\n\n\t\tthis.$$(\"call-actions\")[actions ? \"show\" : \"hide\"]();\n\t}\n\n\t/**\n\t * Sets fullscreen for a call\n\t * @param {boolean} fullscreen - defines whether the fullscreen should be enabled\n\t */\n\tSetFullscreen(fullscreen) {\n\t\twebix.fullscreen.exit();\n\n\t\tconst icon = this.$$(\"fullscreen-icon\");\n\t\ticon.config.icon = \"chi-fullscreen\" + (fullscreen ? \"-off\" : \"\");\n\t\ticon.refresh();\n\n\t\tthis.fullscreen = fullscreen\n\t\t\t? webix.fullscreen.set(this.$$(\"fullscreen\"), {\n\t\t\t\t\thead: false,\n\t\t\t\t\tcss: \"webix_chat_video_fullscreen\",\n\t\t\t  })\n\t\t\t: null;\n\t}\n\n\t/**\n\t * Starts a call\n\t * @param {boolean} isAfterRefresh - shows whether a call is resumed after a page refresh\n\t */\n\tStart(isAfterRefresh) {\n\t\tif (this.AfterRefresh) {\n\t\t\tthis.ControlVisibility(\"audio\", \"refresh\", false);\n\t\t} else {\n\t\t\tthis.ControlVisibility(\"audio\", \"active\", true);\n\t\t\tthis.InitPhone(this.Initiator, isAfterRefresh);\n\n\t\t\tif (this.LocalState.audio) this.EnableAudio();\n\n\t\t\tif (this.LocalState.video) this.EnableVideo();\n\t\t}\n\t}\n\n\t/**\n\t *\n\t * @param {boolean} isInitiator - shows whether the current user is the call initiator\n\t * @param {boolean} isAfterRefresh - shows whether a call is resumed after a page refresh\n\t */\n\tInitPhone(isInitiator, isAfterRefresh) {\n\t\tconst alist = this.$$(\"connection\").$view.querySelectorAll(\"audio\");\n\t\tconst vlist = this.$$(\"connection\").$view.querySelectorAll(\"video\");\n\t\tthis.Phone = phone(\n\t\t\tthis.SendSignal.bind(this),\n\t\t\tthis.app.config.rtcConfig || null,\n\t\t\t{\n\t\t\t\tlocal: { audio: alist[1], video: vlist[1] },\n\t\t\t\tremote: { audio: alist[0], video: vlist[0] },\n\t\t\t\tactive: {\n\t\t\t\t\tremote: {\n\t\t\t\t\t\tvideo: v => (this.LocalState.remoteVideo = v),\n\t\t\t\t\t\taudio: v => (this.LocalState.remoteAudio = v),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tend: () => this.EndCall(),\n\t\t\t},\n\t\t\tisInitiator ? (isAfterRefresh ? 3 : 1) : isAfterRefresh ? 2 : 4,\n\t\t\t{ video: this.LocalState.video, audio: this.LocalState.audio },\n\t\t\tthis.app.getService(\"locale\")._,\n\t\t\tthis.app.getRoot().$view\n\t\t);\n\t}\n\n\t/**\n\t * Ends a call\n\t */\n\tEndCall() {\n\t\tthis.SetFullscreen(false);\n\t\tthis.getParam(\"state\", true).callStatus = this.callStatuses[\"drop\"];\n\n\t\tif (this.Phone) {\n\t\t\tthis.Phone.end();\n\t\t\tthis.Phone = null;\n\t\t\tthis.Back.updateCall(this.State.callId, this.callStatuses[\"end\"]);\n\t\t} else {\n\t\t\tthis.Back.updateCall(this.State.callId, this.callStatuses[\"ignore\"]);\n\t\t}\n\t}\n\n\t/**\n\t * Accepts an incoming call\n\t */\n\tAcceptCall() {\n\t\tthis.Back.updateCall(this.State.callId, this.callStatuses[\"accept\"]);\n\t}\n\n\t/**\n\t * Rejects an incoming call\n\t */\n\tRejectCall() {\n\t\tthis.getParam(\"state\", true).callStatus = this.callStatuses[\"drop\"];\n\t\tthis.Back.updateCall(this.State.callId, this.callStatuses[\"reject\"]);\n\t}\n\n\t/**\n\t * Sends a signal to back\n\t * @param {string} type - signal type (\"reset\", \"offer\", \"answer\", etc.)\n\t * @param {Object} payload - RTCIceCandidate object\n\t * @returns {Object} an object containing the signal data\n\t */\n\tSendSignal(type, payload) {\n\t\t// rtc handler can trigger callback when view already destroyed\n\t\tif (this.app) {\n\t\t\tif (typeof payload !== \"string\") payload = JSON.stringify(payload);\n\t\t\treturn this.Back.signalCall(type, payload);\n\t\t}\n\t}\n\n\t/**\n\t * Toggles audio during the call\n\t * @param {boolean} toggle - true, if audio has been toggled\n\t */\n\tEnableAudio(toggle) {\n\t\tconst v = toggle\n\t\t\t? (this.LocalState.audio = !this.LocalState.audio)\n\t\t\t: this.LocalState.audio;\n\t\tif (this.Phone) {\n\t\t\tthis.Phone.enable(\"audio\", v).catch(() => {\n\t\t\t\tthis.LocalState.audio = false;\n\t\t\t\tthis.$$(\"audio-toggle\").setValue(false);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Toggles video during the call\n\t * @param {boolean} toggle - true, if video has been toggled\n\t */\n\tEnableVideo(toggle) {\n\t\tconst v = toggle\n\t\t\t? (this.LocalState.video = !this.LocalState.video)\n\t\t\t: this.LocalState.video;\n\t\tif (this.Phone) {\n\t\t\tthis.Phone.enable(\"video\", v)\n\t\t\t\t.catch(() => {\n\t\t\t\t\tthis.LocalState.video = false;\n\t\t\t\t\tthis.$$(\"video-toggle\").setValue(false);\n\t\t\t\t})\n\t\t\t\t.finally(() => {\n\t\t\t\t\tthis.ShowVideo();\n\t\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Toggles video block\n\t */\n\tCheckVideoVisibility() {\n\t\tconst remote = this.LocalState.remoteVideo;\n\t\tconst local = this.LocalState.video;\n\n\t\tlet visibility = [\"none\", \"none\", \"none\"];\n\t\tif (remote) {\n\t\t\tif (local) visibility = [\"none\", \"block\", \"block\"];\n\t\t\telse visibility = [\"block\", \"none\", \"block\"];\n\t\t} else if (local) visibility = [\"none\", \"block\", \"none\"];\n\n\t\t[this.localAvatar, this.localVideo, this.remoteVideo].forEach((node, i) => {\n\t\t\tnode.style.display = visibility[i];\n\t\t});\n\t}\n\n\t/**\n\t * Updates call time\n\t * @param {number} time - time in seconds\n\t */\n\tUpdateCallTime(time) {\n\t\tthis.time = time;\n\t\tif (this.fullscreen)\n\t\t\tthis.fullscreen.queryView({ localId: \"video-timer\" }).refresh();\n\t\telse if (this.$$(\"audio-timer\").isVisible())\n\t\t\tthis.$$(\"audio-timer\").refresh();\n\t\telse if (this.$$(\"video-timer\").isVisible())\n\t\t\tthis.$$(\"video-timer\").refresh();\n\t}\n\n\t/**\n\t * Tracks changes of the call status\n\t * @param {number} status - status code (1, 2, 3, 900, and other )\n\t * https://docs.webix.com/chat__backend.html#updatecall for details\n\t */\n\tHandleCallStatusChange(status) {\n\t\tif (status == this.callStatuses[\"init\"]) {\n\t\t\tthis.ControlVisibility(\n\t\t\t\t\"audio\",\n\t\t\t\tthis.Initiator ? \"outgoing\" : \"income\",\n\t\t\t\tthis.Initiator\n\t\t\t);\n\t\t} else if (status == this.callStatuses[\"active\"]) {\n\t\t\tthis.Start();\n\t\t} else if (\n\t\t\tstatus == this.callStatuses[\"reject\"] ||\n\t\t\tstatus == this.callStatuses[\"end\"] ||\n\t\t\tstatus == this.callStatuses[\"ignore\"] ||\n\t\t\tstatus == this.callStatuses[\"lost\"]\n\t\t) {\n\t\t\tif (this.Phone) {\n\t\t\t\tthis.SetFullscreen(false);\n\t\t\t\tthis.Phone.end();\n\t\t\t\tthis.Phone = null;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Shows video if the functionality is available\n\t */\n\tShowVideo() {\n\t\tif (\n\t\t\tthis.State.callStatus == this.callStatuses[\"active\"] &&\n\t\t\t!this.AfterRefresh\n\t\t) {\n\t\t\tconst remote = this.LocalState.remoteVideo;\n\t\t\tconst audio = !this.LocalState.video && !remote;\n\n\t\t\tif (audio || !remote) {\n\t\t\t\tthis.SetFullscreen(false);\n\t\t\t\tthis.ControlVisibility(\"audio\", \"active\", true);\n\t\t\t} else if (!this.fullscreen) this.ControlVisibility(\"video\", \"\", true);\n\n\t\t\tthis.CheckVideoVisibility();\n\t\t}\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class FormView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst helpers = this.app.getService(\"helpers\");\n\n\t\tconst avatarInput = {\n\t\t\tview: \"forminput\",\n\t\t\tname: \"avatar\",\n\t\t\tbody: {\n\t\t\t\tlocalId: \"avatar\",\n\t\t\t\tcss: \"webix_chat_form_avatar\",\n\t\t\t\twidth: 130,\n\t\t\t\theight: 130,\n\t\t\t\tborderless: true,\n\t\t\t\ttemplate: data => {\n\t\t\t\t\treturn helpers.formAvatar(data, _(\"Change avatar\"));\n\t\t\t\t},\n\t\t\t\tonClick: {\n\t\t\t\t\twebix_chat_avatar: () => {\n\t\t\t\t\t\tlet upload = this.app.getService(\"upload\");\n\t\t\t\t\t\tupload.fileDialog();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tconst nameInput = {\n\t\t\tname: \"name\",\n\t\t\tlocalId: \"name\",\n\t\t\tinputAlign: \"center\",\n\t\t\tview: \"text\",\n\t\t\twidth: 300,\n\t\t\tplaceholder: _(\"Chat name\"),\n\t\t\ton: {\n\t\t\t\tonChange: v => {\n\t\t\t\t\tthis.NameChangedHandler(v);\n\t\t\t\t},\n\t\t\t\tonTimedKeyPress: () => {\n\t\t\t\t\tthis.NameChangedHandler(this.$$(\"name\").getValue());\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tconst form = {\n\t\t\tpadding: 20,\n\t\t\tmargin: 20,\n\t\t\telementsConfig: {\n\t\t\t\tlabelWidth: 130,\n\t\t\t\tlabelAlign: \"right\",\n\t\t\t},\n\t\t\tview: \"form\",\n\t\t\tlocalId: \"form\",\n\t\t\tcss: \"webix_chat_newchat_form\",\n\t\t\telements: [\n\t\t\t\t{ align: \"center\", body: avatarInput },\n\t\t\t\t{ align: \"center\", body: nameInput },\n\t\t\t\t{},\n\t\t\t],\n\t\t};\n\n\t\treturn form;\n\t}\n\n\tinit() {\n\t\tconst { name, avatar, chat } = this.getParam(\"state\", true);\n\t\tthis.$$(\"form\").setValues({ name, avatar: { avatar } });\n\n\t\t// uploader events\n\t\tconst upload = this.app.getService(\"upload\").getUploader(chat);\n\t\tthis.on(upload, \"onAfterFileAdd\", data => {\n\t\t\tthis.UpdateAvatar(data);\n\t\t});\n\t\tthis.on(upload, \"onUploadComplete\", data => {\n\t\t\tthis.UpdateAvatar(data);\n\t\t});\n\t}\n\n\tready() {\n\t\twebix.delay(() => {\n\t\t\tthis.$$(\"name\").focus();\n\t\t});\n\t}\n\n\t/**\n\t * Updates chat avatar with a specified picture\n\t * @param {Object} data - File interface for the uploaded picture\n\t */\n\tUpdateAvatar(data) {\n\t\tif (data.status === \"client\" && data.file) {\n\t\t\t// client-side preview\n\t\t\tconst reader = new FileReader();\n\t\t\treader.onload = () => {\n\t\t\t\tthis.SetLocalAvatar(reader.result);\n\t\t\t};\n\t\t\treader.readAsDataURL(data.file);\n\t\t} else if (data.status === \"server\") {\n\t\t\t// refresh picture after uploading, update data in form\n\t\t\tconst avatar = data.value;\n\t\t\tthis.$$(\"form\").setValues({ avatar }, true);\n\t\t\tthis.AvatarChangedHandler(avatar);\n\t\t\tthis.SetLocalAvatar(avatar);\n\t\t}\n\t}\n\n\t/**\n\t * Sets avatar from a local path\n\t * @param {string} avatar - path to a local picture\n\t */\n\tSetLocalAvatar(avatar) {\n\t\tthis.$$(\"avatar\").setValues({ avatar });\n\t}\n\n\t/**\n\t * Sets initial values for the chat name and avatar\n\t */\n\tSetInitValues() {\n\t\tlet state = this.getParam(\"state\", true);\n\t\tconst { name, avatar } = state.values.form;\n\t\tif (name || avatar) {\n\t\t\tthis.$$(\"form\").setValues({ name, avatar: { avatar } });\n\t\t}\n\t}\n\n\tNameChangedHandler() {}\n\n\tAvatarChangedHandler() {}\n}\n","import { checkedIcon, notCheckedIcon } from \"./icons\";\n\nwebix.ui.datafilter.umMasterCheckox = webix.extend(\n\t{\n\t\trefresh: function(master, node, config) {\n\t\t\tnode.onclick = function() {\n\t\t\t\tconfig.checked = !config.checked;\n\t\t\t\tlet elem = node.querySelector(\".webix_icon\");\n\t\t\t\telem.className =\n\t\t\t\t\t\"webix_icon wxi-checkbox-\" + (config.checked ? \"marked\" : \"blank\");\n\t\t\t\tmaster.data.each(obj => (obj[config.columnId] = config.checked));\n\t\t\t\tmaster.refresh();\n\t\t\t\tmaster.callEvent(\"onCustomSave\", []);\n\t\t\t};\n\t\t},\n\t\trender: function(master, config) {\n\t\t\treturn config.checked ? checkedIcon : notCheckedIcon;\n\t\t},\n\t},\n\twebix.ui.datafilter.masterCheckbox\n);\n","export const checkedIcon =\n\t\"<span class='webix_icon wxi-checkbox-marked'></span>\";\nexport const notCheckedIcon =\n\t\"<span class='webix_icon wxi-checkbox-blank'></span>\";\n","import { JetView } from \"webix-jet\";\nimport \"../../../helpers/customcheckbox\";\n\nexport default class PeopleView extends JetView {\n\tconfig() {\n\t\tconst selectedList = {\n\t\t\tbatch: \"selected\",\n\t\t\tview: \"template\",\n\t\t\tlocalId: \"selected\",\n\t\t\tscroll: \"x\",\n\t\t\ttemplate: \"\",\n\t\t\tborderless: true,\n\t\t};\n\n\t\tconst material =\n\t\t\twebix.skin.$name == \"material\" || webix.skin.$name == \"mini\";\n\t\tselectedList.height = 80 + (material ? 8 : 10) + webix.env.scrollSize; // item height + paddings + scroll\n\n\t\tconst table = {\n\t\t\tview: \"datatable\",\n\t\t\tlocalId: \"table\",\n\t\t\tcss: \"webix_chat_people_table\",\n\t\t\trowHeight: 60,\n\t\t\theaderRowHeight: Math.max(webix.skin.$active.barHeight - 2, 44),\n\t\t\tcolumns: this.GetColumns(),\n\t\t\tscheme: {\n\t\t\t\t$sort: {\n\t\t\t\t\tby: \"name\",\n\t\t\t\t\tdir: \"asc\",\n\t\t\t\t},\n\t\t\t},\n\t\t\tcheckboxRefresh: true,\n\t\t\ton: {\n\t\t\t\tonItemClick: id => this.Toggle(id.row * 1),\n\t\t\t\tonCustomSave: () => this.UpdatePeopleList(),\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\tvisibleBatch: \"default\",\n\t\t\trows: [selectedList, table],\n\t\t};\n\t}\n\n\tinit() {\n\t\tconst users = this.app.getService(\"local\").users();\n\t\tconst table = this.$$(\"table\");\n\t\tthis.Users = [].concat(this.getParam(\"state\", true).users);\n\n\t\t// to work with data copy\n\t\tthis.UsersStore = new webix.DataCollection({\n\t\t\tdata: [],\n\t\t});\n\t\tthis.UsersStore.data.attachEvent(\"onSyncApply\", () => {\n\t\t\ttable.clearAll();\n\t\t\ttable.parse(\n\t\t\t\tthis.UsersStore.data\n\t\t\t\t\t.serialize()\n\t\t\t\t\t.map(({ id, name, avatar, status }) => {\n\t\t\t\t\t\treturn { id, name, avatar, status };\n\t\t\t\t\t})\n\t\t\t\t\t.filter(a => a.id !== this.app.config.user)\n\t\t\t);\n\t\t\ttable.sort((a, b) => this.SortUsers(a, b));\n\t\t\tthis.LoadPeopleList();\n\t\t});\n\n\t\tthis.UsersStore.sync(users);\n\t}\n\tdestroy() {\n\t\tthis.UsersStore.destructor();\n\t\tthis.UsersStore = null;\n\t}\n\n\t/**\n\t * Retrieves columns with selected users and full list of users to select\n\t * @returns {Array} an array of column objects\n\t */\n\tGetColumns() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst helpers = this.app.getService(\"helpers\");\n\t\treturn [\n\t\t\t{\n\t\t\t\tid: \"selected\",\n\t\t\t\theader: {\n\t\t\t\t\tcontent: \"textFilter\",\n\t\t\t\t\tplaceholder: _(\"Search\"),\n\t\t\t\t\tcolspan: 2,\n\t\t\t\t\tprepare: a => a.toLowerCase(),\n\t\t\t\t\tcompare: this.GetCompare(),\n\t\t\t\t},\n\t\t\t\twidth: 45,\n\t\t\t\tcssFormat: (_, obj) => {\n\t\t\t\t\tif (obj.selected) {\n\t\t\t\t\t\tlet isGroupUser = this.Users.indexOf(obj.id) >= 0;\n\t\t\t\t\t\treturn \"webix_chat_row_\" + (isGroupUser ? \"group_user\" : \"select\");\n\t\t\t\t\t}\n\t\t\t\t\treturn \"\";\n\t\t\t\t},\n\t\t\t\ttemplate: obj => {\n\t\t\t\t\treturn obj.selected ? helpers.checkedIcon : helpers.notCheckedIcon;\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: \"name\",\n\t\t\t\theader: \"\",\n\t\t\t\ttemplate: user =>\n\t\t\t\t\thelpers.listAvatar(user, \"webix_chat_people_avatar\") + user.name,\n\t\t\t\tfillspace: 2,\n\t\t\t\tcssFormat: (_, obj) => {\n\t\t\t\t\tif (obj.selected) {\n\t\t\t\t\t\tlet isGroupUser = this.Users.indexOf(obj.id) >= 0;\n\t\t\t\t\t\treturn \"webix_chat_row_\" + (isGroupUser ? \"group_user\" : \"select\");\n\t\t\t\t\t}\n\t\t\t\t\treturn \"\";\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\t}\n\n\t/**\n\t * Compares data from the search field with the user names\n\t * @returns {boolean} true, if user name matches the entered data\n\t */\n\tGetCompare() {\n\t\treturn (value, searchValue, user) => {\n\t\t\treturn user.name.toLowerCase().indexOf(searchValue) > -1;\n\t\t};\n\t}\n\n\t/**\n\t *\n\t * @param {Array} selected - contains objects of the selected users\n\t * @returns {string} a string with an HTML markup for people list\n\t */\n\tGetPeopleList(selected) {\n\t\tselected.sort((a, b) => this.SortUsers(a, b));\n\t\treturn this.app\n\t\t\t.getService(\"helpers\")\n\t\t\t.peopleList(selected, false, this.Users);\n\t}\n\n\t/**\n\t * Sorts users list by id\n\t * @param {Object} a - user data\n\t * @param {Object} b - user data\n\t * @returns {number} 1 to place \"a\" object first, -1 to place \"b\" object first\n\t */\n\tSortUsers(a, b) {\n\t\tconst ai = this.Users.indexOf(a.id);\n\t\tconst bi = this.Users.indexOf(b.id);\n\n\t\t// previously added first\n\t\tif (ai >= 0 && bi < 0) return 1;\n\t\tif (bi >= 0 && ai < 0) return -1;\n\t\treturn a.name > b.name ? 1 : a.name < b.name ? -1 : 0;\n\t}\n\n\t/**\n\t * Toggles the user selection\n\t * @param {number} id - user ID\n\t */\n\tToggle(id) {\n\t\tconst table = this.$$(\"table\");\n\t\tconst item = table.getItem(id);\n\t\ttable.updateItem(id, { selected: !item.selected });\n\t\tthis.UpdatePeopleList();\n\t}\n\n\t/**\n\t * Updates users lists on every selection toggle\n\t */\n\tUpdatePeopleList() {\n\t\tlet selected = this.GetSelected();\n\t\tthis.SetBatch(selected.length ? \"selected\" : \"default\");\n\t\tlet html = this.GetPeopleList(selected);\n\t\tthis.$$(\"selected\").setHTML(html);\n\t\tlet state = this.getParam(\"state\", true);\n\t\tstate.users = this.GetSelectedIds();\n\t}\n\n\t/**\n\t * Populates users list and builds a dedicated HTML markup\n\t */\n\tLoadPeopleList() {\n\t\tlet state = this.getParam(\"state\", true);\n\t\tlet ids = state.users.filter(a => a !== this.app.config.user);\n\n\t\tif (ids && ids.length) {\n\t\t\tlet users = [];\n\t\t\tids.forEach(id => {\n\t\t\t\tlet item = this.$$(\"table\").getItem(id);\n\t\t\t\tusers.push(item);\n\t\t\t\titem.selected = true;\n\t\t\t});\n\t\t\tthis.SetBatch(\"selected\");\n\t\t\tlet html = this.GetPeopleList(users);\n\t\t\tthis.$$(\"selected\").setHTML(html);\n\t\t}\n\t}\n\n\t/**\n\t * Returns an array containing data objects of the selected users\n\t * @returns {Array<Object>} contains objects of the selected users\n\t */\n\tGetSelected() {\n\t\tlet selected = [];\n\t\tthis.$$(\"table\").data.each(row => {\n\t\t\tif (row.selected) selected.push(row);\n\t\t});\n\t\treturn selected;\n\t}\n\n\t/**\n\t * Returns an array containing IDs of the selected users\n\t * @returns {Array<number>} an array of ID of the selected users\n\t */\n\tGetSelectedIds() {\n\t\tlet selected = [];\n\t\tthis.$$(\"table\").data.each(row => {\n\t\t\tif (row.selected) selected.push(row.id);\n\t\t});\n\t\treturn selected;\n\t}\n\n\t/**\n\t * Sets a specified batch or \"default\"\n\t * @param {string} batch - batch text\n\t */\n\tSetBatch(batch) {\n\t\tif (batch) this.getRoot().showBatch(batch);\n\t\telse this.getRoot().showBatch(\"default\");\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class Toolbar extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"toolbar\",\n\t\t\theight: Math.max(webix.skin.$active.toolbarHeight, 46),\n\t\t\tborderless: true,\n\t\t\tcols: [],\n\t\t};\n\t}\n\n\tinit() {\n\t\tlet state = this.getParam(\"state\", true);\n\t\tthis.on(state.$changes, \"toolbar\", () => {\n\t\t\tconst cols = state.toolbar.cols.map(a => this.ButtonFactory(a, state));\n\t\t\tthis.webix.ui(cols, this.getRoot());\n\t\t});\n\t}\n\n\t/**\n\t * Defines a state object\n\t * @typedef {Object} State\n\t * @property {string} avatar - chat/user avatar\n\t * @property {number} chat - chat ID\n\t * @property {number} cursor -\n\t * @property {boolean} group - true, if chat is a group one\n\t * @property {string} name - chat title\n\t * @property {Object} toolbar - an object containing a toolbar label and\n\t * an array of toolbar cols\n\t * @property {Array<number>} users - an array with user IDs\n\t * @todo what is cursor?\n\t */\n\t/**\n\t * Returns a button config depending on the provided name (id)\n\t * @param {string} id - button name\n\t * @param {State} state - object with state data\n\t * @returns {Object} button configuration\n\t */\n\tButtonFactory(id, state) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tswitch (id) {\n\t\t\tcase \"close\":\n\t\t\t\treturn {\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"wxi-close\",\n\t\t\t\t\thotkey: \"esc\",\n\t\t\t\t\twidth: Math.max(webix.skin.$active.inputHeight, 38),\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tstate.cursor = 0;\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\tcase \"back\":\n\t\t\t\treturn {\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"chi-back\",\n\t\t\t\t\twidth: Math.max(webix.skin.$active.inputHeight, 38),\n\t\t\t\t\thotkey: \"esc\",\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tstate.cursor = state.cursor - 1;\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\tcase \"start\":\n\t\t\t\treturn {\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"chi-back\",\n\t\t\t\t\twidth: Math.max(webix.skin.$active.inputHeight, 38),\n\t\t\t\t\thotkey: \"esc\",\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tthis.app.callEvent(\"wizardStart\", []);\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\tcase \"label\":\n\t\t\t\treturn {\n\t\t\t\t\tview: \"label\",\n\t\t\t\t\tcss: \"webix_chat_wizard_title\",\n\t\t\t\t\tlabelAlign: \"center\",\n\t\t\t\t\tlabel:\n\t\t\t\t\t\ttypeof state.toolbar.label === \"function\"\n\t\t\t\t\t\t\t? state.toolbar.label()\n\t\t\t\t\t\t\t: state.toolbar.label,\n\t\t\t\t};\n\n\t\t\tcase \"edit\":\n\t\t\t\treturn {\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"wxi-pencil\",\n\t\t\t\t\twidth: Math.max(webix.skin.$active.inputHeight, 38),\n\t\t\t\t\tbatch: \"m1\",\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tstate.cursor = state.cursor + 1;\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\tcase \"save\":\n\t\t\t\treturn {\n\t\t\t\t\tbatch: \"m2\",\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\tlabel: _(\"Save\"),\n\t\t\t\t\thotkey: \"enter\",\n\t\t\t\t\twidth: 130,\n\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tthis.app.callEvent(\"wizardSave\", []);\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t}\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport { createState } from \"jet-restate\";\nimport Toolbar from \"./toolbar\";\n\nexport default class BaseWindow extends JetView {\n\tconfig() {\n\t\treturn this.app.getService(\"jet-win\").updateConfig({\n\t\t\tview: \"window\",\n\t\t\tfullscreen: this.getParam(\"compact\", true),\n\t\t\twidth: 450,\n\t\t\theight: 600,\n\t\t\tborderless: true,\n\t\t\thead: Toolbar,\n\t\t\tbody: {\n\t\t\t\t$subview: true,\n\t\t\t},\n\t\t});\n\t}\n\tinit() {\n\t\tconst id = this.getParam(\"id\") || 0;\n\t\tconst chat = id\n\t\t\t? this.app\n\t\t\t\t\t.getService(\"local\")\n\t\t\t\t\t.chats()\n\t\t\t\t\t.getItem(id)\n\t\t\t: {\n\t\t\t\t\tid: 0,\n\t\t\t\t\tname: \"\",\n\t\t\t\t\tusers: [],\n\t\t\t\t\tavatar: \"\",\n\t\t\t  };\n\t\tconst messageId = this.getParam(\"msgId\") || 0;\n\t\tlet state = createState({\n\t\t\tcursor: 1,\n\t\t\ttoolbar: { label: \"\", cols: [] },\n\t\t\tchat: chat.id,\n\t\t\tname: chat.name,\n\t\t\tavatar: chat.avatar,\n\t\t\tusers: [].concat(chat.users),\n\t\t\tgroup: !chat.direct_id,\n\t\t\tmessageId,\n\t\t});\n\t\tthis.setParam(\"state\", state);\n\n\t\tconst stages = this.stages();\n\t\tthis.on(state.$changes, \"cursor\", v => {\n\t\t\t// use delay to avoid hotkey handler call\n\t\t\t// for the new view that is shown after cursor change\n\t\t\twebix.delay(() => {\n\t\t\t\tif (!stages[v]) this.Close();\n\t\t\t\telse {\n\t\t\t\t\tthis.show(stages[v][0]);\n\t\t\t\t\tstate.toolbar = stages[v][1];\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tthis.on(this.app, \"wizardSave\", () => {\n\t\t\tif (this.Save) {\n\t\t\t\tthis.Save();\n\t\t\t\tthis.Close();\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Closes a currently active window\n\t */\n\tClose() {\n\t\tthis.show(\"_hidden\", { target: \"top\" });\n\t}\n}\n","import FormBaseView from \"../common/form\";\n\nexport default class FormView extends FormBaseView {\n\tinit() {\n\t\tthis.on(this.app, \"wizardSave\", () => this.Save());\n\n\t\treturn super.init();\n\t}\n\n\t/**\n\t * Saves chat updates (name, title, etc.)\n\t */\n\tSave() {\n\t\tconst state = this.getParam(\"state\", true);\n\t\tconst ops = this.app.getService(\"operations\");\n\t\tconst form = this.$$(\"form\").getValues();\n\n\t\tops.updateChat(state.chat, form.name, form.avatar.avatar);\n\t\t// [NOT SURE] code doesn't wait server side confirmation\n\t\tstate.$batch({\n\t\t\tname: form.name,\n\t\t\tavatar: form.avatar.avatar,\n\t\t\tcursor: 1,\n\t\t});\n\t}\n}\n","import BaseWindow from \"../common/window\";\n\nexport default class NewChatWin extends BaseWindow {\n\tstages() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn [\n\t\t\tnull,\n\t\t\t[\n\t\t\t\t\"./chat.info.info\",\n\t\t\t\t{\n\t\t\t\t\tlabel: () => this.getParam(\"state\").name,\n\t\t\t\t\tcols: [\"close\", \"label\", \"edit\"],\n\t\t\t\t},\n\t\t\t],\n\t\t\t[\n\t\t\t\t\"./chat.info.form\",\n\t\t\t\t{\n\t\t\t\t\tlabel: `<span class=\"webix_chat_wizard_title2\">${_(\n\t\t\t\t\t\t\"Edit chat\"\n\t\t\t\t\t)}</span>`,\n\t\t\t\t\tcols: [\"back\", \"label\", \"save\"],\n\t\t\t\t},\n\t\t\t],\n\t\t\t[\n\t\t\t\t\"./chat.info.people\",\n\t\t\t\t{\n\t\t\t\t\tlabel: `<span class=\"webix_chat_wizard_title2\">${_(\n\t\t\t\t\t\t\"Add members\"\n\t\t\t\t\t)}</span>`,\n\t\t\t\t\tcols: [\"start\", \"label\", \"save\"],\n\t\t\t\t},\n\t\t\t],\n\t\t];\n\t}\n\tinit() {\n\t\tsuper.init();\n\n\t\tthis.on(this.app, \"leaveChatClick\", () => {\n\t\t\tthis.LeaveChat();\n\t\t});\n\t}\n\n\t/**\n\t * Leaves the current chat\n\t */\n\tLeaveChat() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\twebix\n\t\t\t.confirm({\n\t\t\t\tcontainer: this.app.getRoot().$view,\n\t\t\t\ttitle: _(\"Leave chat\"),\n\t\t\t\tok: _(\"Leave\"),\n\t\t\t\tcancel: _(\"Cancel\"),\n\t\t\t\ttext: _(\"Are you sure to leave this chat?\"),\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tconst ops = this.app.getService(\"operations\");\n\t\t\t\tops.leaveChat(this.getParam(\"state\").chat);\n\t\t\t\tthis.Close();\n\t\t\t});\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class ChatInfo extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst state = this.getParam(\"state\", true);\n\t\tconst helpers = this.app.getService(\"helpers\");\n\n\t\tthis.ShowAll = false;\n\t\tthis.MemberListMaxCount = 3;\n\t\tthis.CanAddUsers = state.group;\n\n\t\tconst chatAvatar = {\n\t\t\tlocalId: \"avatar\",\n\t\t\tcss: \"webix_chat_form_avatar\",\n\t\t\twidth: 130,\n\t\t\theight: 130,\n\t\t\tborderless: true,\n\t\t\ttemplate: data => {\n\t\t\t\treturn helpers.formAvatar(data, _(\"Avatar\"));\n\t\t\t},\n\t\t\tdata: { avatar: state.avatar },\n\t\t};\n\n\t\tconst membersList = {\n\t\t\tview: \"list\",\n\t\t\tlocalId: \"members\",\n\t\t\tcss: \"webix_chat_list\",\n\t\t\tborderless: true,\n\t\t\tautoheight: true,\n\t\t\ttype: {\n\t\t\t\theight: 60,\n\t\t\t\ttemplate: user => this.ListTemplate(user),\n\t\t\t\ttext: a => a.replace(/<[^>]*>/g, \"\"),\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\twebix_chat_list_item_delete: (e, id) =>\n\t\t\t\t\tthis.DeleteMemberClickHandler(id),\n\t\t\t},\n\t\t};\n\n\t\tconst addMembersButton = {\n\t\t\tview: \"button\",\n\t\t\ttype: \"icon\",\n\t\t\twidth: 150,\n\t\t\theight: Math.max(webix.skin.$active.inputHeight, 38),\n\t\t\ticon: \"wxi-plus\",\n\t\t\tlabel: _(\"Add members\"),\n\t\t\tclick: () => (state.cursor = 3),\n\t\t};\n\n\t\tconst leaveChatButton = {\n\t\t\tview: \"button\",\n\t\t\tcss: \"webix_chat_delete_button\",\n\t\t\tlabel: _(\"Leave chat\"),\n\t\t\twidth: 130,\n\n\t\t\tclick: () => this.LeaveChat(),\n\t\t};\n\n\t\tconst form = [\n\t\t\t{\n\t\t\t\ttype: \"form\",\n\t\t\t\tcols: [{}, chatAvatar, {}],\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: \"form\",\n\n\t\t\t\trows: [\n\t\t\t\t\t{\n\t\t\t\t\t\tcols: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tview: \"label\",\n\t\t\t\t\t\t\t\tlabel: _(\"Members\") + \" (\" + state.users.length + \")\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\taddMembersButton,\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t\tmembersList,\n\t\t\t\t\t{\n\t\t\t\t\t\tlocalId: \"showAllButton\",\n\t\t\t\t\t\thidden: true,\n\t\t\t\t\t\tautoheight: true,\n\t\t\t\t\t\tborderless: true,\n\t\t\t\t\t\tview: \"template\",\n\t\t\t\t\t\ttemplate: `<span class=\"webix_chat_show_all_btn\">${_(\n\t\t\t\t\t\t\t\"Show all members\"\n\t\t\t\t\t\t)}</span>`,\n\t\t\t\t\t\tcss: \"webix_chat_show_all_tmpl\",\n\t\t\t\t\t\tonClick: {\n\t\t\t\t\t\t\twebix_chat_show_all_btn: () => this.ShowAllMembers(state.users),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tinputWidth: 150,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\t{},\n\t\t];\n\n\t\tif (state.group)\n\t\t\tform.push({\n\t\t\t\ttype: \"form\",\n\t\t\t\tpadding: { top: 0 },\n\t\t\t\tcols: [leaveChatButton, {}],\n\t\t\t});\n\n\t\treturn {\n\t\t\tview: \"form\",\n\t\t\ttype: \"clean\",\n\t\t\tscroll: true,\n\t\t\tborderless: true,\n\t\t\telements: form,\n\t\t};\n\t}\n\tinit() {\n\t\tconst state = this.getParam(\"state\", true);\n\t\tif (this.$$(\"members\")) this.InitMembersList(state.users);\n\t\tthis.on(state.$changes, \"users\", v => this.Filter(v));\n\t}\n\n\t/**\n\t * Initiates chat members list\n\t * @param {Array<number>} users - an array with IDs of chat members\n\t */\n\tInitMembersList(users) {\n\t\tconst local = this.app.getService(\"local\");\n\t\tconst members = this.$$(\"members\");\n\t\tmembers.data.attachEvent(\"onSyncApply\", () => {\n\t\t\tmembers.data.sort((a, b) => this.Sort(a, b), \"asc\");\n\t\t\tthis.Filter(users);\n\t\t});\n\t\tmembers.sync(local.users());\n\t}\n\n\t/**\n\t * Builds up an HTML template for chat members\n\t * @param {Object} user - user data\n\t * @returns {string} a string with an HTML markup for chat members\n\t */\n\tListTemplate(user) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tlet youText =\n\t\t\tuser.id == this.app.config.user\n\t\t\t\t? \" (<span class='webix_chat_list_you_text'>\" + _(\"You\") + \"</span>)\"\n\t\t\t\t: \"\";\n\t\treturn (\n\t\t\tthis.app.getService(\"helpers\").listAvatar(user) +\n\t\t\tuser.name +\n\t\t\tyouText +\n\t\t\tthis.DeleteButtonTemplate(user)\n\t\t);\n\t}\n\n\t/**\n\t * Builds up an HTML template for the \"Delete\" button\n\t * @param {Object} user - user data\n\t * @returns {string} a string with an HTML markup for the \"Delete\" button in members list\n\t */\n\tDeleteButtonTemplate(user) {\n\t\tlet html = \"\";\n\t\tif (user.id != this.app.config.user && this.CanAddUsers) {\n\t\t\thtml =\n\t\t\t\t\"<button type='button' class='webix_icon_button webix_chat_list_item_delete'>\" +\n\t\t\t\t\"<span class='webix_icon wxi-close'></span>\" +\n\t\t\t\t\"</button>\";\n\t\t}\n\t\treturn html;\n\t}\n\n\t/**\n\t * Sorts the list of chat members by their names\n\t * @param {Object} a - user data\n\t * @param {Object} b - user data\n\t * @returns {number} - 1 to place \"a\" user first, -1 to place \"b\" user first\n\t */\n\tSort(a, b) {\n\t\tif (b.id == this.app.config.user) return 1;\n\t\tif (a.id == this.app.config.user) return -1;\n\t\treturn a.name > b.name ? 1 : -1;\n\t}\n\n\t/**\n\t * Shows all the members users\n\t * @param {Array<number>} users - IDs of the chat members\n\t */\n\tShowAllMembers(users) {\n\t\tthis.ShowAll = true;\n\t\tthis.Filter(users);\n\t\tthis.$$(\"showAllButton\").hide();\n\t}\n\n\t/**\n\t * Filters the list of chat members (to show only a part of thereof initially)\n\t * @param {Array<number>} users - IDs of the chat members\n\t */\n\tFilter(users) {\n\t\tthis.MemberListCount = 0;\n\t\tthis.$$(\"members\").data.filter(user => {\n\t\t\tconst isDirect = user.direct_id == user.id;\n\t\t\tconst groupMember = users && users.indexOf(user.id) > -1;\n\t\t\tlet result = isDirect || groupMember;\n\t\t\tif (result && !this.ShowAll) {\n\t\t\t\tthis.MemberListCount++;\n\t\t\t}\n\t\t\treturn result && this.MemberListCount <= this.MemberListMaxCount;\n\t\t});\n\t\tif (this.MemberListCount > this.MemberListMaxCount)\n\t\t\tthis.$$(\"showAllButton\").show();\n\t}\n\n\t/**\n\t * Removes a specified user from the current chat\n\t * @param {number} id - ID of the user to delete\n\t */\n\tDeleteMemberClickHandler(id) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst ops = this.app.getService(\"operations\");\n\n\t\twebix\n\t\t\t.confirm({\n\t\t\t\tcontainer: this.app.getRoot().$view,\n\t\t\t\ttitle: _(\"Delete member\"),\n\t\t\t\tok: _(\"Delete\"),\n\t\t\t\tcancel: _(\"Cancel\"),\n\t\t\t\ttext: _(\"Are you sure to delete this member?\"),\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tconst state = this.getParam(\"state\", true);\n\t\t\t\tstate.users = state.users.filter(a => a != id);\n\t\t\t\tops.setUsers(state.chat, state.users);\n\t\t\t});\n\t}\n\n\t/**\n\t * Removes the current user from the current chat\n\t */\n\tLeaveChat() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\twebix\n\t\t\t.confirm({\n\t\t\t\tcontainer: this.app.getRoot().$view,\n\t\t\t\ttitle: _(\"Leave chat\"),\n\t\t\t\tok: _(\"Leave\"),\n\t\t\t\tcancel: _(\"Cancel\"),\n\t\t\t\ttext: _(\"Are you sure to leave this chat?\"),\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tconst ops = this.app.getService(\"operations\");\n\t\t\t\tconst state = this.getParam(\"state\", true);\n\t\t\t\tops.leaveChat(state.chat);\n\t\t\t\t// force wizard closing\n\t\t\t\tstate.cursor = 0;\n\t\t\t});\n\t}\n}\n","import PeopleBaseView from \"../common/people\";\n\nexport default class PeopleView extends PeopleBaseView {\n\tinit() {\n\t\tconst state = this.getParam(\"state\", true);\n\t\tthis._users = [].concat(state.users);\n\n\t\tthis.on(this.app, \"wizardStart\", () => this.Back());\n\t\tthis.on(this.app, \"wizardSave\", () => this.Save());\n\n\t\treturn super.init();\n\t}\n\t/**\n\t * Saves changes performed in he list of chat members\n\t */\n\tSave() {\n\t\tconst state = this.getParam(\"state\", true);\n\t\tconst ops = this.app.getService(\"operations\");\n\n\t\tops.setUsers(state.chat, state.users);\n\t\t// [NOT SURE] code doesn't wait server side confirmation\n\t\tstate.cursor = 1;\n\t}\n\t/**\n\t * Steps back from members list to chat info window\n\t */\n\tBack() {\n\t\tthis.getParam(\"state\", true).$batch({ cursor: 1, users: this._users });\n\t}\n}\n","import BaseWindow from \"../common/window\";\n\nexport default class NewChatWin extends BaseWindow {\n\tstages() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn [\n\t\t\tnull,\n\t\t\t[\n\t\t\t\t\"./chat.common.people\",\n\t\t\t\t{\n\t\t\t\t\tlabel: `<span class=\"webix_chat_wizard_title2\">${_(\n\t\t\t\t\t\t\"Add members\"\n\t\t\t\t\t)}</span>`,\n\t\t\t\t\tcols: [\"close\", \"label\", \"save\"],\n\t\t\t\t},\n\t\t\t],\n\t\t];\n\t}\n\n\tSave() {\n\t\t// view will be destroyed till the the op callback\n\t\tconst app = this.app;\n\t\tconst state = this.getParam(\"state\");\n\t\tif (state.users.length) {\n\t\t\tapp.getService(\"operations\").setUsers(state.chat, state.users);\n\t\t}\n\t}\n}\n","import FormBaseView from \"../common/form\";\n\nexport default class FormView extends FormBaseView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst form = super.config(true);\n\n\t\tconst nextButton = {\n\t\t\tview: \"button\",\n\t\t\tlocalId: \"next\",\n\t\t\ttype: \"icon\",\n\t\t\thotkey: \"enter\",\n\t\t\ticon: \"chi-next\",\n\t\t\tcss: \"webix_primary\",\n\t\t\tlabel: `<span class=\"webix_chat_next_text\">${_(\"People\")}</span>`,\n\t\t\twidth: 160,\n\t\t\tdisabled: true,\n\t\t\theight: Math.max(webix.skin.$active.inputHeight, 38),\n\t\t\talign: \"center\",\n\t\t\tclick: () => {\n\t\t\t\tthis.ShowNextPage();\n\t\t\t},\n\t\t};\n\n\t\tform.elements.push({ align: \"right\", body: nextButton });\n\t\treturn form;\n\t}\n\n\t/**\n\t * Shows the list of users to add to a new chat (when users clicks \"People ->\")\n\t */\n\tShowNextPage() {\n\t\tlet state = this.getParam(\"state\", true);\n\t\tconst form = this.$$(\"form\").getValues();\n\n\t\tstate.name = form.name;\n\t\t// forminput returns avatar: { avatar: key }\n\t\tstate.avatar = form.avatar.avatar;\n\t\tstate.cursor = state.cursor + 1;\n\t}\n\n\t/**\n\t * Enables/Disables the next step in chat creation depending on whether the chat name field is filled\n\t * @param {string} value - input value\n\t */\n\tNameChangedHandler(value) {\n\t\tconst next = this.$$(\"next\");\n\t\tif (value) next.enable();\n\t\telse next.disable();\n\t}\n}\n","import BaseWindow from \"../common/window\";\n\nexport default class NewChatWin extends BaseWindow {\n\tstages() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn [\n\t\t\tnull,\n\t\t\t[\n\t\t\t\t\"./chat.new.form\",\n\t\t\t\t{\n\t\t\t\t\tlabel: `<span class=\"webix_chat_wizard_title1\">${_(\n\t\t\t\t\t\t\"New chat\"\n\t\t\t\t\t)}</span>`,\n\t\t\t\t\tcols: [\"close\", \"label\"],\n\t\t\t\t},\n\t\t\t],\n\t\t\t[\n\t\t\t\t\"./chat.common.people\",\n\t\t\t\t{\n\t\t\t\t\tlabel: `<span class=\"webix_chat_wizard_title2\">${_(\n\t\t\t\t\t\t\"Add members\"\n\t\t\t\t\t)}</span>`,\n\t\t\t\t\tcols: [\"back\", \"label\", \"save\"],\n\t\t\t\t},\n\t\t\t],\n\t\t];\n\t}\n\n\tSave() {\n\t\t// view will be destroyed till the the op callback\n\t\tconst app = this.app;\n\t\tconst { name, avatar, users } = this.getParam(\"state\");\n\t\tif (users && users.length)\n\t\t\tapp\n\t\t\t\t.getService(\"operations\")\n\t\t\t\t.addGroupChat(name, avatar, users)\n\t\t\t\t.then(cid => app.callEvent(\"showChat\", [\"chat\", cid]));\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class ListView extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"list\",\n\t\t\tlocalId: \"list\",\n\t\t\tselect: true,\n\t\t\tborderless: true,\n\t\t\tcss: \"webix_chat_list\",\n\t\t\ttype: {\n\t\t\t\theight: 60,\n\t\t\t\ttemplate: (data, common) => {\n\t\t\t\t\treturn this.ListTemplate(data, common);\n\t\t\t\t},\n\t\t\t\ttext: a => a.replace(/<[^>]*>/g, \"\"),\n\t\t\t},\n\t\t};\n\t}\n\n\t/**\n\t * Inits a list\n\t * @param {Object} data - collection of chats/users\n\t * @param {Function} filter - filtering function\n\t */\n\tInitSelf(data, filter) {\n\t\tconst list = this.$$(\"list\");\n\t\tlist.data.attachEvent(\"onSyncApply\", () => {\n\t\t\tthis.ApplySearchValue();\n\t\t\tthis.SyncHandler();\n\t\t});\n\t\tlist.sync(data, filter || null);\n\t\tlist.attachEvent(\"onAfterSelect\", id => {\n\t\t\tthis.ShowChat(id);\n\t\t});\n\n\t\tthis.on(this.app.getState().$changes, \"search\", v => {\n\t\t\tthis.Find(v);\n\t\t});\n\t}\n\n\tSyncHandler() {}\n\n\tShowChat() {}\n\n\t/**\n\t * Retrieves the name of a specified chat\n\t * @param {Object} item - chat object\n\t * @returns {string} chat name\n\t */\n\tListTemplate(item) {\n\t\treturn item.name;\n\t}\n\n\t/**\n\t * Escapes characters in text from search box\n\t * @param {string} text - text from the search box\n\t * @returns {string} a string with the escaped chars\n\t */\n\tEscapeRegExp(text) {\n\t\treturn text.replace(/[[\\]{}()*+?.\\\\^$|]/g, \"\\\\$&\");\n\t}\n\n\t/**\n\t * Applies value from the search box\n\t */\n\tApplySearchValue() {\n\t\tconst searchValue = this.app.getState().search;\n\t\tif (searchValue) this.Find(searchValue);\n\t}\n\n\t/**\n\t * Filters table by input text and highlights occurrences\n\t * @param {string} text - value from the search box\n\t */\n\tFind(text) {\n\t\tlet list = this.$$(\"list\");\n\t\tthis.EscapedSearchText = this.EscapeRegExp(text || \"\");\n\n\t\tif (text) {\n\t\t\ttext = text.toLowerCase();\n\t\t\tlist.filter(data => this.SearchCompare(text, data));\n\t\t} else list.filter();\n\t}\n\n\t/**\n\t * Compares chat names with the value from the search box\n\t * @param {string} value - value from the search box\n\t * @param {Object} item - chat object\n\t * @returns {boolean} true for each item that matches the value\n\t */\n\tSearchCompare(value, item) {\n\t\treturn item.name.toLowerCase().indexOf(value) > -1;\n\t}\n\n\t/**\n\t * Selects a specified chat\n\t * @param {number} id - chat ID\n\t */\n\tSelect(id) {\n\t\tconst list = this.$$(\"list\");\n\t\tif (id != list.getSelectedId() && list.getItem(id)) list.select(id);\n\t}\n}\n","import ListView from \"./list\";\n\nconst MessageCallEnd = 900;\nconst MessageCallRejected = 901;\nconst MessageCallMissed = 902;\n\nexport default class chatsView extends ListView {\n\tconfig() {\n\t\tconst limited = this.app.config.mode === \"limited\";\n\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst ui = super.config();\n\t\tconst bottomForm = {\n\t\t\tpadding: 9,\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\ttype: \"icon\",\n\t\t\t\t\ticon: \"wxi-plus\",\n\t\t\t\t\tcss: \"webix_chat_add_button\",\n\t\t\t\t\theight: Math.max(webix.skin.$active.inputHeight, 38),\n\t\t\t\t\tlabel: _(\"New chat\"),\n\t\t\t\t\tclick: () => this.app.callEvent(\"newChat\", []),\n\t\t\t\t\thidden: limited,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t\treturn {\n\t\t\ttype: \"clean\",\n\t\t\trows: [ui, bottomForm],\n\t\t};\n\t}\n\n\tinit() {\n\t\tconst state = this.app.getParam(\"state\", true);\n\t\tconst chats = this.app.getService(\"local\").chats();\n\t\tthis.InitSelf(chats);\n\n\t\t// wait data loading, so list will contain something to select\n\t\tchats.waitData.then(() => {\n\t\t\t// allow to change selected chat through API\n\t\t\tthis.on(state.$changes, \"chatId\", id => {\n\t\t\t\tif (id) this.Select(id);\n\t\t\t\telse this.$$(\"list\").unselectAll();\n\t\t\t});\n\t\t});\n\t\tif (this.app.config.emojis) this.Emojis = this.app.getService(\"emojis\");\n\t}\n\n\t/**\n\t * Shows chat with a specified ID\n\t * @param {number} id - ID of the chat to show\n\t */\n\tShowChat(id) {\n\t\tthis.app.callEvent(\"showChat\", [\"chat\", id * 1]);\n\t}\n\n\t/**\n\t * Creates an HTML template for each chat in Chats\n\t * @param {Object} chat - chat object\n\t * @param {Object} common - object with common settings for each template\n\t * @returns {string} an HTML template for a chat in the \"Chats\" tab\n\t */\n\tListTemplate(chat, common) {\n\t\tconst locale = this.app.getService(\"locale\")._;\n\t\tconst helpers = this.app.getService(\"helpers\");\n\n\t\tlet html = \"\";\n\t\thtml += helpers.listAvatar(chat);\n\t\thtml += \"<div class='webix_chat_listitem_block'>\";\n\t\thtml += `<div class='webix_chat_listitem_name'>${helpers.addTextMark(\n\t\t\tchat.name,\n\t\t\tthis.EscapedSearchText\n\t\t)}</div>`;\n\t\tif (chat.date)\n\t\t\thtml += `<span class='webix_chat_listitem_date'>${helpers.dateChatFormat(\n\t\t\t\tchat.date\n\t\t\t)}</span>`;\n\t\tif (chat.unread_count) {\n\t\t\tlet css = \"webix_chat_listitem_number\";\n\t\t\tif (chat.unread_count > 9) css += \" webix_chat_listitem_number_wide\";\n\t\t\thtml += `<span class='${css}'>${chat.unread_count}</span>`;\n\t\t}\n\t\tif (chat.message_type) {\n\t\t\thtml += \"<div class='webix_chat_listitem_message'>\";\n\t\t\tswitch (chat.message_type) {\n\t\t\t\tcase MessageCallEnd:\n\t\t\t\t\thtml += locale(\"Ended call\") + \" (\" + chat.message + \")\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase MessageCallRejected:\n\t\t\t\t\thtml += locale(\"Rejected call\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase MessageCallMissed:\n\t\t\t\t\thtml += locale(\"Missed call\");\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\thtml += \"</div>\";\n\t\t} else if (chat.message) {\n\t\t\tlet message = common.text(chat.message);\n\t\t\tif (this.Emojis) message = this.Emojis.replaceEmoji(message);\n\t\t\thtml += \"<div class='webix_chat_listitem_message'>\";\n\t\t\thtml += message;\n\t\t\thtml += \"</div>\";\n\t\t}\n\n\t\treturn html + \"</div>\";\n\t}\n}\n","webix.protoUI(\n\t{\n\t\tname: \"chat-search\",\n\t\t$cssName: \"search\",\n\t\ton_click: {\n\t\t\twebix_input_icon: function(e) {\n\t\t\t\tconst css = e.target.className;\n\t\t\t\tif (css.indexOf(this.config.closeIcon) > -1) {\n\t\t\t\t\tthis.getInputNode().focus();\n\t\t\t\t\tthis.setValue(\"\");\n\t\t\t\t\tthis.callEvent(\"onCloseIconClick\", [e]);\n\t\t\t\t\tthis.hideCloseIcon();\n\t\t\t\t} else {\n\t\t\t\t\tthis.getInputNode().focus();\n\t\t\t\t\tthis.callEvent(\"onSearchIconClick\", [e]);\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\tsetIcon(icon) {\n\t\t\tconst nodes = this.$view.getElementsByClassName(\"webix_input_icon\");\n\t\t\tif (nodes.length) nodes[0].className = \"webix_input_icon \" + icon;\n\t\t},\n\t\tshowCloseIcon() {\n\t\t\tthis.setIcon(this.config.closeIcon);\n\t\t},\n\t\thideCloseIcon() {\n\t\t\tthis.setIcon(this.config.icon);\n\t\t},\n\t\tdefaults: {\n\t\t\tcloseIcon: \"wxi-close\",\n\t\t},\n\t},\n\twebix.ui.search\n);\n","import { JetView } from \"webix-jet\";\nimport \"../helpers/search\";\n\nexport default class SideBar extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst tabbar = {\n\t\t\tview: \"tabbar\",\n\t\t\tborderless: true,\n\t\t\tcss: \"webix_chat_tabbar\",\n\t\t\theight: 52,\n\t\t\tbottomOffset: 0,\n\t\t\t//type: \"icon\",\n\t\t\toptions: [\n\t\t\t\t{ value: _(\"Chats\"), id: \"chats\" },\n\t\t\t\t{ value: _(\"Users\"), id: \"users\" },\n\t\t\t],\n\t\t\ton: {\n\t\t\t\tonChange: v => this.ShowPanel(v),\n\t\t\t},\n\t\t};\n\n\t\tconst rows = [\n\t\t\ttabbar,\n\t\t\t{\n\t\t\t\tpadding: 9,\n\t\t\t\trows: [\n\t\t\t\t\t{\n\t\t\t\t\t\tview: \"chat-search\",\n\t\t\t\t\t\tlocalId: \"search\",\n\t\t\t\t\t\theight: Math.max(webix.skin.$active.inputHeight, 38),\n\t\t\t\t\t\tplaceholder: _(\"Search\"),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\t{\n\t\t\t\t$subview: true,\n\t\t\t\tname: \"left\",\n\t\t\t},\n\t\t];\n\n\t\treturn {\n\t\t\tcss: \"webix_chat_sidebar\",\n\t\t\twidth: 320,\n\t\t\ttype: \"clean\",\n\t\t\trows,\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.State = this.getParam(\"state\", true);\n\t\tthis.ShowPanel(\"chats\");\n\n\t\tthis.$$(\"search\").attachEvent(\"onTimedKeyPress\", () => {\n\t\t\tthis.State.search = this.$$(\"search\").getValue();\n\t\t});\n\t\tthis.$$(\"search\").attachEvent(\"onChange\", () => {\n\t\t\tthis.State.search = this.$$(\"search\").getValue();\n\t\t});\n\t\tthis.on(this.State.$changes, \"search\", v => {\n\t\t\tif (v) this.$$(\"search\").showCloseIcon();\n\t\t\telse {\n\t\t\t\tthis.$$(\"search\").setValue(\"\");\n\t\t\t\tthis.$$(\"search\").hideCloseIcon();\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Shows chats or users list depending on a specified value\n\t * @param {string} v - \"chats\" or \"users\"\n\t */\n\tShowPanel(v) {\n\t\tthis.State.search = \"\";\n\t\tthis.show(\"./\" + v, { target: \"left\" });\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nimport SideBar from \"../sidebar\";\n\nexport default class SideMenu extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"sidemenu\",\n\t\t\tcss: \"webix_chat_sidemenu\",\n\t\t\tanimate: false,\n\t\t\twidth: 320,\n\t\t\tposition: \"left\",\n\t\t\tstate: state => {\n\t\t\t\tstate.left = this.Parent.left;\n\t\t\t\t(state.top = this.Parent.top), (state.height = this.Parent.height);\n\t\t\t},\n\t\t\tbody: SideBar,\n\t\t};\n\t}\n\tinit() {\n\t\tthis.on(this.app, \"top:navigation\", () => {\n\t\t\tthis.getRoot().hide();\n\t\t});\n\n\t\tthis.on(this.app, \"view:resize\", () => {\n\t\t\tif (this.getRoot().isVisible()) this.Show(true);\n\t\t});\n\t}\n\t/**\n\t * Shows sidebar with chats in the compact mode\n\t * @param {Object} box - DOMRect object\n\t */\n\tShow(updatePos) {\n\t\tif (!updatePos && this.getRoot().isVisible()) return;\n\n\t\tthis.Parent = this.app.getRoot().$view.getBoundingClientRect();\n\t\tthis.getRoot().show();\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class EmojiTemplate extends JetView {\n\tconfig() {\n\t\tconst _ = (this._ = this.app.getService(\"locale\")._);\n\t\tthis.Emojis = this.app.getService(\"emojis\");\n\n\t\treturn {\n\t\t\tview: \"popup\",\n\t\t\tbody: {\n\t\t\t\trows: [\n\t\t\t\t\t{\n\t\t\t\t\t\tcss: \"webix_chat_layout_esearch\",\n\t\t\t\t\t\tpadding: { top: 5, bottom: 5, left: 10, right: 10 },\n\t\t\t\t\t\tvisibleBatch: \"categories\",\n\t\t\t\t\t\tlocalId: \"toolbar\",\n\t\t\t\t\t\trows: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbatch: \"categories\",\n\t\t\t\t\t\t\t\tcols: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tview: \"icon\",\n\t\t\t\t\t\t\t\t\t\tlocalId: \"searchBtn\",\n\t\t\t\t\t\t\t\t\t\ticon: \"wxi-search\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tview: \"list\",\n\t\t\t\t\t\t\t\t\t\tborderless: true,\n\t\t\t\t\t\t\t\t\t\tlocalId: \"categories\",\n\t\t\t\t\t\t\t\t\t\tcss: \"webix_chat_emoji_categories_list\",\n\t\t\t\t\t\t\t\t\t\ttemplate: obj => this.CategoryMenuTemplate(obj),\n\t\t\t\t\t\t\t\t\t\tselect: true,\n\t\t\t\t\t\t\t\t\t\tlayout: \"x\",\n\t\t\t\t\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\t\t\t\t\tonItemClick: (id, e) => {\n\t\t\t\t\t\t\t\t\t\t\t\tthis.ShowCategory(id);\n\t\t\t\t\t\t\t\t\t\t\t\twebix.html.preventEvent(e);\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tdata: this.Emojis.categories(),\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbatch: \"search\",\n\t\t\t\t\t\t\t\tmargin: webix.skin.$active.layoutMargin.form,\n\t\t\t\t\t\t\t\tcols: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tview: \"icon\",\n\t\t\t\t\t\t\t\t\t\tlocalId: \"backBtn\",\n\t\t\t\t\t\t\t\t\t\ticon: \"chi-back\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{ view: \"text\", localId: \"search\", placeholder: _(\"Search\") },\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tview: \"scrollview\",\n\t\t\t\t\t\theight: 200,\n\t\t\t\t\t\tscroll: true,\n\t\t\t\t\t\tlocalId: \"views\",\n\t\t\t\t\t\tbody: {\n\t\t\t\t\t\t\tvisibleBatch: \"categories\",\n\t\t\t\t\t\t\ttype: \"clean\",\n\t\t\t\t\t\t\tpadding: {\n\t\t\t\t\t\t\t\tleft: 10,\n\t\t\t\t\t\t\t\tright: 10,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trows: this.GetLists(),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlocalId: \"preview\",\n\t\t\t\t\t\tview: \"template\",\n\t\t\t\t\t\thidden: webix.env.mobile,\n\t\t\t\t\t\ttemplate: \" \",\n\t\t\t\t\t\theight: 40,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t};\n\t}\n\tinit() {\n\t\tthis.Preview = this.$$(\"preview\");\n\n\t\tconst search = this.$$(\"search\");\n\t\tsearch.attachEvent(\"onTimedKeyPress\", () => {\n\t\t\tthis.Find(search.getValue());\n\t\t});\n\t\tthis.ScrollHandler();\n\t\t// webix.event is used instead of \"click\" property to keep textarea focused\n\t\tthis._searchClickEvent = webix.event(\n\t\t\tthis.$$(\"searchBtn\").$view,\n\t\t\t\"click\",\n\t\t\te => {\n\t\t\t\tthis.ShowSearchHeader();\n\t\t\t\twebix.html.preventEvent(e);\n\t\t\t}\n\t\t);\n\t\tthis._backClickEvent = webix.event(this.$$(\"backBtn\").$view, \"click\", e => {\n\t\t\tthis.HideSearchHeader();\n\t\t\twebix.html.preventEvent(e);\n\t\t});\n\t}\n\n\t/**\n\t * Prepares scroll for suggest with emojis\n\t */\n\tScrollHandler() {\n\t\tconst views = this.$$(\"views\")\n\t\t\t.getBody()\n\t\t\t.getChildViews();\n\t\tlet sum = 0,\n\t\t\theights = [];\n\t\tviews.forEach(v => {\n\t\t\tif (!v.config.hidden) {\n\t\t\t\tsum += v.$height - 5;\n\t\t\t\theights.push(sum);\n\t\t\t}\n\t\t});\n\t\tthis._scrollEvent = webix.event(this.$$(\"views\").$view, \"scroll\", () => {\n\t\t\tconst y = this.$$(\"views\").$view.scrollTop;\n\t\t\tlet index;\n\t\t\tfor (let i = 0; i < heights.length && typeof index == \"undefined\"; i++) {\n\t\t\t\tif (\n\t\t\t\t\ti == heights.length - 1 ||\n\t\t\t\t\t(y < heights[i] && (!i || y >= heights[i - 1]))\n\t\t\t\t)\n\t\t\t\t\tindex = i;\n\t\t\t}\n\n\t\t\tthis.$$(\"categories\").select(this.Emojis.categories()[index].id);\n\t\t});\n\t}\n\n\t/**\n\t * Builds rows with emojis in suggest list\n\t * @returns {Array} an array of emoji rows\n\t */\n\tGetLists() {\n\t\tconst rows = [];\n\t\tconst data = {};\n\t\tthis.Emojis.emojis().data.each(emoji => {\n\t\t\tif (!data[emoji.category]) data[emoji.category] = [];\n\t\t\tdata[emoji.category].push(emoji);\n\t\t});\n\t\tthis.Emojis.categories().forEach(c => {\n\t\t\trows.push(\n\t\t\t\tthis.ListConfig(\n\t\t\t\t\t\"category_\" + c.id,\n\t\t\t\t\tc.id == \"basic\" ? this.Emojis.basicEmojis() : data[c.id],\n\t\t\t\t\tthis._(c.name),\n\t\t\t\t\t\"categories\"\n\t\t\t\t)\n\t\t\t);\n\t\t});\n\t\trows.push(\n\t\t\tthis.ListConfig(\"searchResults\", [], this._(\"Search results\"), \"search\")\n\t\t);\n\t\treturn rows;\n\t}\n\n\t/**\n\t * Creates config for emoji category\n\t * @param {string} id - category ID\n\t * @param {Array} data - an array of emoji objects\n\t * @param {string} title - category title\n\t * @param {string} batch - batch for categories (\"categories\" or \"search\")\n\t * @returns {Object} a config for emoji category\n\t */\n\tListConfig(id, data, title, batch) {\n\t\tconst config = {\n\t\t\ttype: \"clean\",\n\t\t\tbatch,\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\ttemplate: title,\n\t\t\t\t\tcss: \"webix_emoji_category_label\",\n\t\t\t\t\tautoheight: true,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"dataview\",\n\t\t\t\t\tlocalId: id,\n\t\t\t\t\tautoheight: true,\n\t\t\t\t\txCount: 6,\n\t\t\t\t\ttype: {\n\t\t\t\t\t\tcss: \"webix_chat_emojis_item\",\n\t\t\t\t\t\twidth: 40,\n\t\t\t\t\t\theight: 40,\n\t\t\t\t\t},\n\t\t\t\t\ton: {\n\t\t\t\t\t\tonItemClick: function(id) {\n\t\t\t\t\t\t\tthis.$scope.app.callEvent(\"pasteEmoji\", [id, this.getItem(id)]);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonMouseMove: function(id) {\n\t\t\t\t\t\t\tconst item = this.getItem(id);\n\t\t\t\t\t\t\tthis.$scope.ShowPreview(item);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tmouseEventDelay: 100,\n\t\t\t\t\ttemplate: obj => this.ItemTemplate(obj),\n\t\t\t\t\tdata,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tif (!webix.env.mobile)\n\t\t\tconfig.rows[1].on.onMouseMove = function(id) {\n\t\t\t\tconst item = this.getItem(id);\n\t\t\t\tthis.$scope.ShowPreview(item);\n\t\t\t};\n\n\t\treturn config;\n\t}\n\n\t/**\n\t * Shows the suggest with emojis\n\t * @param {Object} node - PointerEvent object\n\t */\n\tShow(node) {\n\t\tthis.HideSearchHeader();\n\t\tthis.getRoot().show(node);\n\t\tconst id = this.Emojis.categories()[0].id;\n\t\tthis.$$(\"categories\").select(id);\n\t\tthis.ShowCategory(id);\n\t}\n\n\t/**\n\t * Hides the suggest with emojis\n\t */\n\tHide() {\n\t\tthis.getRoot().hide();\n\t}\n\n\t/**\n\t * Creates an HTML template for emoji\n\t * @param {Object} obj - emoji object\n\t * @returns {string} an HTML template for emoji\n\t */\n\tItemTemplate(obj) {\n\t\treturn (\n\t\t\t\"<div class='webix_chat_emoji webix_chat_emoji_\" +\n\t\t\tobj.unified +\n\t\t\t\"'></div>\"\n\t\t);\n\t}\n\n\t/**\n\t * Shows emoji preview\n\t * @param {number} item - emoji data\n\t */\n\tShowPreview(item) {\n\t\tthis.Preview.setHTML(this.PreviewTemplate(item));\n\t}\n\n\t/**\n\t * Creates a template for emoji preview (when user hovers over an emoji)\n\t * @param {Object} obj - emoji object\n\t * @returns {string} an HTML template for emoji preview\n\t */\n\tPreviewTemplate(obj) {\n\t\tconst search = this.$$(\"search\");\n\t\tconst value = search.isVisible() ? search.getValue() : \"\";\n\t\tlet name = this.Emojis.findName(obj, value);\n\t\tif (!name) return \"\";\n\t\tname = this.Emojis.shortNameToTitle(name);\n\t\treturn (\n\t\t\t\"<div class='webix_chat_emoji_preview'>\" +\n\t\t\t\"<div class='webix_chat_emoji webix_chat_emoji_\" +\n\t\t\tobj.unified +\n\t\t\t\"'></div>\" +\n\t\t\t\"<div class='webix_chat_emoji_name'>\" +\n\t\t\tname +\n\t\t\t\"</div></div>\"\n\t\t);\n\t}\n\n\t/**\n\t * Looks for emojis names of which match a specified value\n\t * @param {string} value - value from the search box in the emojis suggest\n\t */\n\tFind(value) {\n\t\tif (value) {\n\t\t\tthis.$$(\"views\")\n\t\t\t\t.getBody()\n\t\t\t\t.showBatch(\"search\");\n\t\t\tvalue = value.toLowerCase();\n\t\t\tconst data = this.Emojis.emojis().data.find(item => {\n\t\t\t\tlet result = false;\n\t\t\t\tfor (let i = 0; i < item.names.length && !result; i++)\n\t\t\t\t\tresult = item.names[i].includes(value);\n\t\t\t\treturn result;\n\t\t\t});\n\t\t\tthis.$$(\"searchResults\").clearAll();\n\t\t\tthis.$$(\"searchResults\").parse(data);\n\t\t} else {\n\t\t\tthis.$$(\"views\")\n\t\t\t\t.getBody()\n\t\t\t\t.showBatch(\"categories\");\n\t\t}\n\t}\n\n\t/**\n\t * Shows the search box upon clicking the icon\n\t */\n\tShowSearchHeader() {\n\t\tthis.$$(\"toolbar\").showBatch(\"search\");\n\t\tthis.$$(\"search\").setValue(\"\");\n\t\tthis.$$(\"search\").focus();\n\t}\n\n\t/**\n\t * Hides the search box\n\t */\n\tHideSearchHeader() {\n\t\tthis.Find();\n\t\tthis.$$(\"views\")\n\t\t\t.getBody()\n\t\t\t.showBatch(\"categories\");\n\t\tthis.$$(\"toolbar\").showBatch(\"categories\");\n\t}\n\n\t/**\n\t * Creates a template for category title in the suggest\n\t * @param {Object} obj - category object\n\t * @returns {string} an HTML template for category title\n\t */\n\tCategoryMenuTemplate(obj) {\n\t\treturn `<span class='webix_icon ${obj.icon}'></span>`;\n\t}\n\n\t/**\n\t * Shows a specified category in the suggest\n\t * @param {number} categoryId - category ID\n\t */\n\tShowCategory(categoryId) {\n\t\tconst index = this.Emojis.categories().findIndex(c => c.id == categoryId);\n\t\tconst layoutId = this.$$(\"views\")\n\t\t\t.getBody()\n\t\t\t.getChildViews()[index].config.id;\n\t\tthis.$$(\"views\").showView(layoutId);\n\t}\n\tdestroy() {\n\t\tif (this._scrollEvent) webix.eventRemove(this._scrollEvent);\n\t\twebix.eventRemove(this._backClickEvent);\n\t\twebix.eventRemove(this._searchClickEvent);\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class EmojiSuggest extends JetView {\n\tconstructor(app, master) {\n\t\tsuper(app);\n\t\tthis.Master = master;\n\t}\n\tconfig() {\n\t\tthis.Emojis = this.app.getService(\"emojis\");\n\t\tconst symbol = this.Emojis.symbol;\n\t\treturn {\n\t\t\tview: \"mentionsuggest\",\n\t\t\tsymbol: symbol,\n\t\t\tmaxHeight: 200,\n\t\t\tcss: \"webix_chat_emojisuggest\",\n\t\t\ttemplate: obj => this.SuggestTemplate(obj),\n\t\t\tfilter: data => {\n\t\t\t\tif (this.FilterText) {\n\t\t\t\t\tconst text = this.getRoot().getItemText(data.id);\n\t\t\t\t\treturn (\n\t\t\t\t\t\ttext &&\n\t\t\t\t\t\ttext.toLowerCase().indexOf(this.FilterText.toLowerCase()) > -1\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tbody: {\n\t\t\t\ttemplate: obj => this.ItemTemplate(obj),\n\t\t\t\tdata: this.Emojis.emojis(),\n\t\t\t},\n\t\t};\n\t}\n\tinit() {\n\t\tthis.Text = this.Master.queryView({ name: \"text\" });\n\t\t// customise setValueHere to use a white space in the end of the SuggestTemplate\n\t\t// (\"mentions\" enabled case)\n\t\tthis.Text.setValueHere = function(value, data, details) {\n\t\t\tif (value.indexOf(\" \") != -1 && value.indexOf(\" \") != value.length - 1)\n\t\t\t\tvalue = `\"${value}\"`;\n\t\t\treturn webix.ui.text.prototype.setValueHere.apply(this, [\n\t\t\t\tvalue,\n\t\t\t\tdata,\n\t\t\t\tdetails,\n\t\t\t]);\n\t\t};\n\t\tthis.Popup = this.getRoot();\n\n\t\tthis.on(this.Popup.getList().data, \"onBeforeFilter\", () =>\n\t\t\tthis.BeforeFilterHandler()\n\t\t);\n\t\tthis._keyEvent = webix.event(\n\t\t\tthis.Text.$view,\n\t\t\t\"keydown\",\n\t\t\te => {\n\t\t\t\tthis.KeyCode = e.keyCode;\n\t\t\t},\n\t\t\t{ capture: true }\n\t\t);\n\t\t// used to restore a cursor position when an option is selected\n\t\tthis.on(this.Popup, \"onValueSuggest\", (data, text) => {\n\t\t\twebix.delay(() => {\n\t\t\t\tthis.Master.focus();\n\t\t\t\tconst inp = this.Text.getInputNode();\n\t\t\t\tconst len = text.length - this.FilterText.length;\n\t\t\t\tinp.setSelectionRange(\n\t\t\t\t\tthis._lastCursorPosition + len,\n\t\t\t\t\tthis._lastCursorPosition + len\n\t\t\t\t);\n\t\t\t});\n\t\t});\n\t\tthis.on(this.Popup, \"onShow\", () => this.ShowHandler());\n\t}\n\n\t/**\n\t * Selects the first emoji in the suggest\n\t */\n\tShowHandler() {\n\t\tconst list = this.Popup.getList();\n\t\tlist.select(list.getFirstId());\n\t}\n\n\t/**\n\t * Links input with suggest list\n\t */\n\tLinkInput() {\n\t\tthis.on(this.Text, \"onAfterRender\", () => {\n\t\t\tthis.Popup.linkInput(this.Text);\n\t\t});\n\t}\n\n\t/**\n\t * Sets properties and performs operations before filtering is fired.\n\t */\n\tBeforeFilterHandler() {\n\t\tthis._lastCursorPosition = webix.html.getSelectionRange(\n\t\t\tthis.Text.getInputNode()\n\t\t).start;\n\n\t\tconst code = this.KeyCode;\n\t\t// do not show suggest on \"left\" / \"right\" key press\n\t\tif ((code == 37 || code == 39) && !this.Popup.isVisible()) return false;\n\t\tthis.FilterText = null;\n\t\tlet value = this.Text.getValue();\n\t\tconst symbol = this.Emojis.symbol;\n\t\tvalue = value.substring(0, this._lastCursorPosition);\n\t\tif (value.indexOf(symbol) === -1) return false;\n\t\telse {\n\t\t\tvalue = value\n\t\t\t\t.toLowerCase()\n\t\t\t\t.substring(value.lastIndexOf(symbol) + symbol.length);\n\t\t\tif (\n\t\t\t\tvalue.length &&\n\t\t\t\tvalue.match(\"^[A-Za-z0-9-+]+$\") &&\n\t\t\t\t!value.indexOf(this.LastFilterFail) > -1\n\t\t\t) {\n\t\t\t\tlet result = this.Emojis.emojis().data.find(emoji => {\n\t\t\t\t\treturn emoji.names.some(n => n.toLowerCase().indexOf(value) != -1);\n\t\t\t\t}, true);\n\t\t\t\tif (result) this.FilterText = value;\n\t\t\t\telse {\n\t\t\t\t\tthis.FilterText = null;\n\t\t\t\t\tthis.LastFilterFail = value;\n\t\t\t\t}\n\t\t\t\treturn this.FilterText;\n\t\t\t}\n\t\t\tif (this.Popup.isVisible()) this.Popup.hide();\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * Gets text for the textarea when an option is selected\n\t * @param  {Object} obj - emoji data item\n\t * @returns {string} text to display in message input\n\t */\n\tSuggestTemplate(obj) {\n\t\tconst text = this.Emojis.findName(obj, this.FilterText);\n\t\treturn text ? text + \": \" : null;\n\t}\n\n\t/**\n\t * An option template\n\t * @param {Object} obj - emoji data item\n\t * @returns {string} an HTML template for the suggest option\n\t */\n\tItemTemplate(obj) {\n\t\tlet name = this.Emojis.findName(obj, this.FilterText);\n\t\tif (!name) return \"\";\n\t\tname = this.Emojis.shortNameToTitle(name);\n\t\treturn (\n\t\t\t\"<div class='webix_chat_emoji_preview'>\" +\n\t\t\t\"<div class='webix_chat_emoji webix_chat_emoji_\" +\n\t\t\tobj.unified +\n\t\t\t\"'></div>\" +\n\t\t\t\"<div class='webix_chat_emoji_name'>\" +\n\t\t\tname +\n\t\t\t\"</div></div>\"\n\t\t);\n\t}\n\tdestroy() {\n\t\twebix.eventRemove(this._keyEvent);\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class Toolbar extends JetView {\n\tconfig() {\n\t\tconst config = this.app.config;\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\t\tconst mode = config.mode;\n\t\tthis.Limited = mode === \"single\" || mode === \"limited\";\n\n\t\tconst width = Math.max(webix.skin.$active.inputHeight, 38);\n\n\t\treturn {\n\t\t\tview: \"toolbar\",\n\t\t\tlocalId: \"toolbar\",\n\t\t\tvisibleBatch: \"active\",\n\t\t\tcss: \"webix_chat_toolbar\",\n\t\t\tpadding: {\n\t\t\t\tright: 4,\n\t\t\t\ttop: 3,\n\t\t\t\tbottom: 3,\n\t\t\t},\n\t\t\telements: [\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"webix_icon chi-menu\",\n\t\t\t\t\tclick: () => this.app.callEvent(\"showSidebar\", []),\n\t\t\t\t\thidden: !this.Compact || mode === \"single\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"template\",\n\t\t\t\t\theight: 46,\n\t\t\t\t\tlocalId: \"chatTitle\",\n\t\t\t\t\tcss: \"webix_chat_toolbar_tmpl\",\n\t\t\t\t\tname: \"chatTitle\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\ttemplate: data => this.TitleTemplate(data),\n\t\t\t\t\tonClick: {\n\t\t\t\t\t\twebix_chat_title: () => {\n\t\t\t\t\t\t\tthis.ChatInfoHandler();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\tbatch: \"active\",\n\t\t\t\t\ticon: \"chi-video\",\n\t\t\t\t\ttooltip: _(\"Start call\"),\n\t\t\t\t\tlocalId: \"call\",\n\t\t\t\t\twidth,\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tthis.StartCallHandler();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\tbatch: \"active\",\n\t\t\t\t\ticon: \"chi-account-plus\",\n\t\t\t\t\ttooltip: _(\"Add members\"),\n\t\t\t\t\twidth,\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tthis.NewMembersHandler();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\tbatch: \"active\",\n\t\t\t\t\ticon: \"wxi-dots\",\n\t\t\t\t\twidth,\n\t\t\t\t\tclick: (id, ev) => {\n\t\t\t\t\t\tthis.ToggleMenu(ev);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\tinit() {\n\t\tconst state = this.getParam(\"state\", true);\n\t\tthis.State = state;\n\n\t\tconst chats = this.app.getService(\"local\").chats();\n\t\tchats.data.attachEvent(\"onStoreUpdated\", id => {\n\t\t\tif (!id || id == state.chatId) {\n\t\t\t\tthis.Refresh();\n\t\t\t}\n\t\t});\n\n\t\tthis.on(state.$changes, \"*\", () => {\n\t\t\tthis.Refresh();\n\t\t});\n\n\t\tthis.InitMenu();\n\t}\n\n\t/**\n\t * Refreshes chats (e.g. when user navigates to a chat)\n\t */\n\tRefresh() {\n\t\tconst state = this.State;\n\t\tif (!this.getRoot()) return false;\n\t\tconst local = this.app.getService(\"local\");\n\t\tlet obj;\n\n\t\tif (state.chatId) {\n\t\t\tconst chats = local.chats();\n\t\t\tobj = chats.getItem(state.chatId);\n\t\t} else {\n\t\t\tconst users = local.users();\n\t\t\tobj = users.getItem(state.userId);\n\t\t}\n\n\t\tobj = obj || {};\n\n\t\tthis.$$(\"chatTitle\").setValues(obj);\n\n\t\tif (obj.direct_id && this.app.config.calls) this.$$(\"call\").show();\n\t\telse this.$$(\"call\").hide();\n\n\t\tconst t = this.$$(\"toolbar\");\n\t\tif (state.chatId && !this.Limited) t.showBatch(\"active\");\n\t\telse t.showBatch(\"inactive\");\n\t}\n\n\t/**\n\t * Creates an HTML template for chat title\n\t * @param {Object} data - chat object\n\t * @returns {string} an HTML template fot chat title\n\t */\n\tTitleTemplate(data) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst helpers = this.app.getService(\"helpers\");\n\t\tlet result = \"\";\n\t\tif (data.name) {\n\t\t\tresult += helpers.listAvatar(data, \"webix_chat_toolbar_avatar\");\n\t\t\tif (data.users) {\n\t\t\t\tlet members = data.users.length + \" \" + _(\"members\");\n\t\t\t\tresult += \"<div class='webix_chat_title'>\";\n\t\t\t\tif (data.direct_id)\n\t\t\t\t\tresult += `<span class=\"webix_chat_messages_chat_name\">${data.name}</span>`;\n\t\t\t\telse\n\t\t\t\t\tresult +=\n\t\t\t\t\t\t`<div class=\"webix_chat_messages_groupchat_name\">${data.name}</div>` +\n\t\t\t\t\t\t`<div class=\"webix_chat_messages_groupchat_members\">${members}</div>`;\n\t\t\t\tresult += \"</div>\";\n\t\t\t} else\n\t\t\t\tresult += `<span class=\"webix_chat_messages_user_name\">${data.name}</span>`;\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * Toggles the \"Chat info\" menu\n\t * @param {Object} ev - PointerEvent object\n\t */\n\tToggleMenu(ev) {\n\t\tif (this.ToolbarMenu.isVisible()) this.ToolbarMenu.hide();\n\t\telse this.ToolbarMenu.show(ev.target, { pos: \"left\", y: 30, x: 10 });\n\t}\n\n\t/**\n\t * Inits chat info menu\n\t * @returns {Object} an instance of Webix contextmenu for chat info\n\t */\n\tInitMenu() {\n\t\tthis.ToolbarMenu = this.ui({\n\t\t\tview: \"contextmenu\",\n\t\t\tautowidth: true,\n\t\t\tpoint: false,\n\t\t\tdata: this.GetMenuData(),\n\t\t\ton: {\n\t\t\t\tonItemClick: id => {\n\t\t\t\t\tif (this.ToolbarMenu.callEvent(\"onBeforeMenuAction\", [id])) {\n\t\t\t\t\t\tif (id == \"info\") this.ChatInfoHandler();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t\treturn this.ToolbarMenu;\n\t}\n\n\t/**\n\t * Retrieves an array with chat menu options (objects)\n\t * @returns {Array} an array with chat menu object\n\t */\n\tGetMenuData() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn [{ id: \"info\", value: _(\"Chat info\") }];\n\t}\n\n\t/**\n\t * Checks wether the chat menu can be opened\n\t */\n\tChatInfoHandler() {\n\t\tif (this.State.chatId && !this.Limited)\n\t\t\tthis.app.callEvent(\"chatInfo\", [this.State.chatId]);\n\t}\n\n\t/**\n\t * Fires an event to add new users to the current chat\n\t */\n\tNewMembersHandler() {\n\t\tthis.app.callEvent(\"newMembers\", [this.State.chatId]);\n\t}\n\n\t/**\n\t * Fires an event to start a call\n\t */\n\tStartCallHandler() {\n\t\tthis.app.callEvent(\"startCall\", [\n\t\t\tthis.State.userId || this.State.chatId,\n\t\t\tthis.State.chatId || 0,\n\t\t]);\n\t}\n}\n","webix.protoUI(\n\t{\n\t\tname: \"chat-comments\",\n\t\t$cssName: \"comments\",\n\t\t$init(config) {\n\t\t\tif (config.ChatFormConfig) config.ChatFormConfig(config);\n\t\t\tif (config.ChatListConfig) config.ChatListConfig(config);\n\t\t},\n\t},\n\twebix.ui.comments\n);\nwebix.protoUI(\n\t{\n\t\tname: \"chat-comments-layout\",\n\t\t$cssName: \"layout\",\n\t\thide() {},\n\t},\n\twebix.ui.layout\n);\nwebix.protoUI(\n\t{\n\t\tname: \"chat-comments-text\",\n\t\t$cssName: \"texthighlight\",\n\t\tdefine(a, b) {\n\t\t\tconst h = a.height;\n\t\t\tif (h) {\n\t\t\t\tconst c = this.config;\n\t\t\t\tif (h < 70 && h > c.inactiveHeight) a.height = c.inactiveHeight;\n\t\t\t}\n\t\t\treturn webix.ui.texthighlight.prototype.define.call(this, a, b);\n\t\t},\n\t},\n\twebix.ui.texthighlight\n);\n","import { JetView } from \"webix-jet\";\nimport Toolbar from \"./toolbar\";\nimport \"../../helpers/chatcomments\";\n\nimport EmojiPopup from \"./emojis\";\nimport EmojiSuggest from \"./emojisuggest\";\n\nexport default class MessagesView extends JetView {\n\tconfig() {\n\t\tthis.Helpers = this.app.getService(\"helpers\");\n\t\tthis.State = this.getParam(\"state\", true);\n\t\tthis.Upload = this.app.getService(\"upload\");\n\t\tthis.UploadDelay = 500;\n\t\tthis.WithReactions = this.app.config.reactions;\n\t\tthis._ = this.app.getService(\"locale\")._;\n\n\t\tconst ui = {\n\t\t\tview: \"chat-comments\",\n\t\t\tsendAction: \"enter\",\n\t\t\tlocalId: \"comments\",\n\t\t\tcss: this.WithReactions ? \"webix_chat_comments_rct\" : \"\",\n\t\t\tcurrentUser: this.app.config.user,\n\t\t\tusers: new webix.DataCollection({\n\t\t\t\tdata: [],\n\t\t\t\tscheme: {\n\t\t\t\t\t$init: user => {\n\t\t\t\t\t\tuser.value = user.name;\n\t\t\t\t\t\tuser.image = user.avatar;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}),\n\t\t\tlistItem: {\n\t\t\t\ttemplateText: obj => this.MessageTemplateText(obj),\n\t\t\t\ttemplateLinks: obj => this.MessageTemplateLink(obj),\n\t\t\t\ttemplateMenu: obj => this.MessageTemplateMenu(obj),\n\t\t\t\ttemplateUser: obj => this.MessageTemplateUser(obj),\n\t\t\t\ttemplateAvatar: obj => this.MessageTemplateAvatar(obj),\n\t\t\t\ttemplateDate: obj => this.MessageTemplateDate(obj),\n\t\t\t},\n\t\t};\n\t\tif (this.app.config.files || this.app.config.emojis)\n\t\t\tui.ChatFormConfig = conf => this.FormConfig(conf);\n\t\tif (this.WithReactions) ui.ChatListConfig = conf => this.ListConfig(conf);\n\n\t\treturn {\n\t\t\trows: [Toolbar, ui],\n\t\t};\n\t}\n\n\tinit() {\n\t\t// this.Comments will be used in UI template\n\t\tconst comments = (this.Comments = this.$$(\"comments\"));\n\t\tconst list = (this.List = comments.queryView(\"list\"));\n\n\t\t// services\n\t\tthis.Local = this.app.getService(\"local\");\n\t\tthis.Back = this.app.getService(\"backend\");\n\t\tthis.Users = this.Local.users();\n\t\tconst serverEvents = this.Back.pubsub();\n\t\tthis.Ops = this.app.getService(\"operations\");\n\t\tconst users = comments.getUsers();\n\t\tthis.on(users.data, \"onSyncApply\", function() {\n\t\t\t// add \"value\" property for mentions suggest\n\t\t\tusers.data.each(item => {\n\t\t\t\titem.value = item.name;\n\t\t\t});\n\t\t});\n\t\tusers.sync(this.Local.users());\n\t\tcomments.attachEvent(\"onAfterAdd\", cid => {\n\t\t\tconst obj = comments.getItem(cid);\n\n\t\t\tif (!obj.chat_id) {\n\t\t\t\tconst userId = this.State.userId;\n\n\t\t\t\t// show typed value as text, not as HTML tags\n\t\t\t\tconst formatted = obj.text.replace(/</g, \"&lt;\");\n\t\t\t\tif (formatted !== obj.text) {\n\t\t\t\t\tcomments.updateItem(cid, { text: formatted });\n\t\t\t\t}\n\n\t\t\t\tif (this.State.chatId) {\n\t\t\t\t\tthis.AddMessage(this.State.chatId, obj.text, cid);\n\t\t\t\t\tthis.ScrollToBottom();\n\t\t\t\t} else if (userId) {\n\t\t\t\t\tcomments.disable();\n\t\t\t\t\tthis.Ops.addChat(userId)\n\t\t\t\t\t\t.then(chatId => this.AddMessage(chatId, obj.text, cid))\n\t\t\t\t\t\t.then(() => this.app.callEvent(\"showChat\", [\"user\", userId]));\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tcomments.attachEvent(\"onBeforeDelete\", id => {\n\t\t\tif (this.IsUsersMessage(comments.getItem(id))) {\n\t\t\t\tthis.Ops.removeMessage(id);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\n\t\tcomments.attachEvent(\"onDataUpdate\", (id, msg, old) => {\n\t\t\tif (this.IsUsersMessage(msg) && msg.text != old.text) {\n\t\t\t\tthis.Ops.updateMessage(id, msg.text);\n\t\t\t}\n\t\t});\n\n\t\tthis.on(this.app, \"showChat\", () => {\n\t\t\tconst chats = this.Local.chats();\n\t\t\tchats.waitData.then(() => {\n\t\t\t\tif (this.getRoot())\n\t\t\t\t\tthis.FilterUsers(\n\t\t\t\t\t\tcomments.getUsers(),\n\t\t\t\t\t\tchats,\n\t\t\t\t\t\tthis.State.chatId,\n\t\t\t\t\t\tthis.State.userId\n\t\t\t\t\t);\n\t\t\t});\n\t\t});\n\n\t\tthis.on(serverEvents, \"messages\", pack => {\n\t\t\tconst { op, origin, msg } = pack;\n\n\t\t\tif (msg.chat_id != this.State.chatId) return;\n\n\t\t\tswitch (op) {\n\t\t\t\tcase \"add\":\n\t\t\t\t\tmsg.date = new Date(msg.date);\n\t\t\t\t\t// recent message saved\n\t\t\t\t\tif (comments.exists(origin)) {\n\t\t\t\t\t\tlist.data.changeId(origin, msg.id);\n\t\t\t\t\t\tcomments.updateItem(msg.id, msg);\n\t\t\t\t\t\t// new message added\n\t\t\t\t\t} else if (!comments.exists(msg.id)) {\n\t\t\t\t\t\tcomments.add(msg);\n\t\t\t\t\t\tthis.ScrollToBottom();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"remove\":\n\t\t\t\t\tif (comments.exists(msg.id)) comments.remove(msg.id);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"update\":\n\t\t\t\t\tmsg.date = new Date(msg.date);\n\t\t\t\t\tif (comments.exists(msg.id)) {\n\t\t\t\t\t\tcomments.updateItem(msg.id, msg);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\tthis.on(this.State.$changes, \"chatId\", () => {\n\t\t\tthis.LoadChat(this.State.chatId, this.State.userId);\n\t\t});\n\n\t\tif (this.app.config.files) this.InitUploader();\n\n\t\tthis.on(this.Comments.getMenu(), \"onBeforeShow\", () =>\n\t\t\tthis.ShowMenuHandler(this.Comments.getMenu())\n\t\t);\n\t\tthis.AddImageHandler();\n\n\t\tif (this.app.config.emojis) this.InitEmojis();\n\t}\n\n\t/**\n\t * Is called upon message removal or update\n\t * @param {Object} msg - message object\n\t * @returns {boolean} true if user can manipulate the message and message type is 901-904\n\t */\n\tIsUsersMessage(msg) {\n\t\treturn msg.user_id == this.app.config.user && (!msg.type || msg.type < 900);\n\t}\n\n\tIsUsersReaction(msgId, reaction) {\n\t\tif (msgId == this.app.config.user) return false;\n\t\tconst msg = this.Comments.getItem(msgId);\n\t\treturn msg.reactions[reaction].includes(this.app.config.user);\n\t}\n\n\t/**\n\t * Sends new message to a specified chat\n\t * @param {number} chatId - chat ID\n\t * @param {string} text - message text\n\t * @param {number} messageId - message ID\n\t * @returns {Promise} a promise that resolves with a new message\n\t */\n\tAddMessage(chatId, text, messageId) {\n\t\treturn this.Ops.addMessage(chatId, messageId, text).then(msg => {\n\t\t\tif (this.Comments.exists(messageId))\n\t\t\t\tthis.Comments.queryView(\"list\").data.changeId(messageId, msg.id);\n\t\t});\n\t}\n\n\t/**\n\t * Scrolls the comments view to the bottom (e.g. when users sends a message)\n\t */\n\tScrollToBottom() {\n\t\tconst list = this.$$(\"comments\").queryView(\"list\");\n\t\tlist.showItem(list.getLastId());\n\t}\n\n\t/**\n\t * Loads a specified chat\n\t * @param {number} id - chat ID\n\t * @param {number} userId - user ID\n\t */\n\tLoadChat(id, userId) {\n\t\tconst comments = this.$$(\"comments\");\n\n\t\t// detach old chat\n\t\tcomments.clearAll();\n\t\tthis.Uploader = this.Upload.getUploader(id, \"file\");\n\t\tif (id || userId) {\n\t\t\tcomments.enable();\n\t\t\tif (id)\n\t\t\t\tthis.Local.messages(id).then(data => {\n\t\t\t\t\tif (!this.getRoot()) return;\n\t\t\t\t\tcomments.parse(data);\n\t\t\t\t\tthis.Ops.resetCounter(id);\n\t\t\t\t\tthis.ScrollToBottom();\n\t\t\t\t});\n\t\t\tthis.Focus();\n\t\t} else {\n\t\t\tcomments.disable();\n\t\t}\n\t}\n\n\t/**\n\t * Filters the current user from the list of users in chat\n\t * @param {Object} users - users collection\n\t * @param {Object} chats - chats collection\n\t * @param {number} chatId - chat ID\n\t * @param {number} userId - user ID\n\t */\n\tFilterUsers(users, chats, chatId, userId) {\n\t\tconst chat = chatId ? chats.getItem(chatId) : null;\n\t\tusers.data.filter(user => {\n\t\t\tif (chatId)\n\t\t\t\treturn (\n\t\t\t\t\tchat &&\n\t\t\t\t\t(chat.users.indexOf(user.id) >= 0 && user.id != this.app.config.user)\n\t\t\t\t);\n\t\t\treturn user.id == userId;\n\t\t});\n\t}\n\n\t/**\n\t * Focuses the message input field\n\t */\n\tFocus() {\n\t\twebix.delay(() => {\n\t\t\tif (this.getRoot()) this.Comments.focus();\n\t\t});\n\t}\n\n\t/**\n\t * Creates an HTML template string for a message\n\t * @param {Object} obj - message object\n\t * @returns {string} an HTML string with a message template\n\t */\n\tMessageTemplateText(obj) {\n\t\tlet text = obj.text;\n\t\tif (this.app.config.emojis) text = this.Emojis.replaceEmoji(text);\n\t\tlet type = obj.type;\n\t\tif (type === 800) {\n\t\t\tconst parts = text.split(\"\\n\");\n\t\t\tif (parts.length === 4)\n\t\t\t\ttext = this.Preview(parts[0], parts[3], parts[1], parts[2]);\n\t\t\telse text = this.FileLinkTemplate(parts[0], parts[1], parts[2]);\n\t\t} else if (type >= 900) {\n\t\t\tconst outgoing = this.State.userId == obj.user_id;\n\t\t\tconst arrow = \"chi-arrow-\" + (outgoing ? \"bottom-left\" : \"top-right\");\n\t\t\tlet message;\n\t\t\tswitch (type) {\n\t\t\t\tcase 900:\n\t\t\t\t\tmessage = outgoing\n\t\t\t\t\t\t? this._(\"Incoming call\")\n\t\t\t\t\t\t: this._(\"Outgoing call\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase 901:\n\t\t\t\t\tmessage = this._(\"Rejected call\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase 902:\n\t\t\t\t\tmessage = this._(\"Missed call\");\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\ttext =\n\t\t\t\t\"<span class = 'webix_chat_call_type \" +\n\t\t\t\tarrow +\n\t\t\t\t\" webix_chat_call_type_\" +\n\t\t\t\tthis.Back.callMessages[type] +\n\t\t\t\t\"'></span>\" +\n\t\t\t\t\"<div class = 'webix_chat_call_message'>\" +\n\t\t\t\tmessage +\n\t\t\t\t\"<p>\" +\n\t\t\t\ttext +\n\t\t\t\t\"</p></div>\";\n\t\t}\n\t\tif (this.WithReactions && type < 900)\n\t\t\ttext = this.ReactionsTemplate(obj, text);\n\t\treturn \"<div class = 'webix_comments_message'>\" + text + \"</div>\";\n\t}\n\n\t/**\n\t * Creates an HTML template for file upload link\n\t * @param {string} url - URL the file is available for download by\n\t * @param {string} name - file name\n\t * @param {string} size - file size\n\t * @returns {string} an HTML string with a template for file link\n\t */\n\tFileLinkTemplate(url, name, size) {\n\t\treturn (\n\t\t\t`<a target=\"_blank\" href=\"${url}\" class=\"webix_chat_file_block\">` +\n\t\t\t\"<span class='webix_icon chi-file-outline webix_chat_file_icon'></span>\" +\n\t\t\t\"<div class='webix_chat_file_section'>\" +\n\t\t\tthis.FileNameTemplate(name) +\n\t\t\t`<div class=\"webix_chat_file_size\">${this.FormatBytes(size)}</div>` +\n\t\t\t\"</div></a>\"\n\t\t);\n\t}\n\n\t/**\n\t * Styles a link the user sent\n\t * @param {Object} obj - message object\n\t * @returns {string} a styled link\n\t */\n\tMessageTemplateLink(obj) {\n\t\tif (obj.type) return obj.text;\n\t\tconst text = obj.text.replace(/(https?:\\/\\/[^\\s]+)/g, this.Preview);\n\n\t\treturn text;\n\t}\n\t/**\n\t * Generates a preview for files and links\n\t * @param {string} url - URL to download file or link URL\n\t * @param {string} preview - file/link preview\n\t * @param {string} name - file/link name\n\t * @param {number} size - size in bytes\n\t * @returns {string} an HTML template for file preview or styled link\n\t */\n\tPreview(url, preview, name, size) {\n\t\turl = webix.template.escape(url);\n\t\tlet html = \"\",\n\t\t\tcss = \"\";\n\t\tif (url.match(/.(jpg|jpeg|png|gif)$/)) {\n\t\t\t// check \"this\" to detect external image link\n\t\t\tif (this && name) {\n\t\t\t\treturn (\n\t\t\t\t\tthis.FileLinkTemplate(url, name, size) +\n\t\t\t\t\t\"<br/><a target='_blank' class='webix_chat_preview_lnk' href='\" +\n\t\t\t\t\turl +\n\t\t\t\t\t\"'>\" +\n\t\t\t\t\t\"<img class='webix_comments_image' src='\" +\n\t\t\t\t\tpreview +\n\t\t\t\t\t\"' />\" +\n\t\t\t\t\t\"</a>\"\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\thtml +=\n\t\t\t\t\t\"<img class='webix_comments_image webix_comments_image_link' src='\" +\n\t\t\t\t\tpreview +\n\t\t\t\t\t\"'/>\" +\n\t\t\t\t\t\"<div class='webix_chat_file_name_link'>\" +\n\t\t\t\t\turl +\n\t\t\t\t\t\"</div>\";\n\t\t\t}\n\t\t} else html += url;\n\t\treturn (\n\t\t\t\"<a target='_blank' class='\" +\n\t\t\tcss +\n\t\t\t\"' href='\" +\n\t\t\turl +\n\t\t\t\"'>\" +\n\t\t\thtml +\n\t\t\t\"</a>\"\n\t\t);\n\t}\n\n\t/**\n\t * Add errors handler for images\n\t */\n\tAddImageHandler() {\n\t\twebix.event(this.Comments.$view, \"error\", e => this.ImageErrorHandler(e), {\n\t\t\tcapture: true,\n\t\t});\n\t}\n\t/**\n\t * Handles errors thrown from image processing\n\t * @param {Object} e - error event object\n\t */\n\tImageErrorHandler(e) {\n\t\tconst trg = e.target;\n\t\tif (trg.className.indexOf(\"webix_comments_image\") != -1)\n\t\t\ttrg.className += \" webix_chat_onerror\";\n\t}\n\n\t/**\n\t * Creates a template for file name if it exceeds 40 chars\n\t * @param {string} s - file name\n\t * @returns {string} a template string for file name (extended with ellipsis if name exceeds the limit)\n\t */\n\tFileNameTemplate(s) {\n\t\tif (s.length > 40)\n\t\t\treturn s.substring(0, 20) + \"...\" + s.substring(s.length - 20, s.length);\n\t\treturn s;\n\t}\n\n\t/**\n\t * Creates an HTML template for user avatar in message area\n\t * @param {Object} obj - message object\n\t * @returns {string} a string with an HTML template for user avatar in the message view\n\t */\n\tMessageTemplateAvatar(obj) {\n\t\tlet html = \"<div class='webix_chat_list_avatar'>\";\n\t\tconst users = this.Comments.getUsers();\n\t\tconst user =\n\t\t\tusers && users.exists(obj.user_id) ? users.getItem(obj.user_id) : {};\n\t\tif (user.status) html += this.Helpers.status(user);\n\t\thtml += this.Helpers.avatar(user);\n\t\thtml += \"</div>\";\n\t\treturn html;\n\t}\n\n\t/**\n\t * Creates an HTML template for user name in message area\n\t * @param {Object} obj - message object\n\t * @returns {string} a string with an HTML template for user name in the message view\n\t */\n\tMessageTemplateUser(obj) {\n\t\tconst users = this.Comments.getUsers();\n\t\tlet user =\n\t\t\tusers && users.exists(obj.user_id) ? users.getItem(obj.user_id) : {};\n\n\t\treturn (\n\t\t\t\"<span class = 'webix_comments_name'>\" + (user.name || \"\") + \"</span>\"\n\t\t);\n\t}\n\n\t/**\n\t * Creates an HTML template for message menu\n\t * @param {Object} obj - message object\n\t * @returns {string} an HTML string with a template for menu (3 dots) or an empty string\n\t */\n\tMessageTemplateMenu() {\n\t\tconst withReactions = this.app.config.reactions;\n\n\t\tif (this.Comments.config.readonly) return \"\";\n\t\treturn (\n\t\t\t(withReactions\n\t\t\t\t? \"<span class='webix_icon chi-emoticon-outline webix_chat_reaction'></span>\"\n\t\t\t\t: \"\") + \"<span class='webix_icon wxi-dots webix_comments_menu'></span>\"\n\t\t);\n\t}\n\n\t/**\n\t * Creates an HTML template for message date\n\t * @param {Object} obj - message object\n\t * @returns {string} an HTML template for message date\n\t */\n\tMessageTemplateDate(obj) {\n\t\treturn obj.date\n\t\t\t? \"<span class='webix_comments_date'>\" +\n\t\t\t\t\tthis.Helpers.dateChatFormat(obj.date) +\n\t\t\t\t\t\"</span>\"\n\t\t\t: \"\";\n\t}\n\n\tFormConfig(config) {\n\t\tconst elements = config.rows[1].elements;\n\t\tconst textarea = elements[0];\n\t\tconst skin = webix.skin.$active;\n\t\ttextarea.view = \"chat-comments-text\";\n\t\tconfig.rows[1].minHeight = textarea.height = textarea.inactiveHeight =\n\t\t\tskin.inputHeight;\n\t\tconst button = elements[1].cols[1];\n\t\tbutton.autowidth = true;\n\t\tconst icons = [{}];\n\t\tif (this.app.config.files)\n\t\t\ticons.push({\n\t\t\t\tview: \"icon\",\n\t\t\t\ticon: \"chi-paperclip\",\n\t\t\t\tclick: () => {\n\t\t\t\t\tthis.Uploader.fileDialog();\n\t\t\t\t},\n\t\t\t});\n\t\tif (this.app.config.emojis)\n\t\t\ticons.push({\n\t\t\t\tview: \"icon\",\n\t\t\t\ticon: \"chi-emoticon-outline\",\n\t\t\t\tlocalId: \"emojiIcon\",\n\t\t\t});\n\n\t\tconfig.rows[1].rows = [\n\t\t\t{\n\t\t\t\tview: \"list\",\n\t\t\t\tcss: \"webix_chat_ulist\",\n\t\t\t\tlocalId: \"fileList\",\n\t\t\t\tautoheight: true,\n\t\t\t\tborderless: true,\n\t\t\t\ttemplate: obj => this.ListUploadTemplate(obj),\n\t\t\t\ttype: {\n\t\t\t\t\theight: skin.listItemHeight > 30 ? 30 : skin.listItemHeight,\n\t\t\t\t},\n\t\t\t\tonClick: {\n\t\t\t\t\twebix_icon: (ev, id) => {\n\t\t\t\t\t\tthis.StopUpload(id);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tcols: [\n\t\t\t\t\t{\n\t\t\t\t\t\tpadding: {\n\t\t\t\t\t\t\tright: 5,\n\t\t\t\t\t\t},\n\t\t\t\t\t\trows: icons,\n\t\t\t\t\t},\n\t\t\t\t\ttextarea,\n\t\t\t\t\t{\n\t\t\t\t\t\tpadding: { left: webix.skin.$active.layoutMargin.form },\n\t\t\t\t\t\tview: \"chat-comments-layout\",\n\t\t\t\t\t\trows: [{}, button],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t];\n\t\tdelete config.rows[1].elements;\n\t}\n\n\t/**\n\t * Creates an HTML template with details on file uploading\n\t * @param {Object} obj - Javascript File object\n\t * @returns {string} an HTML template with details on file uploading\n\t */\n\tListUploadTemplate(obj) {\n\t\tvar html = \"<div class='webix_chat_ulist_item'>\";\n\t\thtml += `<div class='webix_chat_upload_name'>${obj.name}</div>`;\n\t\tconst s = obj.status;\n\t\tif (s == \"exsize\" || s == \"error\") {\n\t\t\thtml += `<div class='webix_chat_upload_error' >${this._(\n\t\t\t\ts == \"exsize\" ? \"File size exceeds the limit\" : \"File upload error\"\n\t\t\t)}</div>`;\n\t\t} else {\n\t\t\thtml += \"<div class='webix_chat_upload_progress'>\";\n\t\t\thtml += `<div class='webix_chat_upload_progress_bar ${obj.status}'>&nbsp;</div>`;\n\t\t\thtml += \"</div>\";\n\t\t}\n\t\thtml += \"<div class='webix_icon wxi-close'></div>\";\n\t\thtml += this.UploadIconTemplate(obj);\n\t\thtml += \"</div>\";\n\n\t\treturn html;\n\t}\n\n\t/**\n\t * Inits the Uploader component\n\t */\n\tInitUploader() {\n\t\tconst uploader = this.Upload.getUploader(this.State.chatId, \"file\");\n\t\tuploader.addDropZone(this.getRoot().$view, \"\");\n\t\tthis.on(uploader.files.data, \"onStoreUpdated\", (id, data, mode) => {\n\t\t\tif (\n\t\t\t\tmode == \"update\" &&\n\t\t\t\tdata.status == \"transfer\" &&\n\t\t\t\tthis.$$(\"fileList\").getItem(id)\n\t\t\t) {\n\t\t\t\t// error event handler\n\t\t\t\tif (!data.percent)\n\t\t\t\t\tdata.xhr.addEventListener(\n\t\t\t\t\t\t\"error\",\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tdata.status = \"error\";\n\t\t\t\t\t\t\tdelete data.xhr;\n\t\t\t\t\t\t\tthis.$$(\"fileList\").updateItem(id, data);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfalse\n\t\t\t\t\t);\n\t\t\t\t// progress display\n\t\t\t\tthis.$$(\"fileList\")\n\t\t\t\t\t.getItemNode(id)\n\t\t\t\t\t.querySelector(\".webix_chat_upload_progress_bar\").style.width =\n\t\t\t\t\tdata.percent + \"%\";\n\t\t\t}\n\t\t});\n\t\tthis.on(this.app, \"onSizeExceed\", data =>\n\t\t\tthis.$$(\"fileList\").add({ ...data, status: \"exsize\" })\n\t\t);\n\t\tthis.on(uploader, \"onAfterFileAdd\", data => {\n\t\t\tthis.$$(\"fileList\").add({ ...data, status: \"transfer\" });\n\t\t});\n\t\tthis.on(uploader, \"onFileUpload\", (data, response) =>\n\t\t\tthis.UploadHandler(data, response)\n\t\t);\n\t\tthis.on(uploader, \"onFileUploadError\", (data, response) =>\n\t\t\tthis.UploadHandler(data, response)\n\t\t);\n\t}\n\n\t/**\n\t * Handles file uploading\n\t * @param {Object} data - upload data item\n\t * @param {Object} response - response object\n\t */\n\tUploadHandler(data, response) {\n\t\twebix.delay(\n\t\t\t() => {\n\t\t\t\tconst id = data.id,\n\t\t\t\t\tstatus = response.status;\n\t\t\t\tif (this.$$(\"fileList\").getItem(id)) {\n\t\t\t\t\tif (status == \"server\") this.$$(\"fileList\").remove(id);\n\t\t\t\t\telse this.$$(\"fileList\").updateItem(id, { status: response.status });\n\t\t\t\t}\n\t\t\t},\n\t\t\tnull,\n\t\t\t[],\n\t\t\tthis.UploadDelay\n\t\t);\n\t}\n\n\t/**\n\t * Stops file uploading\n\t * @param {number} id - file ID\n\t */\n\tStopUpload(id) {\n\t\tthis.$$(\"fileList\").remove(id);\n\t\tif (this.Uploader.files.getItem(id)) this.Uploader.stopUpload(id);\n\t}\n\n\t/**\n\t * Formats bytes to kilobytes\n\t * @param {number} bytes - file size in bytes\n\t * @returns {string} a string with kilobytes (e.g. 33.23 KB)\n\t */\n\tFormatBytes(bytes) {\n\t\tconst sizes = [\"B\", \"KB\", \"MB\", \"GB\"].map(a => this._(a));\n\t\tif (bytes == 0) return `0 ${sizes[0]}`;\n\t\tconst k = 1024;\n\t\tconst i = Math.floor(Math.log(bytes) / Math.log(k));\n\t\treturn parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + \" \" + sizes[i];\n\t}\n\n\t/**\n\t * Creates a template for uploading status icon\n\t * @param {Object} obj - Javascript File object\n\t * @returns {string} an HTML template for file uploading status icon\n\t */\n\tUploadIconTemplate(obj) {\n\t\tconst icon =\n\t\t\tobj.status != \"transfer\"\n\t\t\t\t? \"chi-alert-circle-outline webix_chat_upl_error_icon\"\n\t\t\t\t: \"\";\n\t\treturn \"<span class='webix_icon \" + icon + \"'></span>\";\n\t}\n\n\t/**\n\t * Disables the \"edit\" option in the message menu if it is a file\n\t * @param {Object} menu - menu component with the \"edit\" and \"remove\" options\n\t */\n\tShowMenuHandler(menu) {\n\t\tconst id = menu.getContext().id;\n\t\tconst item = this.Comments.getItem(id);\n\t\tif (item.type == 800) menu.disableItem(\"edit\");\n\t\telse menu.enableItem(\"edit\");\n\t\treturn true;\n\t}\n\n\tdestroy() {\n\t\tif (this._emojiEvent) webix.eventRemove(this._emojiEvent);\n\t}\n\n\t/**\n\t * Show emoji popup\n\t * @param e{Event} click event object\n\t * @param mode{string} popup mode (\"emoji\"|\"reaction\")\n\t */\n\tShowEmojis(e, activeId, mode) {\n\t\tif (!this.EmojiPopup) {\n\t\t\tthis.EmojiPopup = this.ui(EmojiPopup);\n\t\t\tthis.on(this.EmojiPopup.getRoot(), \"onHide\", () => {\n\t\t\t\tif (this.ReactionsMode)\n\t\t\t\t\tthis.List.removeCss(this.ReactionsActiveId, \"webix_active\");\n\t\t\t});\n\t\t}\n\t\tthis.ReactionsMode = mode;\n\t\tthis.ReactionsActiveId = activeId;\n\t\tthis.EmojiPopup.Show(e);\n\t}\n\tInitEmojis() {\n\t\tthis.Emojis = this.app.getService(\"emojis\");\n\t\t// emoji popup init ( click emoji icon to show )\n\t\tthis._emojiEvent = webix.event(this.$$(\"emojiIcon\").$view, \"click\", e => {\n\t\t\twebix.html.preventEvent(e);\n\t\t\tthis.ShowEmojis(e);\n\t\t});\n\t\tthis.textarea = this.Comments.queryView({ name: \"text\" });\n\t\tthis.on(this.app, \"pasteEmoji\", (id, item) => {\n\t\t\tif (this.ReactionsMode) {\n\t\t\t\tconst emojiStr = this.EmojiNameTemplate(item);\n\t\t\t\tthis.AddReaction(this.ReactionsActiveId, emojiStr);\n\t\t\t\tthis.EmojiPopup.Hide();\n\t\t\t} else this.PasteEmoji(item);\n\t\t});\n\t\t// init emoji suggest ( type \":{letter}\" to show)\n\t\tthis.EmojiSuggest = this.ui(new EmojiSuggest(this.app, this.Comments));\n\t\tthis.EmojiSuggest.LinkInput();\n\t}\n\n\t/**\n\t * Paste emoji\n\t * @param emoji{object} - emoji item object\n\t */\n\tPasteEmoji(emoji) {\n\t\tlet caretPos = this.textarea.getInputNode().selectionEnd;\n\t\tconst oldVal = this.textarea.getValue();\n\t\tconst str1 = oldVal.substring(0, caretPos);\n\t\tconst str2 = oldVal.substring(caretPos);\n\t\tconst emojiStr = this.EmojiNameTemplate(emoji);\n\t\tconst len = emojiStr.length;\n\t\tthis.textarea.setValue(str1 + emojiStr + str2);\n\t\tthis.EmojiPopup.Hide();\n\t\twebix.delay(() => {\n\t\t\tthis.Comments.focus();\n\t\t\tthis.textarea\n\t\t\t\t.getInputNode()\n\t\t\t\t.setSelectionRange(caretPos + len, caretPos + len);\n\t\t});\n\t}\n\n\tAddReaction(msgId, emojiStr) {\n\t\tconst msg = this.Comments.getItem(msgId);\n\t\tconst userId = this.app.config.user;\n\t\tif (\n\t\t\tmsg.user_id != userId &&\n\t\t\t(!msg.reactions || msg.reactions[emojiStr] != userId)\n\t\t)\n\t\t\tthis.Ops.addReaction(msgId, emojiStr).then(msg => {\n\t\t\t\tif (msg) {\n\t\t\t\t\tthis.Comments.updateItem(msgId, msg);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t/**\n\t * Value to insert into the comments textarea when emoji is selected in EmojiPopup\n\t * @param emoji{object} - emoji data object\n\t * @returns {string} template string\n\t */\n\tEmojiNameTemplate(emoji) {\n\t\treturn \":\" + emoji.name + \": \";\n\t}\n\n\tReactionsTemplate(obj, text) {\n\t\tconst reactions = this.GetReactionsList(obj);\n\t\tif (reactions) {\n\t\t\tconst button = this.IsUsersMessage(obj)\n\t\t\t\t? \"\"\n\t\t\t\t: \"<div class='webix_chat_reaction_add'>\" +\n\t\t\t\t  \"<span class='webix_icon chi-emoticon-outline'></span> <span class='webix_chat_reaction_plus'>+</span>\" +\n\t\t\t\t  \"</div>\";\n\n\t\t\treturn `${text}<div class=\"webix_chat_message_reactions\">${reactions}${button}</div>`;\n\t\t}\n\t\treturn text;\n\t}\n\n\treactedTooltipTemplate(users) {\n\t\t// param 'users' represents an array of user's id. Example: [2, 51, 17]\n\t\treturn users.reduce((res, id) => {\n\t\t\tlet name = this.Users.getItem(id).name;\n\t\t\tif (id == this.app.config.user) name += \" (you)\";\n\t\t\treturn !res ? name : res + \", \" + name;\n\t\t}, \"\");\n\t}\n\n\tGetReactionsList(obj) {\n\t\tconst reactions = obj.reactions || [];\n\n\t\tlet str = \"\";\n\t\tfor (let name in reactions) {\n\t\t\tconst emoji = this.Emojis.replaceEmoji(name);\n\t\t\tif (emoji) {\n\t\t\t\tconst r = reactions[name];\n\t\t\t\tconst tooltip = this.reactedTooltipTemplate(r);\n\t\t\t\tconst isUserReaction = r.includes(this.app.config.user);\n\t\t\t\tconst css =\n\t\t\t\t\t\"webix_chat_reaction_block\" +\n\t\t\t\t\t(isUserReaction ? \" webix_chat_user_reaction\" : \"\");\n\t\t\t\tstr += `<div class=\"${css}\" webix_tooltip=\"${tooltip}\" data-name=\"${name}\">${emoji}<span class=\"webix_chat_reaction_count\">${r.length}</span></div>`;\n\t\t\t}\n\t\t}\n\t\treturn str;\n\t}\n\tListConfig(config) {\n\t\tconst list = config.rows[0];\n\t\tlist.tooltip = {\n\t\t\ttemplate: \"\",\n\t\t\tcss: \"webix_chat_reaction_tooltip\",\n\t\t};\n\t\tif (!list.onClick) list.onClick = {};\n\t\tconst on = list.onClick;\n\t\ton.webix_chat_reaction = (e, id) => this.ShowReactionsPopup(e, id);\n\t\ton.webix_chat_reaction_add = (e, id) => this.ShowReactionsPopup(e, id);\n\t\ton.webix_chat_reaction_block = (e, id, t) =>\n\t\t\tthis.ReactionClickHandler(id, t);\n\t}\n\tReactionClickHandler(id, trg) {\n\t\tconst emoji = trg.getAttribute(\"data-name\");\n\t\tif (this.IsUsersReaction(id, emoji)) {\n\t\t\tthis.Ops.removeReaction(parseInt(id), emoji).then(msg => {\n\t\t\t\tif (msg) {\n\t\t\t\t\tthis.Comments.updateItem(id, msg);\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthis.AddReaction(parseInt(id), emoji);\n\t\t}\n\t}\n\n\tShowReactionsPopup(e, id) {\n\t\tthis.List.addCss(id, \"webix_active\");\n\t\tconst intId = id * 1;\n\t\tif (!isNaN(intId)) id = intId;\n\t\tthis.ShowEmojis(e, id, \"reactions\");\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport \"../helpers/search\";\n\nimport { initRLayout } from \"@xbs/jet-helpers\";\n\nimport SideBar from \"./sidebar\";\nimport SideMenu from \"./compact/sidemenu\";\n\nexport default class TopView extends JetView {\n\tconfig() {\n\t\tinitRLayout();\n\t\tconst isSingle = this.app.config.mode === \"single\";\n\t\tconst fCompact = this.getParam(\"forceCompact\");\n\t\tconst isForced = !webix.isUndefined(fCompact) || isSingle;\n\n\t\tif (isForced) this.setParam(\"compact\", fCompact || isSingle);\n\t\tthis.Compact = this.getParam(\"compact\");\n\n\t\tlet cols = this.Compact\n\t\t\t? [{ $subview: true, name: \"center\" }]\n\t\t\t: [\n\t\t\t\t\tSideBar,\n\t\t\t\t\t{ $subview: true, name: \"center\" },\n\t\t\t\t\t{ $subview: \"_hidden\", name: \"panel\" },\n\t\t\t  ];\n\n\t\treturn {\n\t\t\tview: \"r-layout\",\n\t\t\tid: \"main\",\n\t\t\tcss: \"webix_chat_main_layout\",\n\t\t\trows: [{ cols, margin: 0 }, { $subview: true, name: \"top\", popup: true }],\n\t\t};\n\t}\n\n\tinit() {\n\t\tconst local = this.app.getService(\"local\");\n\n\t\t// responsive UI\n\t\tconst root = this.getRoot();\n\t\tif (root.sizeTrigger)\n\t\t\troot.sizeTrigger(\n\t\t\t\tthis.app,\n\t\t\t\tmode => this.SetCompactMode(mode),\n\t\t\t\t!!this.Compact\n\t\t\t);\n\n\t\tthis.ShowDefaultChat();\n\n\t\tthis.on(this.app, \"showSidebar\", () => this.ShowSidebar());\n\n\t\tthis.on(this.app, \"showChat\", (type, id) => {\n\t\t\tlet userId = null;\n\t\t\tif (type === \"user\") {\n\t\t\t\tuserId = id;\n\t\t\t\t// check if we have such chat already\n\t\t\t\tlet chat = local.chats().find(a => a.direct_id == id, true);\n\t\t\t\tid = chat ? chat.id : null;\n\t\t\t} else {\n\t\t\t\t// check, is it user chat\n\t\t\t\tlet chat = local.chats().getItem(id);\n\t\t\t\tif (chat.direct_id) {\n\t\t\t\t\ttype = \"user\";\n\t\t\t\t\tuserId = chat.direct_id;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.ShowChat(type, id, userId);\n\t\t});\n\n\t\tthis.on(this.app, \"leaveChat\", chatId => {\n\t\t\tthis.LeaveChat(chatId);\n\t\t});\n\t\tthis.on(this.app, \"removeChatMember\", chatId => {\n\t\t\tthis.LeaveChat(chatId, true);\n\t\t});\n\n\t\tthis.on(this.app, \"newChat\", () => {\n\t\t\tthis.ShowChatWindow();\n\t\t});\n\t\tthis.on(this.app, \"chatInfo\", id => {\n\t\t\tthis.ShowChatInfo(id);\n\t\t});\n\t\tthis.on(this.app, \"newMembers\", id => {\n\t\t\tthis.ShowNewMembersWindow(id);\n\t\t});\n\t\tthis.on(this.app, \"startCall\", (id, chatId) => {\n\t\t\tthis.StartCall(id, chatId);\n\t\t});\n\n\t\tconst state = this.getParam(\"state\");\n\t\tthis.on(state.$changes, \"callId\", v => {\n\t\t\tif (v) {\n\t\t\t\tif (this.Compact) this.show(\"./call.panel\", { target: \"center\" });\n\t\t\t\telse {\n\t\t\t\t\tthis.show(\"./call.panel\", { target: \"panel\" });\n\t\t\t\t\tthis.show(\"./messages\", { target: \"center\" });\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.show(\"./messages\", { target: \"center\" });\n\t\t\t\tif (!this.Compact) this.show(\"_hidden\", { target: \"panel\" });\n\t\t\t}\n\t\t});\n\n\t\tconst back = this.app.getService(\"backend\");\n\t\tconst serverEvents = back.pubsub();\n\t\tconst callStatuses = back.callStatuses;\n\n\t\tthis.on(serverEvents, \"signal\", obj => {\n\t\t\tif (obj.type === \"active\") {\n\t\t\t\tif (!state.timer)\n\t\t\t\t\tback.callInfo().then(info => {\n\t\t\t\t\t\tconst start = new Date(info.start);\n\t\t\t\t\t\t//time on server and client may differ\n\t\t\t\t\t\t//exclude cases where state.time < 0\n\t\t\t\t\t\tconst date = Math.max(new Date(), start);\n\t\t\t\t\t\tstate.time = Math.floor((date - start) / 1000);\n\t\t\t\t\t\tthis.CallTimer();\n\t\t\t\t\t});\n\t\t\t} else if (obj.type === \"connect\") {\n\t\t\t\tconst info = JSON.parse(obj.msg);\n\n\t\t\t\tif (info.devices) {\n\t\t\t\t\t// current device is not used in the call\n\t\t\t\t\tif (info.devices.indexOf(this.app.config.device) == -1)\n\t\t\t\t\t\tthis.EndCall();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// already inside another call\n\t\t\t\tif (state.callId && info.id != state.callId) {\n\t\t\t\t\tif (info.status < 900) {\n\t\t\t\t\t\tback.updateCall(info.id, callStatuses[\"reject\"]);\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (info.start && !state.timer) this.CallTimer();\n\n\t\t\t\tif (info.status == callStatuses[\"init\"])\n\t\t\t\t\tstate.callChatId = state.chatId;\n\n\t\t\t\tlet callUsers = info.users;\n\t\t\t\tlet callId = info.id;\n\t\t\t\tlet callStatus = info.status;\n\n\t\t\t\tif (\n\t\t\t\t\tinfo.status == callStatuses[\"end\"] ||\n\t\t\t\t\tinfo.status == callStatuses[\"reject\"] ||\n\t\t\t\t\tinfo.status == callStatuses[\"ignore\"] ||\n\t\t\t\t\tinfo.status == callStatuses[\"lost\"]\n\t\t\t\t) {\n\t\t\t\t\tthis.EndCall();\n\t\t\t\t} else {\n\t\t\t\t\tstate.$batch({ callId, callStatus, callUsers });\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Ends a current call\n\t */\n\tEndCall() {\n\t\tconst state = this.getParam(\"state\");\n\t\tif (state.timer) clearInterval(state.timer);\n\t\tstate.$batch({\n\t\t\tcallId: 0,\n\t\t\tcallStatus: \"\",\n\t\t\tcallUsers: [],\n\t\t\tcallChatId: null,\n\t\t\ttimer: null,\n\t\t\ttime: null,\n\t\t});\n\t}\n\n\t/**\n\t * Shows the first chat by default\n\t */\n\tShowDefaultChat() {\n\t\tconst state = this.getParam(\"state\");\n\t\tconst chats = this.app.getService(\"local\").chats();\n\n\t\tchats.waitData.then(() => {\n\t\t\tif (!state.chatId) {\n\t\t\t\tif (!chats.count()) {\n\t\t\t\t\tif (this.Compact) this.ShowSidebar();\n\t\t\t\t} else {\n\t\t\t\t\tstate.chatId = chats.getFirstId();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Shows a specified chat\n\t * @param {string} chatType - \"user\" (for direct chat) or \"chat\" (for group chat)\n\t * @param {number} chatId - chat ID\n\t * @param {number} userId - user ID\n\t */\n\tShowChat(chatType, chatId, userId) {\n\t\tthis.getParam(\"state\").$batch({ chatId, chatType, userId });\n\t\tthis.show(\"_hidden\", { target: \"top\" });\n\t}\n\n\t/**\n\t * Shows the form for adding new chat\n\t */\n\tShowChatWindow() {\n\t\tthis.show(\"chat.new\", { target: \"top\" });\n\t}\n\n\t/**\n\t * Shows the window with the info of a specified chat\n\t * @param {number} id - chat ID\n\t */\n\tShowChatInfo(id) {\n\t\tthis.show(\"chat.info\", { target: \"top\", params: { id } });\n\t}\n\t/**\n\t * Shows the window with the members of a specified chat\n\t * @param {number} id - chat ID\n\t */\n\tShowNewMembersWindow(id) {\n\t\tthis.show(\"chat.members\", { target: \"top\", params: { id } });\n\t}\n\n\t/**\n\t * Is called when user leaves a chat (or has been kicked)\n\t * @param {number} id - user ID\n\t * @param {boolean} removed - true if user has been kicked by host\n\t */\n\tLeaveChat(id, removed) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst state = this.getParam(\"state\");\n\t\tif (id === state.chatId) {\n\t\t\tif (removed) webix.alert(_(\"You have been removed from the group\"));\n\t\t\tstate.$batch({ chatId: 0, chatType: \"\", userId: 0 });\n\t\t}\n\t}\n\n\t/**\n\t * Sets the current mode of the chat\n\t * @param {boolean} mode - true if the compact mode is active\n\t */\n\tSetCompactMode(mode) {\n\t\t// delay is necessary to prevent the refresh call\n\t\t// while this view is still in rendering process\n\t\twebix.delay(() => {\n\t\t\tthis.setParam(\"compact\", mode);\n\t\t\tthis.refresh();\n\t\t});\n\t}\n\n\t/**\n\t * Shows the sidebar with chats and users\n\t */\n\tShowSidebar() {\n\t\tif (!this.SideMenu || !this.SideMenu.getRoot())\n\t\t\tthis.SideMenu = this.ui(SideMenu);\n\n\t\tthis.SideMenu.Show();\n\t}\n\n\t/**\n\t * Initiates a call with a specified user in a specified chat\n\t * @param {number} withUser - user ID\n\t * @param {number} chatId - chat ID\n\t */\n\tStartCall(id, chatId) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst back = this.app.getService(\"backend\");\n\t\tback.startCall(id, chatId).catch(() => {\n\t\t\twebix.alert(_(\"Can't start the call\"));\n\t\t});\n\t}\n\n\t/**\n\t * Tracks the time a call is active\n\t */\n\tCallTimer() {\n\t\tconst state = this.getParam(\"state\");\n\n\t\tif (!state.time) state.time = 0;\n\n\t\tstate.timer = setInterval(() => {\n\t\t\tthis.app.callEvent(\"updateCallTime\", [++state.time]);\n\t\t}, 1000);\n\t}\n}\n","import ListView from \"./list\";\n\nexport default class UsersView extends ListView {\n\tinit() {\n\t\tconst users = this.app.getService(\"local\").users();\n\t\tthis.InitSelf(users);\n\t}\n\n\t/**\n\t * Filters and sorts users list\n\t */\n\tSyncHandler() {\n\t\tthis.$$(\"list\").data.filter(a => a.id != this.app.config.user);\n\t\tthis.$$(\"list\").data.silent(function() {\n\t\t\tthis.sort(\"name\", \"asc\");\n\t\t});\n\t}\n\n\t/**\n\t * Shows a specified private chat\n\t * @param {number} id - private chat ID\n\t */\n\tShowChat(id) {\n\t\tthis.app.callEvent(\"showChat\", [\"user\", id * 1]);\n\t}\n\n\t/**\n\t * Creates a template for users in private chats list\n\t * @param {Object} user - user object\n\t * @returns {string} an HTML template for user in private chats list\n\t */\n\tListTemplate(user) {\n\t\tconst helpers = this.app.getService(\"helpers\");\n\n\t\treturn (\n\t\t\thelpers.listAvatar(user) +\n\t\t\thelpers.addTextMark(user.name, this.EscapedSearchText)\n\t\t);\n\t}\n}\n","import m0 from \"./views/call/panel\";\nimport m1 from \"./views/chat/common/form\";\nimport m2 from \"./views/chat/common/people\";\nimport m3 from \"./views/chat/common/toolbar\";\nimport m4 from \"./views/chat/common/window\";\nimport m5 from \"./views/chat/info/form\";\nimport m6 from \"./views/chat/info/index.js\";\nimport m7 from \"./views/chat/info/info\";\nimport m8 from \"./views/chat/info/people\";\nimport m9 from \"./views/chat/members/index.js\";\nimport m10 from \"./views/chat/new/form\";\nimport m11 from \"./views/chat/new/index.js\";\nimport m12 from \"./views/chats\";\nimport m13 from \"./views/compact/sidemenu\";\nimport m14 from \"./views/list\";\nimport m15 from \"./views/messages/emojis\";\nimport m16 from \"./views/messages/emojisuggest\";\nimport m17 from \"./views/messages/index.js\";\nimport m18 from \"./views/messages/toolbar\";\nimport m19 from \"./views/sidebar\";\nimport m20 from \"./views/top\";\nimport m21 from \"./views/users\";\nimport { JetView } from \"webix-jet\";\n\nconst views = { JetView };\nviews[\"call/panel\"] = m0;\nviews[\"chat/common/form\"] = m1;\nviews[\"chat/common/people\"] = m2;\nviews[\"chat/common/toolbar\"] = m3;\nviews[\"chat/common/window\"] = m4;\nviews[\"chat/info/form\"] = m5;\nviews[\"chat/info\"] = m6;\nviews[\"chat/info/info\"] = m7;\nviews[\"chat/info/people\"] = m8;\nviews[\"chat/members\"] = m9;\nviews[\"chat/new/form\"] = m10;\nviews[\"chat/new\"] = m11;\nviews[\"chats\"] = m12;\nviews[\"compact/sidemenu\"] = m13;\nviews[\"list\"] = m14;\nviews[\"messages/emojis\"] = m15;\nviews[\"messages/emojisuggest\"] = m16;\nviews[\"messages\"] = m17;\nviews[\"messages/toolbar\"] = m18;\nviews[\"sidebar\"] = m19;\nviews[\"top\"] = m20;\nviews[\"users\"] = m21;\n\nexport default views;\n","export default class Local {\n\tconstructor(app) {\n\t\tthis.app = app;\n\n\t\tthis._messages = {};\n\t\tthis._subs = [];\n\t}\n\n\t/**\n\t * Gets the users data\n\t * @returns {Object|Promise} users collection directly or inside a promise\n\t */\n\tusers() {\n\t\tif (!this._users) {\n\t\t\tconst back = this.app.getService(\"backend\");\n\t\t\tthis._users = new webix.DataCollection({});\n\t\t\tback.users().then(d => this._users.parse(d));\n\n\t\t\tthis._subs.push(\n\t\t\t\tback.pubsub().attachEvent(\"users\", u => {\n\t\t\t\t\tconst { op, user_id, data } = u;\n\t\t\t\t\tlet user;\n\t\t\t\t\tswitch (op) {\n\t\t\t\t\t\tcase \"online\": {\n\t\t\t\t\t\t\tuser = this._users.getItem(user_id);\n\t\t\t\t\t\t\tif (user && user.status != data) {\n\t\t\t\t\t\t\t\tthis._users.updateItem(user_id, { status: data });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst chat = this._chats.find(a => a.direct_id == user_id, true);\n\t\t\t\t\t\t\tif (chat)\n\t\t\t\t\t\t\t\tthis._chats.updateItem(chat.id, { status: data ? 2 : 1 });\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t\treturn this._users;\n\t}\n\n\t/**\n\t * Gets the chats data\n\t * @returns {Object|Promise} chats collection directly or inside a promise\n\t */\n\tchats() {\n\t\tconst state = this.app.getState();\n\t\tif (!this._chats) {\n\t\t\tthis._chats = new webix.DataCollection({\n\t\t\t\tscheme: {\n\t\t\t\t\t$change: obj => {\n\t\t\t\t\t\tif (obj.date && typeof obj.date === \"string\")\n\t\t\t\t\t\t\tobj.date = new Date(obj.date);\n\t\t\t\t\t\tif (obj.direct_id) {\n\t\t\t\t\t\t\tconst user = this.users().getItem(obj.direct_id);\n\t\t\t\t\t\t\tif (!obj.name) obj.name = \"PM: \" + user.name;\n\t\t\t\t\t\t\tif (!obj.avatar) {\n\t\t\t\t\t\t\t\tobj.avatar = user.avatar;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tobj.status = user.status;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t$sort: {\n\t\t\t\t\t\tby: \"date\",\n\t\t\t\t\t\tdir: \"desc\",\n\t\t\t\t\t\tas: \"date\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tconst back = this.app.getService(\"backend\");\n\t\t\tPromise.all([back.chats(), this.users().waitData]).then(d => {\n\t\t\t\tthis._chats.parse(d[0]);\n\t\t\t});\n\n\t\t\tthis._subs.push(\n\t\t\t\tback.pubsub().attachEvent(\"chats\", c => {\n\t\t\t\t\tconst { op, chat_id, data } = c;\n\t\t\t\t\tlet update;\n\n\t\t\t\t\tswitch (op) {\n\t\t\t\t\t\tcase \"add\":\n\t\t\t\t\t\tcase \"update\":\n\t\t\t\t\t\t\t// user removed from the chat\n\t\t\t\t\t\t\tif (data.users.indexOf(this.app.config.user) == -1) {\n\t\t\t\t\t\t\t\tif (this._chats.exists(chat_id)) {\n\t\t\t\t\t\t\t\t\tthis.app.callEvent(\"removeChatMember\", [chat_id]);\n\t\t\t\t\t\t\t\t\tthis._chats.remove(chat_id);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// new chat created\n\t\t\t\t\t\t\tif (!this._chats.exists(chat_id)) this._chats.add(data, 0);\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t// chat updated\n\t\t\t\t\t\t\t\tupdate = {\n\t\t\t\t\t\t\t\t\tname: data.name,\n\t\t\t\t\t\t\t\t\tavatar: data.avatar,\n\t\t\t\t\t\t\t\t\tusers: data.users,\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tif (!data.direct_id) {\n\t\t\t\t\t\t\t\t\tupdate.direct_id = 0;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tthis._chats.updateItem(chat_id, update);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"message\":\n\t\t\t\t\t\t\tthis._chats.updateItem(chat_id, {\n\t\t\t\t\t\t\t\tmessage: data.message,\n\t\t\t\t\t\t\t\tmessage_type: data.message_type,\n\t\t\t\t\t\t\t\tdate: new Date(data.date),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t);\n\t\t\tthis._subs.push(\n\t\t\t\tback.pubsub().attachEvent(\"messages\", c => {\n\t\t\t\t\tconst { op, msg } = c;\n\t\t\t\t\tlet chat;\n\t\t\t\t\tswitch (op) {\n\t\t\t\t\t\tcase \"add\":\n\t\t\t\t\t\t\tchat = this._chats.getItem(msg.chat_id);\n\t\t\t\t\t\t\tif (chat) {\n\t\t\t\t\t\t\t\tif (state.chatId != chat.id) {\n\t\t\t\t\t\t\t\t\tthis._chats.updateItem(chat.id, {\n\t\t\t\t\t\t\t\t\t\tmessage: msg.text,\n\t\t\t\t\t\t\t\t\t\tmessage_type: msg.type,\n\t\t\t\t\t\t\t\t\t\tunread_count: chat.unread_count + 1,\n\t\t\t\t\t\t\t\t\t\tdate: msg.date,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthis._chats.updateItem(chat.id, {\n\t\t\t\t\t\t\t\t\t\tmessage: msg.text,\n\t\t\t\t\t\t\t\t\t\tmessage_type: msg.type,\n\t\t\t\t\t\t\t\t\t\tdate: msg.date,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tback.resetCounter(chat.id);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (this._chats.getIndexById(chat.id))\n\t\t\t\t\t\t\t\t\tthis._chats.moveTop(chat.id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t\treturn this._chats;\n\t}\n\n\t/**\n\t * Gets messages of a specified chat\n\t * @param {number} id - chat ID\n\t * @returns {Array} an array with message objects\n\t */\n\tmessages(id) {\n\t\t// ignore cache for now\n\t\t// const cache = this._messages[id];\n\t\t// if (cache)\n\t\t// \treturn cache;\n\n\t\tconst backs = this.app.getService(\"backend\");\n\t\treturn (this._messages[id] = backs.messages(id));\n\t}\n}\n","class t{constructor(t){const{url:e,token:s}=t;this._url=e,this._token=s,this._mode=1,this._seed=1,this._queue=[],this.data={},this.api={},this._events={}}headers(){return{Accept:\"application/json\",\"Content-Type\":\"application/json\",\"Remote-Token\":this._token}}fetch(t,e){const s={credentials:\"include\",headers:this.headers()};return e&&(s.method=\"POST\",s.body=e),fetch(t,s).then(t=>t.json())}load(t){return t&&(this._url=t),this.fetch(this._url).then(t=>this.parse(t))}parse(t){const{key:e,websocket:s}=t;e&&(this._token=t.key);for(const e in t.data)this.data[e]=t.data[e];for(const e in t.api){const s=this.api[e]={},i=t.api[e];for(const t in i)s[t]=this._wrapper(e+\".\"+t)}return s&&this.connect(),this}connect(){const t=this._socket;t&&(this._socket=null,t.onclose=function(){},t.close()),this._mode=2,this._socket=function(t,e,s,i){let n=e;\"/\"===n[0]&&(n=document.location.protocol+\"//\"+document.location.host+e);n=n.replace(/^http(s|):/,\"ws$1:\");const o=-1!=n.indexOf(\"?\")?\"&\":\"?\";n=`${n}${o}token=${s}&ws=1`;const r=new WebSocket(n);return r.onclose=()=>setTimeout(()=>t.connect(),2e3),r.onmessage=e=>{const s=JSON.parse(e.data);switch(s.action){case\"result\":t.result(s.body,[]);break;case\"event\":t.fire(s.body.name,s.body.value);break;case\"start\":i();break;default:t.onError(s.data)}},r}(this,this._url,this._token,()=>(this._mode=3,this._send(),this._resubscribe(),this))}_wrapper(t){return function(){const e=[].slice.call(arguments);let s=null;const i=new Promise((i,n)=>{s={data:{id:this._uid(),name:t,args:e},status:1,resolve:i,reject:n},this._queue.push(s)});return this.onCall(s,i),3===this._mode?this._send(s):setTimeout(()=>this._send(),1),i}.bind(this)}_uid(){return(this._seed++).toString()}_send(t){if(2==this._mode)return void setTimeout(()=>this._send(),100);const e=t?[t]:this._queue.filter(t=>1===t.status);if(!e.length)return;const s=e.map(t=>(t.status=2,t.data));3!==this._mode?this.fetch(this._url,JSON.stringify(s)).catch(t=>this.onError(t)).then(t=>this.result(t,s)):this._socket.send(JSON.stringify({action:\"call\",body:s}))}result(t,e){const s={};if(t)for(let e=0;e<t.length;e++)s[t[e].id]=t[e];else for(let t=0;t<e.length;t++)s[e[t].id]={id:e[t].id,error:\"Network Error\",data:null};for(let t=this._queue.length-1;t>=0;t--){const e=this._queue[t],i=s[e.data.id];i&&(this.onResponse(e,i),i.error?e.reject(i.error):e.resolve(i.data),this._queue.splice(t,1))}}on(t,e){const s=this._uid();let i=this._events[t];const n=!!i;return n||(i=this._events[t]=[]),i.push({id:s,handler:e}),n||3!=this._mode||this._socket.send(JSON.stringify({action:\"subscribe\",name:t})),{name:t,id:s}}_resubscribe(){if(3==this._mode)for(const t in this._events)this._socket.send(JSON.stringify({action:\"subscribe\",name:t}))}detach(t){if(!t){if(3==this._mode)for(const t in this._events)this._socket.send(JSON.stringify({action:\"unsubscribe\",key:t}));return void(this._events={})}const{id:e,name:s}=t,i=this._events[s];if(i){const t=i.filter(t=>t.id!=e);t.length?this._events[s]=t:(delete this._events[s],3==this._mode&&this._socket.send(JSON.stringify({action:\"unsubscribe\",name:s})))}}fire(t,e){const s=this._events[t];if(s)for(let t=0;t<s.length;t++)s[t].handler(e)}onError(t){return null}onCall(t,e){}onResponse(t,e){}}export{t as Client};\n//# sourceMappingURL=remote.es6.js.map\n","import { Client } from \"remote-client\";\n\nexport default class Backend {\n\tconstructor(app) {\n\t\tthis.app = app;\n\t\tconst remote = new Client({\n\t\t\turl: app.config.url,\n\t\t\ttoken: app.config.token,\n\t\t});\n\n\t\tthis._ready = remote.load().then(back => {\n\t\t\tthis._api = back.api;\n\t\t\tthis._data = back.data;\n\t\t\tthis._pubsub = {\n\t\t\t\tattachEvent: (name, handler) => back.on(name, handler),\n\t\t\t\tdetachEvent: ev => back.detach(ev),\n\t\t\t};\n\n\t\t\tconst id = (app.config.user = this._data.user);\n\t\t\tapp.config.device = this._data.device;\n\t\t\t// mark current user as online\n\t\t\tthis._data.users.forEach(a => {\n\t\t\t\tif (a.id === id) a.status = 2;\n\t\t\t});\n\t\t});\n\n\t\tthis.callStatuses = {\n\t\t\tinit: 1,\n\t\t\taccept: 2,\n\t\t\tactive: 3,\n\t\t\tdrop: 900,\n\t\t\treject: 901,\n\t\t\tend: 902,\n\t\t\tignore: 903,\n\t\t\tlost: 904,\n\t\t};\n\n\t\tthis.callMessages = {\n\t\t\t900: \"start\",\n\t\t\t901: \"reject\",\n\t\t\t902: \"ignore\",\n\t\t};\n\t}\n\n\tready() {\n\t\treturn this._ready;\n\t}\n\n\t/**\n\t * Loads users\n\t * @returns {Promise} a promise that resolves with an array of users\n\t */\n\tusers() {\n\t\treturn Promise.resolve(this._data.users);\n\t}\n\t/**\n\t * Loads chats\n\t * @returns {Promise} a promise that resolves with an array of chats\n\t */\n\tchats() {\n\t\treturn Promise.resolve(this._data.chats);\n\t}\n\t/**\n\t * Loads call data\n\t * @returns {Promise} a promise that resolves with a call object\n\t */\n\tcallInfo() {\n\t\treturn Promise.resolve(this._data.call);\n\t}\n\t/**\n\t * Creates a direct chat with a specified user\n\t * @param {number} uid - user ID\n\t * @returns {Promise} that resolves with an object containing data about the chat created (e.g. chat id, users involved, etc.)\n\t */\n\taddChat(uid) {\n\t\treturn this._api.chat.AddDirect(uid * 1);\n\t}\n\t/**\n\t * Retrieves all messages of a specified chat\n\t * @param {number} cid - chat ID\n\t * @returns {Promise} that resolves with an array with message objects (text, user id, message type, etc.)\n\t */\n\tmessages(cid) {\n\t\treturn this._api.message.GetAll(cid * 1).then(data => {\n\t\t\tdata.forEach(a => (a.date = new Date(a.date)));\n\t\t\treturn data;\n\t\t});\n\t}\n\t/**\n\t * Add new message to a specified chat\n\t * @param {number} cid - chat ID\n\t * @param {string} text - message text\n\t * @param {number} origin - message ID\n\t * @returns {Promise} that resolves with an object with message data (id, user id, message type, etc.)\n\t */\n\taddMessage(cid, text, origin) {\n\t\treturn this._api.message.Add(text, cid * 1, origin.toString()).then(a => {\n\t\t\ta.date = new Date(a.date);\n\t\t\treturn a;\n\t\t});\n\t}\n\n\t/**\n\t * Removes a specified message\n\t * @param {number} messageId - message ID\n\t * @returns {Promise} that resolves with an error or null (if deletion was successful)\n\t */\n\tremoveMessage(messageId) {\n\t\treturn this._api.message.Remove(messageId * 1);\n\t}\n\t/**\n\t * Updates a specified message\n\t * @param {number} messageId - message ID\n\t * @param {string} text - new message text\n\t * @returns {Promise} that resolves with an object with the updated message data\n\t */\n\tupdateMessage(messageId, text) {\n\t\treturn this._api.message.Update(messageId * 1, text);\n\t}\n\n\t/**\n\t * Resets counter of the unread messages of a specified chat\n\t * @param {number} cid - chat ID\n\t */\n\tresetCounter(cid) {\n\t\tthis._api.message.ResetCounter(cid * 1);\n\t}\n\n\t/**\n\t * Is called upon widget initialization\n\t * @returns {Object} an object with methods for attaching and detaching events\n\t */\n\tpubsub() {\n\t\treturn this._pubsub;\n\t}\n\n\t/**\n\t * Creates a group chat\n\t * @param {string} name - chat name\n\t * @param {string} avatar - URL to the chat avatar\n\t * @param {Array} users - contains ID of the users involved\n\t * @returns {Promise} that resolves with an object containing data of a newly created group chat\n\t */\n\taddGroupChat(name, avatar, users) {\n\t\treturn this._api.chat.AddGroup(name, avatar, users);\n\t}\n\n\t/**\n\t * Updates a specified chat\n\t * @param {number} id - chat ID\n\t * @param {string} name - chat name\n\t * @param {string} avatar - URL to the chat avatar\n\t * @returns {Promise} that resolves with an object containing data of the updated group chat\n\t */\n\tupdateChat(id, name, avatar) {\n\t\treturn this._api.chat.Update(id, name, avatar);\n\t}\n\n\t/**\n\t * Removes a specified user from a specified chat\n\t * @param {number} chatId - chat ID\n\t * @param {number} userId  - user ID\n\t * @returns {Promise} that resolves with an error or null (if deletion was successful)\n\t */\n\tleave(chatId, userId) {\n\t\treturn this._api.chat.Leave(chatId, userId);\n\t}\n\n\t/**\n\t * Add new users to a specified chat\n\t * @param {number} chatId - chat ID\n\t * @param {Array} users - an array containing ID of the users participating\n\t * @returns {Promise} that resolves with an object of the updated chat\n\t */\n\tsetUsers(chatId, users) {\n\t\treturn this._api.chat.SetUsers(chatId, users);\n\t}\n\n\t/**\n\t * Retrieves a URL for downloading avatar of a specified chat\n\t * @param {number} id - chat ID\n\t * @returns {string} a URL for downloading chat avatars\n\t */\n\tavatarUploadUrl(id) {\n\t\treturn this.app.config.url + `/chat/${id}/avatar`;\n\t}\n\n\t/**\n\t * Retrieves a URL for downloading file in a specified chat\n\t * @param {number} id - chat ID\n\t * @returns {string} a URL for downloading an uploaded file\n\t */\n\tfileUploadUrl(id) {\n\t\treturn this.app.config.url + `/chat/${id}/file`;\n\t}\n\n\t/**\n\t * Initiates a call with a specified user\n\t * @param {number} withUser - user ID\n\t * @param {number} chatID - chat ID\n\t * @returns {Promise} that resolves with an object containing call data\n\t */\n\tstartCall(withUser, chatID) {\n\t\treturn this._api.call.Start(withUser, chatID);\n\t}\n\n\t/**\n\t * Is called when call is accepted or canceled\n\t * @param {number} id - call ID\n\t * @param {number} value - call status code (1, 2, 900, etc.)\n\t * @returns {Promise} that resolves with an object with the data updated\n\t */\n\tupdateCall(id, value) {\n\t\treturn this._api.call.SetStatus(id, value);\n\t}\n\t/**\n\t * Is called to send a signal to the server, when certain call operations are performed.\n\t * @param {string} type - signal type (\"answer\", \"active\", etc.)\n\t * @param {Object} payload - object containing the `operation: status` pairs ({audio: true})\n\t * @returns {Promise} that resolves with an object containing the signal data\n\t */\n\tsignalCall(type, payload) {\n\t\treturn this._api.call.Signal(type, payload);\n\t}\n\n\taddReaction(msgId, reaction) {\n\t\treturn this._api.message.AddReaction(msgId, reaction).then(a => {\n\t\t\ta.date = new Date(a.date);\n\t\t\treturn a;\n\t\t});\n\t}\n\n\tremoveReaction(msgId, reaction) {\n\t\treturn this._api.message.RemoveReaction(msgId, reaction).then(a => {\n\t\t\ta.date = new Date(a.date);\n\t\t\treturn a;\n\t\t});\n\t}\n\tbasicEmojis() {\n\t\treturn Promise.resolve([\"+1\", \"-1\", \"smile\", \"frowning\", \"tada\", \"heart\"]);\n\t}\n}\n","export default class Operations {\n\tconstructor(_app) {\n\t\tthis._app = _app;\n\t\tthis._local = this._app.getService(\"local\");\n\t\tthis._back = this._app.getService(\"backend\");\n\t}\n\n\t/**\n\t * Creates a direct chat with a specified user\n\t * @param {number} userId - user ID\n\t * @returns {number} chat ID\n\t */\n\taddChat(userId) {\n\t\treturn this._back.addChat(userId).then(chat => {\n\t\t\tthis._local.chats().add(chat, 0);\n\t\t\treturn chat.id;\n\t\t});\n\t}\n\n\t/**\n\t * Adds new message to a specified chat\n\t * @param {number} cid - chat ID\n\t * @param {number} origin - message ID\n\t * @param {string} text - message text\n\t * @returns {Object} an object of a newly created message\n\t */\n\taddMessage(cid, origin, text) {\n\t\tconst chats = this._local.chats();\n\t\tchats.updateItem(cid, {\n\t\t\tmessage: this._getMessageText(text),\n\t\t\tmessage_type: 0,\n\t\t\tdate: new Date(),\n\t\t});\n\t\tif (chats.getIndexById(cid)) chats.moveTop(cid);\n\t\treturn this._back.addMessage(cid, text, origin);\n\t}\n\n\t/**\n\t * Removes a specified message\n\t * @param {number} id - message ID\n\t * @returns an error or null (if removal was successful)\n\t */\n\tremoveMessage(id) {\n\t\treturn this._back.removeMessage(id);\n\t}\n\n\t/**\n\t * Updates a specified message\n\t * @param {number} id - message ID\n\t * @param {string} text - new message text\n\t * @returns {Object} an object with the updated message data\n\t */\n\tupdateMessage(id, text) {\n\t\treturn this._back.updateMessage(id, text);\n\t}\n\t/**\n\t * Clips the message text to 80 characters\n\t * @param {string} text - origin message text\n\t * @returns {string} origin text if it does not exceed 80 chars, otherwise - part of the text (first 80 characters)\n\t */\n\t_getMessageText(text) {\n\t\tlet limit = 80;\n\t\tif (this._app.config.emojis) {\n\t\t\tconst arr = text.match(this._app.getService(\"emojis\").emojiRegExp);\n\t\t\tif (arr)\n\t\t\t\tarr.forEach(str => {\n\t\t\t\t\tlimit += str.length;\n\t\t\t\t});\n\t\t}\n\t\treturn text.substr(0, Math.min(text.length, limit));\n\t}\n\t/**\n\t * Resets counter of the unread messages in a specified chat\n\t * @param {number} cid - chat ID\n\t */\n\tresetCounter(cid) {\n\t\tthis._back.resetCounter(cid);\n\n\t\tconst chats = this._local.chats();\n\t\tif (chats.exists(cid)) {\n\t\t\tchats.updateItem(cid, { unread_count: 0 });\n\t\t}\n\t}\n\n\t/**\n\t * Creates a new group chat\n\t * @param {string} name - chat name\n\t * @param {string} avatar - URL to the chat avatar\n\t * @param {Array} users - an array with IDs of users involved\n\t * @returns {number} chat ID\n\t */\n\taddGroupChat(name, avatar, users) {\n\t\treturn this._back.addGroupChat(name, avatar, users).then(chat => {\n\t\t\tthis._local.chats().add(chat, 0);\n\t\t\treturn chat.id;\n\t\t});\n\t}\n\n\t/**\n\t * Updates a specified chat\n\t * @param {number} chatId - chat ID\n\t * @param {string} name - chat name\n\t * @param {string} avatar - URL to the chat avatar\n\t * @returns {Object} an object with the updated chat data\n\t */\n\tupdateChat(chatId, name, avatar) {\n\t\treturn this._back.updateChat(chatId, name, avatar).then(info => {\n\t\t\tthis._local.chats().updateItem(chatId, info);\n\t\t});\n\t}\n\n\t/**\n\t * Removes current user from a specified chat\n\t * @param {number} chatId - chat ID\n\t * @returns an error or null (if removal was successful)\n\t */\n\tleaveChat(chatId) {\n\t\treturn this._back.leave(chatId, this._app.config.user).then(() => {\n\t\t\tthis._app.callEvent(\"leaveChat\", [chatId]);\n\t\t\tthis._local.chats().remove(chatId);\n\t\t});\n\t}\n\n\t/**\n\t * Add users to a specified chat\n\t * @param {number} chatId - chat ID\n\t * @param {Array} users - an array containing ID of the users participating\n\t * @returns an error or null (if adding was successful)\n\t */\n\tsetUsers(chatId, users) {\n\t\treturn this._back.setUsers(chatId, users).then(info => {\n\t\t\tconst chat = this._local.chats();\n\t\t\tif (info.id == chatId) chat.updateItem(chatId, info);\n\t\t\telse {\n\t\t\t\tchat.add(info, 0);\n\t\t\t\tthis._app.callEvent(\"showChat\", [chat, info.id]);\n\t\t\t}\n\t\t});\n\t}\n\n\taddReaction(msgId, reaction) {\n\t\treturn this._back.addReaction(msgId, reaction);\n\t}\n\n\tremoveReaction(msgId, reaction) {\n\t\treturn this._back.removeReaction(msgId, reaction);\n\t}\n}\n","export default class UploadHandler {\n\tconstructor(app) {\n\t\tthis.app = app;\n\t\tthis.initUploader();\n\t\tthis.maxFileSize = 10000000;\n\t}\n\n\t/**\n\t * Creates an instance of the Uploader view\n\t */\n\tinitUploader() {\n\t\tthis.uploader = webix.ui({\n\t\t\tview: \"uploader\",\n\t\t\tapiOnly: true,\n\t\t\t// accept: \"image/*\",\n\t\t\tautosend: true,\n\t\t\ton: {\n\t\t\t\tonBeforeFileAdd: data => this.configUpload(data),\n\t\t\t},\n\t\t});\n\t}\n\n\tconfig(props) {\n\t\twebix.extend(this.uploader.config, props, true);\n\t}\n\n\t/**\n\t *\n\t * @param {number} chat - chat ID\n\t * @param {string} mode\t-\t\"avatar\" or \"file\"\n\t * @returns {Object} - the Uploader view\n\t */\n\tgetUploader(chat, mode) {\n\t\tthis._chat = chat;\n\t\tthis._mode = mode;\n\t\treturn this.uploader;\n\t}\n\n\t/**\n\t * Checks whether the size of the file being uploaded do not exceed the limit allowed\n\t * @param {Object} file - File object (https://developer.mozilla.org/en-US/docs/Web/API/File)\n\t * @returns {void|boolean} - if file size exceeds the limit, the method returns false\n\t */\n\tconfigUpload(file) {\n\t\tconst back = this.app.getService(\"backend\");\n\t\tthis.uploader.config.upload =\n\t\t\tthis._mode == \"file\"\n\t\t\t\t? back.fileUploadUrl(this._chat)\n\t\t\t\t: back.avatarUploadUrl(this._chat);\n\t\tthis.uploader.config.urlData = { token: this.app.config.token };\n\t\tif (file.size > this.maxFileSize) {\n\t\t\tthis.app.callEvent(\"onSizeExceed\", [file]);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * Opens a file browsing dialog on a client machine\n\t */\n\tfileDialog() {\n\t\tthis.uploader.fileDialog();\n\t}\n}\n","export default class Helpers {\n\tconstructor() {\n\t\t//status\n\t\tthis.statusMap = {\n\t\t\t1: \"none\",\n\t\t\t2: \"active\",\n\t\t\t3: \"busy\",\n\t\t\t4: \"away\",\n\t\t};\n\t\t// icons\n\t\tthis.checkedIcon = \"<span class='webix_icon wxi-checkbox-marked'></span>\";\n\t\tthis.notCheckedIcon = \"<span class='webix_icon wxi-checkbox-blank'></span>\";\n\t\t//date formats\n\t\tthis.dateMask = \"%d.%m.%Y\";\n\t\tthis.weekMask = \"%D\";\n\t\tthis.todayDateMask = \"%H:%i\";\n\t}\n\t/**\n\t * Defines an object with user data\n\t * @typedef User\n\t * @property {string} avatar - URL to user avatar\n\t * @property {string} email - user email\n\t * @property {number} id - user ID\n\t * @property {string} name - user name\n\t * @property {number} status - user status (1 - none, 2 - active, 3 - busy, 4 - away)\n\t */\n\t/**\n\t * Renders user current status (circle)\n\t * @param {User} user - user data\n\t * @returns {string} a string with an HTML markup for a status indicator\n\t */\n\tstatus(user) {\n\t\treturn (\n\t\t\t\"<span class = 'webix_chat_status webix_chat_status_\" +\n\t\t\tthis.statusMap[user.status] +\n\t\t\t\"'></span>\"\n\t\t);\n\t}\n\t/**\n\t * Defines an object with chat data\n\t * @typedef Chat\n\t * @property {string} avatar - URL to the chat avatar\n\t * @property {Object} date - date of the latest message on the chat\n\t * @property {number} direct_id - ID of the user in a private chat\n\t * @property {number} id - chat ID\n\t * @property {string} message - latest message of the chat\n\t * @property {number} message_type - message type\n\t * @property {string} name - chat name\n\t * @property {number} status - chat status\n\t * @property {number} unread_count - number of messages unread\n\t * @property {Array} users - an array with the ID of users involved\n\t */\n\t/**\n\t * Renders a list of users/chats avatars on the sidebar\n\t * @param {User|Chat} user - user/chat data\n\t * @param {string} cssClass - css class to apply to the list\n\t * @returns {string} a string with an HTML markup for the list\n\t */\n\tlistAvatar(user, cssClass) {\n\t\tlet css = typeof cssClass == \"string\" ? cssClass : \"webix_chat_list_avatar\";\n\t\tlet html = `<div class='${css}'>`;\n\t\tif (user.status) html += this.status(user);\n\t\thtml += this.avatar(user);\n\t\thtml += \"</div>\";\n\t\treturn html;\n\t}\n\n\t/**\n\t *\n\t * @param {string} name\n\t * @returns\n\t */\n\tinitials(name) {\n\t\tlet initials = name.match(/\\b\\w/g) || [];\n\t\treturn ((initials.shift() || \"\") + (initials.pop() || \"\")).toUpperCase();\n\t}\n\n\t/**\n\t * Creates a markup for user/chat avatar\n\t * @param {User} user - user data\n\t * @param {string} cssClass - css class to apply\n\t * @returns {string} a string with an HTML markup for a user/chat\n\t */\n\tavatar(user, cssClass) {\n\t\tlet css = typeof cssClass == \"string\" ? cssClass : \"webix_chat_avatar\";\n\t\tif (user.avatar) return `<img alt=\"\" class=\"${css}\" src=\"${user.avatar}\"/>`;\n\t\tif (!user.name) return `<div class='${css} webix_icon wxi-user'></div>`;\n\t\treturn `<div class='${css}'>${this.initials(user.name || \"\")}</div>`;\n\t}\n\n\t/**\n\t * Creates a markup for chat info avatar\n\t * @param {string} user - URL to the user avatar\n\t * @param {string} tooltip - tooltip text (e.g \"Avatar\", \"Change avatar\")\n\t * @returns {string} a string with an HTML markup for avatar\n\t */\n\tformAvatar(user, tooltip) {\n\t\tlet css = \"webix_chat_avatar\";\n\t\tif (user.avatar)\n\t\t\treturn `<img alt=\"\" title=\"${tooltip}\" class=\"${css}\" src=\"${user.avatar}\"/>`;\n\t\treturn `<div class='${css}  webix_icon chi-camera' title='${tooltip}'</div>`;\n\t}\n\n\t/**\n\t * Formats widget dates\n\t * @param {Object} date - JS date\n\t * @returns {string} date in the \"hh:mm\" format (e.g. 15:45)\n\t */\n\tdateChatFormat(date) {\n\t\tlet mask = this.dateMask;\n\t\tconst today = webix.Date.datePart(new Date(), true);\n\t\tconst day = webix.Date.datePart(date, true);\n\t\tif (webix.Date.equal(day, today)) mask = this.todayDateMask;\n\t\telse if (day > webix.Date.add(today, -7, \"day\")) mask = this.weekMask;\n\t\treturn webix.Date.dateToStr(mask)(date);\n\t}\n\n\t/**\n\t * Creates a list with chat users\n\t * @param {Array<User>} users - an array with user objects\n\t * @param {boolean} deleteIcon - defines whether to show an icon for deletion\n\t * @param {Array} groupUsers - an array with IDs of the users involved\n\t * @returns {string} a string with an HTML markup for people list\n\t */\n\tpeopleList(users, deleteIcon, groupUsers) {\n\t\tlet list = \"<ul class='webix_chat_peoplelist'>\";\n\t\tusers.forEach(user => {\n\t\t\tlist +=\n\t\t\t\t`<li class='webix_chat_peoplelist_item' data-id='${user.id}'>` +\n\t\t\t\t\"<div class='webix_chat_peoplelist_avatar'>\" +\n\t\t\t\tthis.avatar(user) +\n\t\t\t\t(groupUsers && groupUsers.indexOf(user.id) >= 0\n\t\t\t\t\t? \"<div class='webix_chat_group_user_marker'><span class='webix_icon wxi-check'></span></div>\"\n\t\t\t\t\t: \"\") +\n\t\t\t\t(deleteIcon\n\t\t\t\t\t? \"<div class='webix_chat_peoplelist_delete_icon'><span class='webix_icon wxi-close'></span></div>\"\n\t\t\t\t\t: \"\") +\n\t\t\t\t\"</div>\" +\n\t\t\t\t`<p class=\"webix_chat_peoplelist_item_name\">${user.name}</p></li>`;\n\t\t});\n\t\tlist += \"</ul>\";\n\t\treturn list;\n\t}\n\n\t/**\n\t * Adds a mark for text occurrence in a value\n\t * @param {string} value - matched value\n\t * @param {string} text - entered text\n\t * @returns {string} a string with an HTML markup for highlighted parts of the text\n\t */\n\taddTextMark(value, text) {\n\t\tif (!text) return value;\n\n\t\treturn value.replace(\n\t\t\tnew RegExp(\"(\" + text + \")\", \"ig\"),\n\t\t\t\"<span class='webix_chat_search_mark'>$1</span>\"\n\t\t);\n\t}\n\n\t/**\n\t * Converts every 60s second into a minute (e.g. 62 -> 1:02)\n\t * @param {number} seconds - number of seconds\n\t * @returns {string} formatted string with minutes and seconds\n\t */\n\tnormalizeTime(seconds) {\n\t\tseconds = seconds || 0;\n\t\tconst min = Math.floor(seconds / 60);\n\t\tconst sec = seconds - min * 60;\n\t\treturn (min < 10 ? \"0\" + min : min) + \":\" + (sec < 10 ? \"0\" + sec : sec);\n\t}\n}\n","export const categories = {\n\t\"1\": \"People\",\n\t\"2\": \"Nature\",\n\t\"3\": \"Activity\",\n\t\"4\": \"Places\",\n\t\"5\": \"Foods\",\n\t\"6\": \"Objects\",\n\t\"7\": \"Symbols\",\n};\nexport const emojis = [\n\t[[\"watch\"], \"231A\", 6],\n\t[[\"soccer\"], \"26BD\", 3],\n\t[[\"heart\"], \"2764\", 7],\n\t[[\"green_apple\"], \"1F34F\", 5],\n\t[[\"dog\"], \"1F436\", 2],\n\t[[\"grinning\"], \"1F600\", 1],\n\t[[\"car\", \"red_car\"], \"1F697\", 4],\n\t[[\"apple\"], \"1F34E\", 5],\n\t[[\"basketball\"], \"1F3C0\", 3],\n\t[[\"cat\"], \"1F431\", 2],\n\t[[\"yellow_heart\"], \"1F49B\", 7],\n\t[[\"iphone\"], \"1F4F1\", 6],\n\t[[\"smiley\"], \"1F603\", 1],\n\t[[\"taxi\"], \"1F695\", 4],\n\t[[\"pear\"], \"1F350\", 5],\n\t[[\"football\"], \"1F3C8\", 3],\n\t[[\"mouse\"], \"1F42D\", 2],\n\t[[\"green_heart\"], \"1F49A\", 7],\n\t[[\"calling\"], \"1F4F2\", 6],\n\t[[\"smile\"], \"1F604\", 1],\n\t[[\"blue_car\"], \"1F699\", 4],\n\t[[\"baseball\"], \"26BE\", 3],\n\t[[\"tangerine\"], \"1F34A\", 5],\n\t[[\"hamster\"], \"1F439\", 2],\n\t[[\"blue_heart\"], \"1F499\", 7],\n\t[[\"computer\"], \"1F4BB\", 6],\n\t[[\"grin\"], \"1F601\", 1],\n\t[[\"bus\"], \"1F68C\", 4],\n\t[[\"keyboard\"], \"2328\", 6],\n\t[[\"lemon\"], \"1F34B\", 5],\n\t[[\"tennis\"], \"1F3BE\", 3],\n\t[[\"rabbit\"], \"1F430\", 2],\n\t[[\"purple_heart\"], \"1F49C\", 7],\n\t[[\"laughing\", \"satisfied\"], \"1F606\", 1],\n\t[[\"trolleybus\"], \"1F68E\", 4],\n\t[[\"banana\"], \"1F34C\", 5],\n\t[[\"racing_car\"], \"1F3CE\", 4],\n\t[[\"volleyball\"], \"1F3D0\", 3],\n\t[[\"black_heart\"], \"1F5A4\", 7],\n\t[[\"desktop_computer\"], \"1F5A5\", 6],\n\t[[\"sweat_smile\"], \"1F605\", 1],\n\t[[\"fox_face\"], \"1F98A\", 2],\n\t[[\"watermelon\"], \"1F349\", 5],\n\t[[\"rugby_football\"], \"1F3C9\", 3],\n\t[[\"bear\"], \"1F43B\", 2],\n\t[[\"broken_heart\"], \"1F494\", 7],\n\t[[\"printer\"], \"1F5A8\", 6],\n\t[[\"joy\"], \"1F602\", 1],\n\t[[\"police_car\"], \"1F693\", 4],\n\t[[\"heavy_heart_exclamation_mark_ornament\"], \"2763\", 7],\n\t[[\"grapes\"], \"1F347\", 5],\n\t[[\"8ball\"], \"1F3B1\", 3],\n\t[[\"panda_face\"], \"1F43C\", 2],\n\t[[\"three_button_mouse\"], \"1F5B1\", 6],\n\t[[\"ambulance\"], \"1F691\", 4],\n\t[[\"rolling_on_the_floor_laughing\"], \"1F923\", 1],\n\t[[\"relaxed\"], \"263A\", 1],\n\t[[\"strawberry\"], \"1F353\", 5],\n\t[[\"table_tennis_paddle_and_ball\"], \"1F3D3\", 3],\n\t[[\"koala\"], \"1F428\", 2],\n\t[[\"two_hearts\"], \"1F495\", 7],\n\t[[\"trackball\"], \"1F5B2\", 6],\n\t[[\"fire_engine\"], \"1F692\", 4],\n\t[[\"melon\"], \"1F348\", 5],\n\t[[\"badminton_racquet_and_shuttlecock\"], \"1F3F8\", 3],\n\t[[\"tiger\"], \"1F42F\", 2],\n\t[[\"revolving_hearts\"], \"1F49E\", 7],\n\t[[\"joystick\"], \"1F579\", 6],\n\t[[\"blush\"], \"1F60A\", 1],\n\t[[\"minibus\"], \"1F690\", 4],\n\t[[\"cherries\"], \"1F352\", 5],\n\t[[\"heartbeat\"], \"1F493\", 7],\n\t[[\"compression\"], \"1F5DC\", 6],\n\t[[\"innocent\"], \"1F607\", 1],\n\t[[\"truck\"], \"1F69A\", 4],\n\t[[\"goal_net\"], \"1F945\", 3],\n\t[[\"lion_face\"], \"1F981\", 2],\n\t[[\"peach\"], \"1F351\", 5],\n\t[[\"ice_hockey_stick_and_puck\"], \"1F3D2\", 3],\n\t[[\"cow\"], \"1F42E\", 2],\n\t[[\"heartpulse\"], \"1F497\", 7],\n\t[[\"minidisc\"], \"1F4BD\", 6],\n\t[[\"slightly_smiling_face\"], \"1F642\", 1],\n\t[[\"articulated_lorry\"], \"1F69B\", 4],\n\t[[\"pineapple\"], \"1F34D\", 5],\n\t[[\"field_hockey_stick_and_ball\"], \"1F3D1\", 3],\n\t[[\"pig\"], \"1F437\", 2],\n\t[[\"sparkling_heart\"], \"1F496\", 7],\n\t[[\"floppy_disk\"], \"1F4BE\", 6],\n\t[[\"upside_down_face\"], \"1F643\", 1],\n\t[[\"tractor\"], \"1F69C\", 4],\n\t[[\"cricket_bat_and_ball\"], \"1F3CF\", 3],\n\t[[\"pig_nose\"], \"1F43D\", 2],\n\t[[\"cupid\"], \"1F498\", 7],\n\t[[\"cd\"], \"1F4BF\", 6],\n\t[[\"wink\"], \"1F609\", 1],\n\t[[\"scooter\"], \"1F6F4\", 4],\n\t[[\"kiwifruit\"], \"1F95D\", 5],\n\t[[\"golf\"], \"26F3\", 3],\n\t[[\"frog\"], \"1F438\", 2],\n\t[[\"gift_heart\"], \"1F49D\", 7],\n\t[[\"dvd\"], \"1F4C0\", 6],\n\t[[\"relieved\"], \"1F60C\", 1],\n\t[[\"bike\"], \"1F6B2\", 4],\n\t[[\"avocado\"], \"1F951\", 5],\n\t[[\"tomato\"], \"1F345\", 5],\n\t[[\"bow_and_arrow\"], \"1F3F9\", 3],\n\t[[\"monkey_face\"], \"1F435\", 2],\n\t[[\"heart_decoration\"], \"1F49F\", 7],\n\t[[\"vhs\"], \"1F4FC\", 6],\n\t[[\"heart_eyes\"], \"1F60D\", 1],\n\t[[\"motor_scooter\"], \"1F6F5\", 4],\n\t[[\"eggplant\"], \"1F346\", 5],\n\t[[\"fishing_pole_and_fish\"], \"1F3A3\", 3],\n\t[[\"racing_motorcycle\"], \"1F3CD\", 4],\n\t[[\"camera\"], \"1F4F7\", 6],\n\t[[\"kissing_heart\"], \"1F618\", 1],\n\t[[\"see_no_evil\"], \"1F648\", 2],\n\t[[\"camera_with_flash\"], \"1F4F8\", 6],\n\t[[\"kissing\"], \"1F617\", 1],\n\t[[\"hear_no_evil\"], \"1F649\", 2],\n\t[[\"rotating_light\"], \"1F6A8\", 4],\n\t[[\"boxing_glove\"], \"1F94A\", 3],\n\t[[\"cucumber\"], \"1F952\", 5],\n\t[[\"video_camera\"], \"1F4F9\", 6],\n\t[[\"kissing_smiling_eyes\"], \"1F619\", 1],\n\t[[\"speak_no_evil\"], \"1F64A\", 2],\n\t[[\"oncoming_police_car\"], \"1F694\", 4],\n\t[[\"martial_arts_uniform\"], \"1F94B\", 3],\n\t[[\"carrot\"], \"1F955\", 5],\n\t[[\"ice_skate\"], \"26F8\", 3],\n\t[[\"corn\"], \"1F33D\", 5],\n\t[[\"movie_camera\"], \"1F3A5\", 6],\n\t[[\"monkey\"], \"1F412\", 2],\n\t[[\"kissing_closed_eyes\"], \"1F61A\", 1],\n\t[[\"oncoming_bus\"], \"1F68D\", 4],\n\t[[\"hot_pepper\"], \"1F336\", 5],\n\t[[\"ski\"], \"1F3BF\", 3],\n\t[[\"chicken\"], \"1F414\", 2],\n\t[[\"film_projector\"], \"1F4FD\", 6],\n\t[[\"yum\"], \"1F60B\", 1],\n\t[[\"oncoming_automobile\"], \"1F698\", 4],\n\t[[\"skier\"], \"26F7\", 3],\n\t[[\"film_frames\"], \"1F39E\", 6],\n\t[[\"penguin\"], \"1F427\", 2],\n\t[[\"stuck_out_tongue_winking_eye\"], \"1F61C\", 1],\n\t[[\"oncoming_taxi\"], \"1F696\", 4],\n\t[[\"potato\"], \"1F954\", 5],\n\t[[\"sweet_potato\"], \"1F360\", 5],\n\t[[\"snowboarder\"], \"1F3C2\", 3],\n\t[[\"bird\"], \"1F426\", 2],\n\t[[\"telephone_receiver\"], \"1F4DE\", 6],\n\t[[\"stuck_out_tongue_closed_eyes\"], \"1F61D\", 1],\n\t[[\"aerial_tramway\"], \"1F6A1\", 4],\n\t[[\"phone\", \"telephone\"], \"260E\", 6],\n\t[[\"chestnut\"], \"1F330\", 5],\n\t[[\"baby_chick\"], \"1F424\", 2],\n\t[[\"stuck_out_tongue\"], \"1F61B\", 1],\n\t[[\"mountain_cableway\"], \"1F6A0\", 4],\n\t[[\"weight_lifter\"], \"1F3CB\", 3],\n\t[[\"hatching_chick\"], \"1F423\", 2],\n\t[[\"pager\"], \"1F4DF\", 6],\n\t[[\"suspension_railway\"], \"1F69F\", 4],\n\t[[\"money_mouth_face\"], \"1F911\", 1],\n\t[[\"peanuts\"], \"1F95C\", 5],\n\t[[\"honey_pot\"], \"1F36F\", 5],\n\t[[\"hatched_chick\"], \"1F425\", 2],\n\t[[\"fax\"], \"1F4E0\", 6],\n\t[[\"railway_car\"], \"1F683\", 4],\n\t[[\"hugging_face\"], \"1F917\", 1],\n\t[[\"fencer\"], \"1F93A\", 3],\n\t[[\"tv\"], \"1F4FA\", 6],\n\t[[\"train\"], \"1F68B\", 4],\n\t[[\"nerd_face\"], \"1F913\", 1],\n\t[[\"wrestlers\"], \"1F93C\", 3],\n\t[[\"croissant\"], \"1F950\", 5],\n\t[[\"duck\"], \"1F986\", 2],\n\t[[\"bread\"], \"1F35E\", 5],\n\t[[\"radio\"], \"1F4FB\", 6],\n\t[[\"sunglasses\"], \"1F60E\", 1],\n\t[[\"mountain_railway\"], \"1F69E\", 4],\n\t[[\"eagle\"], \"1F985\", 2],\n\t[[\"studio_microphone\"], \"1F399\", 6],\n\t[[\"monorail\"], \"1F69D\", 4],\n\t[[\"clown_face\"], \"1F921\", 1],\n\t[[\"baguette_bread\"], \"1F956\", 5],\n\t[[\"owl\"], \"1F989\", 2],\n\t[[\"level_slider\"], \"1F39A\", 6],\n\t[[\"bullettrain_side\"], \"1F684\", 4],\n\t[[\"face_with_cowboy_hat\"], \"1F920\", 1],\n\t[[\"person_doing_cartwheel\"], \"1F938\", 3],\n\t[[\"bat\"], \"1F987\", 2],\n\t[[\"cheese_wedge\"], \"1F9C0\", 5],\n\t[[\"control_knobs\"], \"1F39B\", 6],\n\t[[\"wolf\"], \"1F43A\", 2],\n\t[[\"smirk\"], \"1F60F\", 1],\n\t[[\"bullettrain_front\"], \"1F685\", 4],\n\t[[\"egg\"], \"1F95A\", 5],\n\t[[\"stopwatch\"], \"23F1\", 6],\n\t[[\"fried_egg\", \"cooking\"], \"1F373\", 5],\n\t[[\"boar\"], \"1F417\", 2],\n\t[[\"unamused\"], \"1F612\", 1],\n\t[[\"light_rail\"], \"1F688\", 4],\n\t[[\"timer_clock\"], \"23F2\", 6],\n\t[[\"horse\"], \"1F434\", 2],\n\t[[\"disappointed\"], \"1F61E\", 1],\n\t[[\"steam_locomotive\"], \"1F682\", 4],\n\t[[\"bacon\"], \"1F953\", 5],\n\t[[\"alarm_clock\"], \"23F0\", 6],\n\t[[\"person_with_ball\"], \"26F9\", 3],\n\t[[\"pensive\"], \"1F614\", 1],\n\t[[\"train2\"], \"1F686\", 4],\n\t[[\"pancakes\"], \"1F95E\", 5],\n\t[[\"unicorn_face\"], \"1F984\", 2],\n\t[[\"fried_shrimp\"], \"1F364\", 5],\n\t[[\"bee\", \"honeybee\"], \"1F41D\", 2],\n\t[[\"mantelpiece_clock\"], \"1F570\", 6],\n\t[[\"worried\"], \"1F61F\", 1],\n\t[[\"metro\"], \"1F687\", 4],\n\t[[\"handball\"], \"1F93E\", 3],\n\t[[\"hourglass\"], \"231B\", 6],\n\t[[\"poultry_leg\"], \"1F357\", 5],\n\t[[\"bug\"], \"1F41B\", 2],\n\t[[\"confused\"], \"1F615\", 1],\n\t[[\"tram\"], \"1F68A\", 4],\n\t[[\"hourglass_flowing_sand\"], \"23F3\", 6],\n\t[[\"meat_on_bone\"], \"1F356\", 5],\n\t[[\"slightly_frowning_face\"], \"1F641\", 1],\n\t[[\"station\"], \"1F689\", 4],\n\t[[\"butterfly\"], \"1F98B\", 2],\n\t[[\"white_frowning_face\"], \"2639\", 1],\n\t[[\"pizza\"], \"1F355\", 5],\n\t[[\"snail\"], \"1F40C\", 2],\n\t[[\"satellite_antenna\"], \"1F4E1\", 6],\n\t[[\"helicopter\"], \"1F681\", 4],\n\t[[\"hotdog\"], \"1F32D\", 5],\n\t[[\"golfer\"], \"1F3CC\", 3],\n\t[[\"shell\"], \"1F41A\", 2],\n\t[[\"battery\"], \"1F50B\", 6],\n\t[[\"persevere\"], \"1F623\", 1],\n\t[[\"small_airplane\"], \"1F6E9\", 4],\n\t[[\"airplane\"], \"2708\", 4],\n\t[[\"hamburger\"], \"1F354\", 5],\n\t[[\"beetle\"], \"1F41E\", 2],\n\t[[\"electric_plug\"], \"1F50C\", 6],\n\t[[\"confounded\"], \"1F616\", 1],\n\t[[\"fries\"], \"1F35F\", 5],\n\t[[\"surfer\"], \"1F3C4\", 3],\n\t[[\"ant\"], \"1F41C\", 2],\n\t[[\"bulb\"], \"1F4A1\", 6],\n\t[[\"tired_face\"], \"1F62B\", 1],\n\t[[\"airplane_departure\"], \"1F6EB\", 4],\n\t[[\"flashlight\"], \"1F526\", 6],\n\t[[\"spider\"], \"1F577\", 2],\n\t[[\"weary\"], \"1F629\", 1],\n\t[[\"airplane_arriving\"], \"1F6EC\", 4],\n\t[[\"stuffed_flatbread\"], \"1F959\", 5],\n\t[[\"taco\"], \"1F32E\", 5],\n\t[[\"swimmer\"], \"1F3CA\", 3],\n\t[[\"candle\"], \"1F56F\", 6],\n\t[[\"spider_web\"], \"1F578\", 2],\n\t[[\"triumph\"], \"1F624\", 1],\n\t[[\"rocket\"], \"1F680\", 4],\n\t[[\"burrito\"], \"1F32F\", 5],\n\t[[\"turtle\"], \"1F422\", 2],\n\t[[\"wastebasket\"], \"1F5D1\", 6],\n\t[[\"angry\"], \"1F620\", 1],\n\t[[\"satellite\"], \"1F6F0\", 4],\n\t[[\"water_polo\"], \"1F93D\", 3],\n\t[[\"snake\"], \"1F40D\", 2],\n\t[[\"seat\"], \"1F4BA\", 4],\n\t[[\"rage\"], \"1F621\", 1],\n\t[[\"oil_drum\"], \"1F6E2\", 6],\n\t[[\"green_salad\"], \"1F957\", 5],\n\t[[\"money_with_wings\"], \"1F4B8\", 6],\n\t[[\"no_mouth\"], \"1F636\", 1],\n\t[[\"canoe\"], \"1F6F6\", 4],\n\t[[\"shallow_pan_of_food\"], \"1F958\", 5],\n\t[[\"lizard\"], \"1F98E\", 2],\n\t[[\"boat\", \"sailboat\"], \"26F5\", 4],\n\t[[\"spaghetti\"], \"1F35D\", 5],\n\t[[\"dollar\"], \"1F4B5\", 6],\n\t[[\"neutral_face\"], \"1F610\", 1],\n\t[[\"scorpion\"], \"1F982\", 2],\n\t[[\"ramen\"], \"1F35C\", 5],\n\t[[\"yen\"], \"1F4B4\", 6],\n\t[[\"expressionless\"], \"1F611\", 1],\n\t[[\"rowboat\"], \"1F6A3\", 3],\n\t[[\"motor_boat\"], \"1F6E5\", 4],\n\t[[\"crab\"], \"1F980\", 2],\n\t[[\"stew\"], \"1F372\", 5],\n\t[[\"horse_racing\"], \"1F3C7\", 3],\n\t[[\"euro\"], \"1F4B6\", 6],\n\t[[\"hushed\"], \"1F62F\", 1],\n\t[[\"speedboat\"], \"1F6A4\", 4],\n\t[[\"squid\"], \"1F991\", 2],\n\t[[\"fish_cake\"], \"1F365\", 5],\n\t[[\"octopus\"], \"1F419\", 2],\n\t[[\"pound\"], \"1F4B7\", 6],\n\t[[\"frowning\"], \"1F626\", 1],\n\t[[\"passenger_ship\"], \"1F6F3\", 4],\n\t[[\"ferry\"], \"26F4\", 4],\n\t[[\"sushi\"], \"1F363\", 5],\n\t[[\"moneybag\"], \"1F4B0\", 6],\n\t[[\"anguished\"], \"1F627\", 1],\n\t[[\"bicyclist\"], \"1F6B4\", 3],\n\t[[\"shrimp\"], \"1F990\", 2],\n\t[[\"bento\"], \"1F371\", 5],\n\t[[\"tropical_fish\"], \"1F420\", 2],\n\t[[\"credit_card\"], \"1F4B3\", 6],\n\t[[\"open_mouth\"], \"1F62E\", 1],\n\t[[\"ship\"], \"1F6A2\", 4],\n\t[[\"anchor\"], \"2693\", 4],\n\t[[\"curry\"], \"1F35B\", 5],\n\t[[\"fish\"], \"1F41F\", 2],\n\t[[\"gem\"], \"1F48E\", 6],\n\t[[\"astonished\"], \"1F632\", 1],\n\t[[\"mountain_bicyclist\"], \"1F6B5\", 3],\n\t[[\"scales\"], \"2696\", 6],\n\t[[\"rice\"], \"1F35A\", 5],\n\t[[\"running_shirt_with_sash\"], \"1F3BD\", 3],\n\t[[\"blowfish\"], \"1F421\", 2],\n\t[[\"dizzy_face\"], \"1F635\", 1],\n\t[[\"construction\"], \"1F6A7\", 4],\n\t[[\"fuelpump\"], \"26FD\", 4],\n\t[[\"rice_ball\"], \"1F359\", 5],\n\t[[\"sports_medal\"], \"1F3C5\", 3],\n\t[[\"dolphin\", \"flipper\"], \"1F42C\", 2],\n\t[[\"wrench\"], \"1F527\", 6],\n\t[[\"flushed\"], \"1F633\", 1],\n\t[[\"rice_cracker\"], \"1F358\", 5],\n\t[[\"medal\"], \"1F396\", 3],\n\t[[\"hammer\"], \"1F528\", 6],\n\t[[\"scream\"], \"1F631\", 1],\n\t[[\"busstop\"], \"1F68F\", 4],\n\t[[\"shark\"], \"1F988\", 2],\n\t[[\"hammer_and_pick\"], \"2692\", 6],\n\t[[\"oden\"], \"1F362\", 5],\n\t[[\"whale\"], \"1F433\", 2],\n\t[[\"fearful\"], \"1F628\", 1],\n\t[[\"vertical_traffic_light\"], \"1F6A6\", 4],\n\t[[\"first_place_medal\"], \"1F947\", 3],\n\t[[\"dango\"], \"1F361\", 5],\n\t[[\"whale2\"], \"1F40B\", 2],\n\t[[\"cold_sweat\"], \"1F630\", 1],\n\t[[\"traffic_light\"], \"1F6A5\", 4],\n\t[[\"hammer_and_wrench\"], \"1F6E0\", 6],\n\t[[\"second_place_medal\"], \"1F948\", 3],\n\t[[\"pick\"], \"26CF\", 6],\n\t[[\"shaved_ice\"], \"1F367\", 5],\n\t[[\"crocodile\"], \"1F40A\", 2],\n\t[[\"world_map\"], \"1F5FA\", 4],\n\t[[\"cry\"], \"1F622\", 1],\n\t[[\"third_place_medal\"], \"1F949\", 3],\n\t[[\"ice_cream\"], \"1F368\", 5],\n\t[[\"trophy\"], \"1F3C6\", 3],\n\t[[\"leopard\"], \"1F406\", 2],\n\t[[\"nut_and_bolt\"], \"1F529\", 6],\n\t[[\"moyai\"], \"1F5FF\", 4],\n\t[[\"disappointed_relieved\"], \"1F625\", 1],\n\t[[\"gear\"], \"2699\", 6],\n\t[[\"icecream\"], \"1F366\", 5],\n\t[[\"rosette\"], \"1F3F5\", 3],\n\t[[\"tiger2\"], \"1F405\", 2],\n\t[[\"statue_of_liberty\"], \"1F5FD\", 4],\n\t[[\"drooling_face\"], \"1F924\", 1],\n\t[[\"chains\"], \"26D3\", 6],\n\t[[\"fountain\"], \"26F2\", 4],\n\t[[\"cake\"], \"1F370\", 5],\n\t[[\"reminder_ribbon\"], \"1F397\", 3],\n\t[[\"water_buffalo\"], \"1F403\", 2],\n\t[[\"sob\"], \"1F62D\", 1],\n\t[[\"birthday\"], \"1F382\", 5],\n\t[[\"ticket\"], \"1F3AB\", 3],\n\t[[\"ox\"], \"1F402\", 2],\n\t[[\"gun\"], \"1F52B\", 6],\n\t[[\"tokyo_tower\"], \"1F5FC\", 4],\n\t[[\"sweat\"], \"1F613\", 1],\n\t[[\"custard\"], \"1F36E\", 5],\n\t[[\"admission_tickets\"], \"1F39F\", 3],\n\t[[\"european_castle\"], \"1F3F0\", 4],\n\t[[\"cow2\"], \"1F404\", 2],\n\t[[\"bomb\"], \"1F4A3\", 6],\n\t[[\"sleepy\"], \"1F62A\", 1],\n\t[[\"lollipop\"], \"1F36D\", 5],\n\t[[\"circus_tent\"], \"1F3AA\", 3],\n\t[[\"japanese_castle\"], \"1F3EF\", 4],\n\t[[\"hocho\", \"knife\"], \"1F52A\", 6],\n\t[[\"sleeping\"], \"1F634\", 1],\n\t[[\"deer\"], \"1F98C\", 2],\n\t[[\"candy\"], \"1F36C\", 5],\n\t[[\"stadium\"], \"1F3DF\", 4],\n\t[[\"dromedary_camel\"], \"1F42A\", 2],\n\t[[\"dagger_knife\"], \"1F5E1\", 6],\n\t[[\"face_with_rolling_eyes\"], \"1F644\", 1],\n\t[[\"juggling\"], \"1F939\", 3],\n\t[[\"crossed_swords\"], \"2694\", 6],\n\t[[\"chocolate_bar\"], \"1F36B\", 5],\n\t[[\"ferris_wheel\"], \"1F3A1\", 4],\n\t[[\"camel\"], \"1F42B\", 2],\n\t[[\"thinking_face\"], \"1F914\", 1],\n\t[[\"popcorn\"], \"1F37F\", 5],\n\t[[\"roller_coaster\"], \"1F3A2\", 4],\n\t[[\"elephant\"], \"1F418\", 2],\n\t[[\"shield\"], \"1F6E1\", 6],\n\t[[\"lying_face\"], \"1F925\", 1],\n\t[[\"doughnut\"], \"1F369\", 5],\n\t[[\"carousel_horse\"], \"1F3A0\", 4],\n\t[[\"performing_arts\"], \"1F3AD\", 3],\n\t[[\"grimacing\"], \"1F62C\", 1],\n\t[[\"smoking\"], \"1F6AC\", 6],\n\t[[\"rhinoceros\"], \"1F98F\", 2],\n\t[[\"coffin\"], \"26B0\", 6],\n\t[[\"umbrella_on_ground\"], \"26F1\", 4],\n\t[[\"cookie\"], \"1F36A\", 5],\n\t[[\"art\"], \"1F3A8\", 3],\n\t[[\"zipper_mouth_face\"], \"1F910\", 1],\n\t[[\"gorilla\"], \"1F98D\", 2],\n\t[[\"funeral_urn\"], \"26B1\", 6],\n\t[[\"clapper\"], \"1F3AC\", 3],\n\t[[\"beach_with_umbrella\"], \"1F3D6\", 4],\n\t[[\"racehorse\"], \"1F40E\", 2],\n\t[[\"nauseated_face\"], \"1F922\", 1],\n\t[[\"glass_of_milk\"], \"1F95B\", 5],\n\t[[\"baby_bottle\"], \"1F37C\", 5],\n\t[[\"microphone\"], \"1F3A4\", 3],\n\t[[\"desert_island\"], \"1F3DD\", 4],\n\t[[\"amphora\"], \"1F3FA\", 6],\n\t[[\"pig2\"], \"1F416\", 2],\n\t[[\"sneezing_face\"], \"1F927\", 1],\n\t[[\"coffee\"], \"2615\", 5],\n\t[[\"mountain\"], \"26F0\", 4],\n\t[[\"headphones\"], \"1F3A7\", 3],\n\t[[\"goat\"], \"1F410\", 2],\n\t[[\"crystal_ball\"], \"1F52E\", 6],\n\t[[\"mask\"], \"1F637\", 1],\n\t[[\"tea\"], \"1F375\", 5],\n\t[[\"musical_score\"], \"1F3BC\", 3],\n\t[[\"snow_capped_mountain\"], \"1F3D4\", 4],\n\t[[\"ram\"], \"1F40F\", 2],\n\t[[\"prayer_beads\"], \"1F4FF\", 6],\n\t[[\"face_with_thermometer\"], \"1F912\", 1],\n\t[[\"sake\"], \"1F376\", 5],\n\t[[\"musical_keyboard\"], \"1F3B9\", 3],\n\t[[\"sheep\"], \"1F411\", 2],\n\t[[\"barber\"], \"1F488\", 6],\n\t[[\"mount_fuji\"], \"1F5FB\", 4],\n\t[[\"face_with_head_bandage\"], \"1F915\", 1],\n\t[[\"alembic\"], \"2697\", 6],\n\t[[\"volcano\"], \"1F30B\", 4],\n\t[[\"beer\"], \"1F37A\", 5],\n\t[[\"dog2\"], \"1F415\", 2],\n\t[[\"smiling_imp\"], \"1F608\", 1],\n\t[[\"drum_with_drumsticks\"], \"1F941\", 3],\n\t[[\"beers\"], \"1F37B\", 5],\n\t[[\"saxophone\"], \"1F3B7\", 3],\n\t[[\"desert\"], \"1F3DC\", 4],\n\t[[\"poodle\"], \"1F429\", 2],\n\t[[\"imp\"], \"1F47F\", 1],\n\t[[\"telescope\"], \"1F52D\", 6],\n\t[[\"trumpet\"], \"1F3BA\", 3],\n\t[[\"camping\"], \"1F3D5\", 4],\n\t[[\"cat2\"], \"1F408\", 2],\n\t[[\"japanese_ogre\"], \"1F479\", 1],\n\t[[\"microscope\"], \"1F52C\", 6],\n\t[[\"clinking_glasses\"], \"1F942\", 5],\n\t[[\"tent\"], \"26FA\", 4],\n\t[[\"wine_glass\"], \"1F377\", 5],\n\t[[\"guitar\"], \"1F3B8\", 3],\n\t[[\"rooster\"], \"1F413\", 2],\n\t[[\"japanese_goblin\"], \"1F47A\", 1],\n\t[[\"hole\"], \"1F573\", 6],\n\t[[\"violin\"], \"1F3BB\", 3],\n\t[[\"pill\"], \"1F48A\", 6],\n\t[[\"hankey\", \"poop\", \"shit\"], \"1F4A9\", 1],\n\t[[\"railway_track\"], \"1F6E4\", 4],\n\t[[\"tumbler_glass\"], \"1F943\", 5],\n\t[[\"turkey\"], \"1F983\", 2],\n\t[[\"cocktail\"], \"1F378\", 5],\n\t[[\"game_die\"], \"1F3B2\", 3],\n\t[[\"ghost\"], \"1F47B\", 1],\n\t[[\"syringe\"], \"1F489\", 6],\n\t[[\"dove_of_peace\"], \"1F54A\", 2],\n\t[[\"motorway\"], \"1F6E3\", 4],\n\t[[\"thermometer\"], \"1F321\", 6],\n\t[[\"tropical_drink\"], \"1F379\", 5],\n\t[[\"dart\"], \"1F3AF\", 3],\n\t[[\"building_construction\"], \"1F3D7\", 4],\n\t[[\"rabbit2\"], \"1F407\", 2],\n\t[[\"skull\"], \"1F480\", 1],\n\t[[\"skull_and_crossbones\"], \"2620\", 1],\n\t[[\"champagne\"], \"1F37E\", 5],\n\t[[\"bowling\"], \"1F3B3\", 3],\n\t[[\"factory\"], \"1F3ED\", 4],\n\t[[\"mouse2\"], \"1F401\", 2],\n\t[[\"toilet\"], \"1F6BD\", 6],\n\t[[\"video_game\"], \"1F3AE\", 3],\n\t[[\"house\"], \"1F3E0\", 4],\n\t[[\"rat\"], \"1F400\", 2],\n\t[[\"alien\"], \"1F47D\", 1],\n\t[[\"potable_water\"], \"1F6B0\", 6],\n\t[[\"spoon\"], \"1F944\", 5],\n\t[[\"fork_and_knife\"], \"1F374\", 5],\n\t[[\"slot_machine\"], \"1F3B0\", 3],\n\t[[\"house_with_garden\"], \"1F3E1\", 4],\n\t[[\"chipmunk\"], \"1F43F\", 2],\n\t[[\"space_invader\"], \"1F47E\", 1],\n\t[[\"shower\"], \"1F6BF\", 6],\n\t[[\"knife_fork_plate\"], \"1F37D\", 5],\n\t[[\"house_buildings\"], \"1F3D8\", 4],\n\t[[\"feet\", \"paw_prints\"], \"1F43E\", 2],\n\t[[\"bathtub\"], \"1F6C1\", 6],\n\t[[\"robot_face\"], \"1F916\", 1],\n\t[[\"jack_o_lantern\"], \"1F383\", 1],\n\t[[\"derelict_house_building\"], \"1F3DA\", 4],\n\t[[\"dragon\"], \"1F409\", 2],\n\t[[\"bath\"], \"1F6C0\", 6],\n\t[[\"office\"], \"1F3E2\", 4],\n\t[[\"dragon_face\"], \"1F432\", 2],\n\t[[\"smiley_cat\"], \"1F63A\", 1],\n\t[[\"bellhop_bell\"], \"1F6CE\", 6],\n\t[[\"cactus\"], \"1F335\", 2],\n\t[[\"department_store\"], \"1F3EC\", 4],\n\t[[\"key\"], \"1F511\", 6],\n\t[[\"smile_cat\"], \"1F638\", 1],\n\t[[\"christmas_tree\"], \"1F384\", 2],\n\t[[\"post_office\"], \"1F3E3\", 4],\n\t[[\"old_key\"], \"1F5DD\", 6],\n\t[[\"joy_cat\"], \"1F639\", 1],\n\t[[\"evergreen_tree\"], \"1F332\", 2],\n\t[[\"european_post_office\"], \"1F3E4\", 4],\n\t[[\"heart_eyes_cat\"], \"1F63B\", 1],\n\t[[\"door\"], \"1F6AA\", 6],\n\t[[\"deciduous_tree\"], \"1F333\", 2],\n\t[[\"hospital\"], \"1F3E5\", 4],\n\t[[\"smirk_cat\"], \"1F63C\", 1],\n\t[[\"couch_and_lamp\"], \"1F6CB\", 6],\n\t[[\"palm_tree\"], \"1F334\", 2],\n\t[[\"bank\"], \"1F3E6\", 4],\n\t[[\"kissing_cat\"], \"1F63D\", 1],\n\t[[\"bed\"], \"1F6CF\", 6],\n\t[[\"seedling\"], \"1F331\", 2],\n\t[[\"hotel\"], \"1F3E8\", 4],\n\t[[\"scream_cat\"], \"1F640\", 1],\n\t[[\"sleeping_accommodation\"], \"1F6CC\", 6],\n\t[[\"herb\"], \"1F33F\", 2],\n\t[[\"convenience_store\"], \"1F3EA\", 4],\n\t[[\"frame_with_picture\"], \"1F5BC\", 6],\n\t[[\"crying_cat_face\"], \"1F63F\", 1],\n\t[[\"shamrock\"], \"2618\", 2],\n\t[[\"school\"], \"1F3EB\", 4],\n\t[[\"pouting_cat\"], \"1F63E\", 1],\n\t[[\"shopping_bags\"], \"1F6CD\", 6],\n\t[[\"four_leaf_clover\"], \"1F340\", 2],\n\t[[\"love_hotel\"], \"1F3E9\", 4],\n\t[[\"open_hands\"], \"1F450\", 1],\n\t[[\"shopping_trolley\"], \"1F6D2\", 6],\n\t[[\"gift\"], \"1F381\", 6],\n\t[[\"bamboo\"], \"1F38D\", 2],\n\t[[\"wedding\"], \"1F492\", 4],\n\t[[\"raised_hands\"], \"1F64C\", 1],\n\t[[\"balloon\"], \"1F388\", 6],\n\t[[\"tanabata_tree\"], \"1F38B\", 2],\n\t[[\"classical_building\"], \"1F3DB\", 4],\n\t[[\"clap\"], \"1F44F\", 1],\n\t[[\"church\"], \"26EA\", 4],\n\t[[\"leaves\"], \"1F343\", 2],\n\t[[\"flags\"], \"1F38F\", 6],\n\t[[\"pray\"], \"1F64F\", 1],\n\t[[\"fallen_leaf\"], \"1F342\", 2],\n\t[[\"ribbon\"], \"1F380\", 6],\n\t[[\"mosque\"], \"1F54C\", 4],\n\t[[\"handshake\"], \"1F91D\", 1],\n\t[[\"maple_leaf\"], \"1F341\", 2],\n\t[[\"confetti_ball\"], \"1F38A\", 6],\n\t[[\"+1\", \"thumbsup\"], \"1F44D\", 1],\n\t[[\"synagogue\"], \"1F54D\", 4],\n\t[[\"mushroom\"], \"1F344\", 2],\n\t[[\"tada\"], \"1F389\", 6],\n\t[[\"-1\", \"thumbsdown\"], \"1F44E\", 1],\n\t[[\"kaaba\"], \"1F54B\", 4],\n\t[[\"shinto_shrine\"], \"26E9\", 4],\n\t[[\"ear_of_rice\"], \"1F33E\", 2],\n\t[[\"dolls\"], \"1F38E\", 6],\n\t[[\"facepunch\", \"punch\"], \"1F44A\", 1],\n\t[[\"fist\"], \"270A\", 1],\n\t[[\"izakaya_lantern\", \"lantern\"], \"1F3EE\", 6],\n\t[[\"bouquet\"], \"1F490\", 2],\n\t[[\"japan\"], \"1F5FE\", 4],\n\t[[\"tulip\"], \"1F337\", 2],\n\t[[\"wind_chime\"], \"1F390\", 6],\n\t[[\"rice_scene\"], \"1F391\", 4],\n\t[[\"left-facing_fist\"], \"1F91B\", 1],\n\t[[\"email\", \"envelope\"], \"2709\", 6],\n\t[[\"rose\"], \"1F339\", 2],\n\t[[\"national_park\"], \"1F3DE\", 4],\n\t[[\"right-facing_fist\"], \"1F91C\", 1],\n\t[[\"sunrise\"], \"1F305\", 4],\n\t[[\"envelope_with_arrow\"], \"1F4E9\", 6],\n\t[[\"hand_with_index_and_middle_fingers_crossed\"], \"1F91E\", 1],\n\t[[\"wilted_flower\"], \"1F940\", 2],\n\t[[\"v\"], \"270C\", 1],\n\t[[\"sunrise_over_mountains\"], \"1F304\", 4],\n\t[[\"sunflower\"], \"1F33B\", 2],\n\t[[\"incoming_envelope\"], \"1F4E8\", 6],\n\t[[\"stars\"], \"1F320\", 4],\n\t[[\"blossom\"], \"1F33C\", 2],\n\t[[\"e-mail\"], \"1F4E7\", 6],\n\t[[\"the_horns\", \"sign_of_the_horns\"], \"1F918\", 1],\n\t[[\"cherry_blossom\"], \"1F338\", 2],\n\t[[\"sparkler\"], \"1F387\", 4],\n\t[[\"ok_hand\"], \"1F44C\", 1],\n\t[[\"love_letter\"], \"1F48C\", 6],\n\t[[\"hibiscus\"], \"1F33A\", 2],\n\t[[\"fireworks\"], \"1F386\", 4],\n\t[[\"point_left\"], \"1F448\", 1],\n\t[[\"inbox_tray\"], \"1F4E5\", 6],\n\t[[\"city_sunrise\"], \"1F307\", 4],\n\t[[\"earth_americas\"], \"1F30E\", 2],\n\t[[\"point_right\"], \"1F449\", 1],\n\t[[\"outbox_tray\"], \"1F4E4\", 6],\n\t[[\"city_sunset\"], \"1F306\", 4],\n\t[[\"earth_africa\"], \"1F30D\", 2],\n\t[[\"point_up_2\"], \"1F446\", 1],\n\t[[\"package\"], \"1F4E6\", 6],\n\t[[\"earth_asia\"], \"1F30F\", 2],\n\t[[\"cityscape\"], \"1F3D9\", 4],\n\t[[\"label\"], \"1F3F7\", 6],\n\t[[\"point_down\"], \"1F447\", 1],\n\t[[\"point_up\"], \"261D\", 1],\n\t[[\"night_with_stars\"], \"1F303\", 4],\n\t[[\"full_moon\"], \"1F315\", 2],\n\t[[\"mailbox_closed\"], \"1F4EA\", 6],\n\t[[\"hand\", \"raised_hand\"], \"270B\", 1],\n\t[[\"milky_way\"], \"1F30C\", 4],\n\t[[\"waning_gibbous_moon\"], \"1F316\", 2],\n\t[[\"mailbox\"], \"1F4EB\", 6],\n\t[[\"bridge_at_night\"], \"1F309\", 4],\n\t[[\"last_quarter_moon\"], \"1F317\", 2],\n\t[[\"mailbox_with_mail\"], \"1F4EC\", 6],\n\t[[\"raised_back_of_hand\"], \"1F91A\", 1],\n\t[[\"foggy\"], \"1F301\", 4],\n\t[[\"waning_crescent_moon\"], \"1F318\", 2],\n\t[[\"mailbox_with_no_mail\"], \"1F4ED\", 6],\n\t[[\"raised_hand_with_fingers_splayed\"], \"1F590\", 1],\n\t[[\"new_moon\"], \"1F311\", 2],\n\t[[\"postbox\"], \"1F4EE\", 6],\n\t[[\"spock-hand\"], \"1F596\", 1],\n\t[[\"waxing_crescent_moon\"], \"1F312\", 2],\n\t[[\"wave\"], \"1F44B\", 1],\n\t[[\"postal_horn\"], \"1F4EF\", 6],\n\t[[\"first_quarter_moon\"], \"1F313\", 2],\n\t[[\"scroll\"], \"1F4DC\", 6],\n\t[[\"call_me_hand\"], \"1F919\", 1],\n\t[[\"moon\", \"waxing_gibbous_moon\"], \"1F314\", 2],\n\t[[\"muscle\"], \"1F4AA\", 1],\n\t[[\"page_with_curl\"], \"1F4C3\", 6],\n\t[[\"new_moon_with_face\"], \"1F31A\", 2],\n\t[[\"page_facing_up\"], \"1F4C4\", 6],\n\t[[\"middle_finger\", \"reversed_hand_with_middle_finger_extended\"], \"1F595\", 1],\n\t[[\"writing_hand\"], \"270D\", 1],\n\t[[\"full_moon_with_face\"], \"1F31D\", 2],\n\t[[\"bookmark_tabs\"], \"1F4D1\", 6],\n\t[[\"sun_with_face\"], \"1F31E\", 2],\n\t[[\"bar_chart\"], \"1F4CA\", 6],\n\t[[\"selfie\"], \"1F933\", 1],\n\t[[\"first_quarter_moon_with_face\"], \"1F31B\", 2],\n\t[[\"nail_care\"], \"1F485\", 1],\n\t[[\"chart_with_upwards_trend\"], \"1F4C8\", 6],\n\t[[\"last_quarter_moon_with_face\"], \"1F31C\", 2],\n\t[[\"ring\"], \"1F48D\", 1],\n\t[[\"chart_with_downwards_trend\"], \"1F4C9\", 6],\n\t[[\"crescent_moon\"], \"1F319\", 2],\n\t[[\"lipstick\"], \"1F484\", 1],\n\t[[\"spiral_note_pad\"], \"1F5D2\", 6],\n\t[[\"kiss\"], \"1F48B\", 1],\n\t[[\"dizzy\"], \"1F4AB\", 2],\n\t[[\"spiral_calendar_pad\"], \"1F5D3\", 6],\n\t[[\"star\"], \"2B50\", 2],\n\t[[\"lips\"], \"1F444\", 1],\n\t[[\"calendar\"], \"1F4C6\", 6],\n\t[[\"star2\"], \"1F31F\", 2],\n\t[[\"tongue\"], \"1F445\", 1],\n\t[[\"date\"], \"1F4C5\", 6],\n\t[[\"sparkles\"], \"2728\", 2],\n\t[[\"ear\"], \"1F442\", 1],\n\t[[\"card_index\"], \"1F4C7\", 6],\n\t[[\"zap\"], \"26A1\", 2],\n\t[[\"nose\"], \"1F443\", 1],\n\t[[\"card_file_box\"], \"1F5C3\", 6],\n\t[[\"footprints\"], \"1F463\", 1],\n\t[[\"fire\"], \"1F525\", 2],\n\t[[\"ballot_box_with_ballot\"], \"1F5F3\", 6],\n\t[[\"eye\"], \"1F441\", 1],\n\t[[\"boom\", \"collision\"], \"1F4A5\", 2],\n\t[[\"file_cabinet\"], \"1F5C4\", 6],\n\t[[\"comet\"], \"2604\", 2],\n\t[[\"eyes\"], \"1F440\", 1],\n\t[[\"clipboard\"], \"1F4CB\", 6],\n\t[[\"sunny\"], \"2600\", 2],\n\t[[\"file_folder\"], \"1F4C1\", 6],\n\t[[\"speaking_head_in_silhouette\"], \"1F5E3\", 1],\n\t[[\"mostly_sunny\", \"sun_small_cloud\"], \"1F324\", 2],\n\t[[\"bust_in_silhouette\"], \"1F464\", 1],\n\t[[\"open_file_folder\"], \"1F4C2\", 6],\n\t[[\"partly_sunny\"], \"26C5\", 2],\n\t[[\"busts_in_silhouette\"], \"1F465\", 1],\n\t[[\"card_index_dividers\"], \"1F5C2\", 6],\n\t[[\"barely_sunny\", \"sun_behind_cloud\"], \"1F325\", 2],\n\t[[\"baby\"], \"1F476\", 1],\n\t[[\"rolled_up_newspaper\"], \"1F5DE\", 6],\n\t[[\"partly_sunny_rain\", \"sun_behind_rain_cloud\"], \"1F326\", 2],\n\t[[\"boy\"], \"1F466\", 1],\n\t[[\"newspaper\"], \"1F4F0\", 6],\n\t[[\"rainbow\"], \"1F308\", 2],\n\t[[\"girl\"], \"1F467\", 1],\n\t[[\"notebook\"], \"1F4D3\", 6],\n\t[[\"cloud\"], \"2601\", 2],\n\t[[\"man\"], \"1F468\", 1],\n\t[[\"notebook_with_decorative_cover\"], \"1F4D4\", 6],\n\t[[\"rain_cloud\"], \"1F327\", 2],\n\t[[\"woman\"], \"1F469\", 1],\n\t[[\"ledger\"], \"1F4D2\", 6],\n\t[[\"thunder_cloud_and_rain\"], \"26C8\", 2],\n\t[[\"closed_book\"], \"1F4D5\", 6],\n\t[[\"lightning\", \"lightning_cloud\"], \"1F329\", 2],\n\t[[\"person_with_blond_hair\"], \"1F471\", 1],\n\t[[\"green_book\"], \"1F4D7\", 6],\n\t[[\"snow_cloud\"], \"1F328\", 2],\n\t[[\"older_man\"], \"1F474\", 1],\n\t[[\"blue_book\"], \"1F4D8\", 6],\n\t[[\"snowman\"], \"2603\", 2],\n\t[[\"older_woman\"], \"1F475\", 1],\n\t[[\"orange_book\"], \"1F4D9\", 6],\n\t[[\"snowman_without_snow\"], \"26C4\", 2],\n\t[[\"man_with_gua_pi_mao\"], \"1F472\", 1],\n\t[[\"books\"], \"1F4DA\", 6],\n\t[[\"snowflake\"], \"2744\", 2],\n\t[[\"book\", \"open_book\"], \"1F4D6\", 6],\n\t[[\"wind_blowing_face\"], \"1F32C\", 2],\n\t[[\"man_with_turban\"], \"1F473\", 1],\n\t[[\"bookmark\"], \"1F516\", 6],\n\t[[\"dash\"], \"1F4A8\", 2],\n\t[[\"link\"], \"1F517\", 6],\n\t[[\"tornado\", \"tornado_cloud\"], \"1F32A\", 2],\n\t[[\"cop\"], \"1F46E\", 1],\n\t[[\"paperclip\"], \"1F4CE\", 6],\n\t[[\"fog\"], \"1F32B\", 2],\n\t[[\"linked_paperclips\"], \"1F587\", 6],\n\t[[\"ocean\"], \"1F30A\", 2],\n\t[[\"construction_worker\"], \"1F477\", 1],\n\t[[\"triangular_ruler\"], \"1F4D0\", 6],\n\t[[\"droplet\"], \"1F4A7\", 2],\n\t[[\"straight_ruler\"], \"1F4CF\", 6],\n\t[[\"guardsman\"], \"1F482\", 1],\n\t[[\"sweat_drops\"], \"1F4A6\", 2],\n\t[[\"pushpin\"], \"1F4CC\", 6],\n\t[[\"umbrella_with_rain_drops\"], \"2614\", 2],\n\t[[\"round_pushpin\"], \"1F4CD\", 6],\n\t[[\"scissors\"], \"2702\", 6],\n\t[[\"sleuth_or_spy\"], \"1F575\", 1],\n\t[[\"lower_left_ballpoint_pen\"], \"1F58A\", 6],\n\t[[\"lower_left_fountain_pen\"], \"1F58B\", 6],\n\t[[\"black_nib\"], \"2712\", 6],\n\t[[\"lower_left_paintbrush\"], \"1F58C\", 6],\n\t[[\"lower_left_crayon\"], \"1F58D\", 6],\n\t[[\"memo\", \"pencil\"], \"1F4DD\", 6],\n\t[[\"pencil2\"], \"270F\", 6],\n\t[[\"mag\"], \"1F50D\", 6],\n\t[[\"mag_right\"], \"1F50E\", 6],\n\t[[\"lock_with_ink_pen\"], \"1F50F\", 6],\n\t[[\"closed_lock_with_key\"], \"1F510\", 6],\n\t[[\"lock\"], \"1F512\", 6],\n\t[[\"unlock\"], \"1F513\", 6],\n\t[[\"mother_christmas\"], \"1F936\", 1],\n\t[[\"santa\"], \"1F385\", 1],\n\t[[\"princess\"], \"1F478\", 1],\n\t[[\"prince\"], \"1F934\", 1],\n\t[[\"bride_with_veil\"], \"1F470\", 1],\n\t[[\"man_in_tuxedo\"], \"1F935\", 1],\n\t[[\"angel\"], \"1F47C\", 1],\n\t[[\"pregnant_woman\"], \"1F930\", 1],\n\t[[\"bow\"], \"1F647\", 1],\n\t[[\"information_desk_person\"], \"1F481\", 1],\n\t[[\"no_good\"], \"1F645\", 1],\n\t[[\"ok_woman\"], \"1F646\", 1],\n\t[[\"raising_hand\"], \"1F64B\", 1],\n\t[[\"face_palm\"], \"1F926\", 1],\n\t[[\"shrug\"], \"1F937\", 1],\n\t[[\"person_with_pouting_face\"], \"1F64E\", 1],\n\t[[\"person_frowning\"], \"1F64D\", 1],\n\t[[\"haircut\"], \"1F487\", 1],\n\t[[\"massage\"], \"1F486\", 1],\n\t[[\"man_in_business_suit_levitating\"], \"1F574\", 1],\n\t[[\"dancer\"], \"1F483\", 1],\n\t[[\"man_dancing\"], \"1F57A\", 1],\n\t[[\"dancers\"], \"1F46F\", 1],\n\t[[\"walking\"], \"1F6B6\", 1],\n\t[[\"runner\", \"running\"], \"1F3C3\", 1],\n\t[[\"couple\", \"man_and_woman_holding_hands\"], \"1F46B\", 1],\n\t[[\"two_women_holding_hands\"], \"1F46D\", 1],\n\t[[\"two_men_holding_hands\"], \"1F46C\", 1],\n\t[[\"family\", \"man-woman-boy\"], \"1F46A\", 1],\n\t[[\"hearts\"], \"2665\", 7],\n\t[[\"womans_clothes\"], \"1F45A\", 1],\n\t[[\"shirt\", \"tshirt\"], \"1F455\", 1],\n\t[[\"jeans\"], \"1F456\", 1],\n\t[[\"necktie\"], \"1F454\", 1],\n\t[[\"dress\"], \"1F457\", 1],\n\t[[\"bikini\"], \"1F459\", 1],\n\t[[\"kimono\"], \"1F458\", 1],\n\t[[\"high_heel\"], \"1F460\", 1],\n\t[[\"sandal\"], \"1F461\", 1],\n\t[[\"boot\"], \"1F462\", 1],\n\t[[\"mans_shoe\", \"shoe\"], \"1F45E\", 1],\n\t[[\"athletic_shoe\"], \"1F45F\", 1],\n\t[[\"womans_hat\"], \"1F452\", 1],\n\t[[\"tophat\"], \"1F3A9\", 1],\n\t[[\"mortar_board\"], \"1F393\", 1],\n\t[[\"crown\"], \"1F451\", 1],\n\t[[\"helmet_with_white_cross\"], \"26D1\", 1],\n\t[[\"school_satchel\"], \"1F392\", 1],\n\t[[\"pouch\"], \"1F45D\", 1],\n\t[[\"purse\"], \"1F45B\", 1],\n\t[[\"handbag\"], \"1F45C\", 1],\n\t[[\"briefcase\"], \"1F4BC\", 1],\n\t[[\"eyeglasses\"], \"1F453\", 1],\n\t[[\"dark_sunglasses\"], \"1F576\", 1],\n\t[[\"closed_umbrella\"], \"1F302\", 1],\n\t[[\"umbrella\"], \"2602\", 1],\n];\n","import { emojis } from \"../helpers/emojis\";\nexport default class Local {\n\tconstructor(app) {\n\t\tthis.app = app;\n\t\tthis.data = emojis;\n\t\tthis.buildNameMap();\n\t\tthis.emojiRegExp = /:([^ :]+)/gi;\n\t\tthis.symbol = \":\";\n\t}\n\n\t/**\n\t * Initiates a collection of emojis\n\t * @returns {Object} a collection of emojis\n\t */\n\temojis() {\n\t\tif (this._emojis) return this._emojis;\n\n\t\tconst emData = (this._emojis = new webix.DataCollection({}));\n\n\t\tconst data = this.getEmojiData(emojis);\n\t\temData.parse(data);\n\t\treturn emData;\n\t}\n\tgetEmojiData(arr) {\n\t\treturn arr.map(emoji => {\n\t\t\treturn {\n\t\t\t\tid: webix.uid(),\n\t\t\t\tname: emoji[0][0],\n\t\t\t\tunified: emoji[1],\n\t\t\t\tcategory: emoji[2],\n\t\t\t\tnames: emoji[0],\n\t\t\t};\n\t\t});\n\t}\n\t/**\n\t * Finds emoji in the message text and replaces with an html tag to show an icon\n\t * @param text {String} message text\n\t * @returns {string}\n\t */\n\treplaceEmoji(text) {\n\t\tconst matches = text.match(this.emojiRegExp);\n\t\tconst symbol = this.symbol;\n\t\tif (matches)\n\t\t\tmatches.forEach(str => {\n\t\t\t\tstr = str.replace(this.emojiRegExp, function(match, s) {\n\t\t\t\t\treturn s;\n\t\t\t\t});\n\t\t\t\tconst code = this.emojiNameMap[str];\n\t\t\t\tif (code)\n\t\t\t\t\ttext = text.replace(\n\t\t\t\t\t\tsymbol + str + symbol,\n\t\t\t\t\t\t\"<span class='webix_chat_emoji webix_chat_emoji_\" +\n\t\t\t\t\t\t\tcode +\n\t\t\t\t\t\t\t\"'></span>\"\n\t\t\t\t\t);\n\t\t\t});\n\n\t\treturn text;\n\t}\n\tbasicEmojis() {\n\t\tif (this._basicEmojis) return this._basicEmojis;\n\t\tconst emData = (this._basicEmojis = new webix.DataCollection({}));\n\t\tconst back = this.app.getService(\"backend\");\n\t\tback.basicEmojis().then(d => {\n\t\t\tconst arr = [];\n\t\t\td.forEach(name => {\n\t\t\t\tconst emoji = this.findEmojiByName(name);\n\t\t\t\tif (emoji) arr.push(emoji);\n\t\t\t});\n\t\t\temData.parse(this.getEmojiData(arr));\n\t\t});\n\t\treturn emData;\n\t}\n\tfindEmojiByName(name) {\n\t\treturn emojis.find(em => em[0].indexOf(name) != -1);\n\t}\n\tfindName(emoji, value) {\n\t\treturn value\n\t\t\t? emoji.names.find(n => n.toLowerCase().indexOf(value) != -1)\n\t\t\t: emoji.name;\n\t}\n\t/**\n\t * Creates a map of emojis with the \"name: code\" pairs\n\t */\n\tbuildNameMap() {\n\t\tthis.emojiNameMap = {};\n\t\temojis.forEach(em => {\n\t\t\tem[0].forEach(name => (this.emojiNameMap[name] = em[1]));\n\t\t});\n\t}\n\t/**\n\t * Inserts underscores instead of spaces in emoji names\n\t * @param {string} name - emoji name\n\t * @returns {string} emoji name with underscores instead of spaces\n\t */\n\tshortNameToTitle(name) {\n\t\tname = name.split(\"_\").join(\" \");\n\t\treturn name[0].toUpperCase() + name.substring(1).toLowerCase();\n\t}\n\t//{\"1\":\"People\",\"2\"\":\"Nature\",\"3\":\"Activity\",\"4\":\"Places\",\"5\":\"Foods\",\"6\":\"Objects\", \"7\":\"Symbols\"}\n\t/**\n\t * Creates an array of emoji categories:\n\t * {\"1\":\"People\",\"2\"\":\"Nature\",\"3\":\"Activity\",\"4\":\"Places\",\"5\":\"Foods\",\"6\":\"Objects\"}\n\t * @returns {Array} an array of emoji categories (objects)\n\t */\n\tcategories() {\n\t\tif (!this._categories)\n\t\t\tthis._categories = [\n\t\t\t\t{ id: \"basic\", icon: \"chi-star-outline\", name: \"Basic\" },\n\t\t\t\t{ id: 1, icon: \"chi-emoticon-outline\", name: \"Smileys & People\" },\n\t\t\t\t{ id: 2, icon: \"chi-cat\", name: \"Animals & Nature\" },\n\t\t\t\t{ id: 3, icon: \"chi-soccer\", name: \"Activity\" },\n\t\t\t\t{ id: 4, icon: \"chi-earth\", name: \"Travel & Places\" },\n\t\t\t\t{ id: 5, icon: \"chi-food-fork-drink\", name: \"Food & Drink\" },\n\t\t\t\t{ id: 7, icon: \"chi-heart-outline\", name: \"Symbols\" },\n\t\t\t\t{ id: 6, icon: \"chi-bullhorn-outline\", name: \"Objects\" },\n\t\t\t];\n\t\treturn this._categories;\n\t}\n}\n","import { JetApp, plugins, EmptyRouter } from \"webix-jet\";\nimport { initJetWin } from \"@xbs/jet-helpers\";\nimport { createState, link } from \"jet-restate\";\n\nimport views from \"./export_views\";\nimport en from \"locales/en\";\n\n// services\nimport Local from \"./models/Local\";\nimport Backend from \"./models/Backend\";\nimport Operations from \"./models/Operations\";\nimport Upload from \"./models/Upload\";\nimport Helpers from \"./models/Helpers\";\nimport Emojis from \"./models/Emojis\";\n\nexport class App extends JetApp {\n\tconstructor(config) {\n\t\tconst state = createState({\n\t\t\tchatId: 0,\n\t\t\tchatType: null,\n\t\t\tuserId: null,\n\t\t\tsearch: \"\",\n\t\t\tcallStatus: 0,\n\t\t\tcallId: 0,\n\t\t\tcallUsers: [],\n\t\t});\n\t\tconst params = { state };\n\t\tif (config.compaсt) params.forceCompact = config.compact;\n\t\tif (config.reactions && typeof !config.emojis) config.emojis = true;\n\n\t\tconst defaults = {\n\t\t\trouter: EmptyRouter,\n\t\t\tversion: VERSION,\n\t\t\tdebug: DEBUG,\n\t\t\tstart: \"/top\",\n\t\t\tmode: \"full\",\n\t\t\tcompactWidth: 650,\n\t\t\tparams: { state, forceCompact: config.compact },\n\t\t\tfiles: false,\n\t\t};\n\n\t\tsuper({ ...defaults, ...config });\n\n\t\t// better error reporting\n\t\tif (this.config.debug) {\n\t\t\twebix.Promise = window.Promise;\n\t\t}\n\n\t\tconst dynamic = obj =>\n\t\t\tthis.config.override ? this.config.override.get(obj) || obj : obj;\n\n\t\tthis.setService(\"local\", new (dynamic(Local))(this));\n\t\tthis.setService(\"backend\", new (dynamic(Backend))(this));\n\t\tthis.setService(\"operations\", new (dynamic(Operations))(this));\n\t\tthis.setService(\"upload\", new (dynamic(Upload))(this));\n\t\tthis.setService(\"helpers\", new (dynamic(Helpers))(this));\n\t\tthis.setService(\"emojis\", new (dynamic(Emojis))(this));\n\t\tinitJetWin(this);\n\n\t\tthis.use(\n\t\t\tplugins.Locale,\n\t\t\tthis.config.locale || {\n\t\t\t\tlang: \"en\",\n\t\t\t\twebix: {\n\t\t\t\t\ten: \"en-US\",\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\t}\n\n\trender(node) {\n\t\tconst back = this.getService(\"backend\");\n\t\tback\n\t\t\t.ready()\n\t\t\t.then(() => back.callInfo())\n\t\t\t.then(info => {\n\t\t\t\tif (info && info.id) {\n\t\t\t\t\tconst state = this.config.params.state;\n\t\t\t\t\tstate.$batch({\n\t\t\t\t\t\tcallId: info.id,\n\t\t\t\t\t\tcallUsers: info.users,\n\t\t\t\t\t\tcallStatus: info.status,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tsuper.render(node);\n\t\t\t});\n\t}\n\n\trequire(type, name) {\n\t\tif (type === \"jet-views\") return views[name];\n\t\telse if (type === \"jet-locales\") return locales[name];\n\n\t\treturn null;\n\t}\n\n\t// for external users\n\tgetState() {\n\t\treturn this.config.params.state;\n\t}\n}\n\nwebix.protoUI(\n\t{\n\t\tname: \"chat\",\n\t\tapp: App,\n\t\tgetState() {\n\t\t\treturn this.$app.getState();\n\t\t},\n\t\tgetService(name) {\n\t\t\treturn this.$app.getService(name);\n\t\t},\n\t\t$init() {\n\t\t\tthis.$view.className += \" webix_chat\";\n\n\t\t\tconst state = this.$app.getState();\n\t\t\tfor (let key in state) {\n\t\t\t\tlink(state, this.config, key);\n\t\t\t}\n\t\t},\n\t},\n\twebix.ui.jetapp\n);\n\n// re-export for customization\nconst services = { Local, Backend, Operations, Upload, Helpers, Emojis };\nconst locales = { en };\nexport { views, locales, services };\n","export default {\n\t\"Add members\": \"Add members\",\n\t\"Are you sure to leave this chat?\": \"Are you sure to leave this chat?\",\n\tAvatar: \"Avatar\",\n\t\"Are you sure to delete this member?\": \"Are you sure to delete this member?\",\n\tCancel: \"Cancel\",\n\t\"Change avatar\": \"Change avatar\",\n\t\"Chat info\": \"Chat info\",\n\t\"Chat name\": \"Chat name\",\n\tChats: \"Chats\",\n\t\"Create group\": \"Create group\",\n\tDelete: \"Delete\",\n\t\"Delete member\": \"Delete member\",\n\t\"Edit chat\": \"Edit chat\",\n\tLeave: \"Leave\",\n\t\"Leave chat\": \"Leave chat\",\n\tmember: \"member\",\n\tmembers: \"members\",\n\tMembers: \"Members\",\n\t\"New chat\": \"New chat\",\n\t\"No people to add\": \"No people to add\",\n\tPeople: \"People\",\n\tSave: \"Save\",\n\tSearch: \"Search\",\n\t\"Show all members\": \"Show all members\",\n\tUsers: \"Users\",\n\tYou: \"You\",\n\tRinging: \"Ringing...\",\n\t\"Active call\": \"Active call\",\n\t\"Is calling you\": \"Is calling you...\",\n\tAccept: \"Accept\",\n\tReject: \"Reject\",\n\t\"Start call\": \"Start call\",\n\t\"Join call\": \"Join call\",\n\t\"End call\": \"End call\",\n\t\"Ended call\": \"Ended call\",\n\t\"Incoming call\": \"Incoming call\",\n\t\"Outgoing call\": \"Outgoing call\",\n\t\"Rejected call\": \"Rejected call\",\n\t\"Missed call\": \"Missed call\",\n\t\"Can't start the call\": \"Can't start the call\",\n\t\"Could not find your\": \"Could not find your\",\n\t\"Error opening your\": \"Error opening your\",\n\tmicrophone: \"microphone\",\n\tcamera: \"camera\",\n\tSize: \"Size\",\n\tB: \"B\",\n\tKB: \"KB\",\n\tMB: \"MB\",\n\tGB: \"GB\",\n\t\"File size exceeds the limit\": \"File size exceeds the limit\",\n\t\"File upload error\": \"File upload error\",\n\t\"Smileys & People\": \"Smileys & People\",\n\t\"Animals & Nature\": \"Animals & Nature\",\n\tActivity: \"Activity\",\n\t\"Travel & Places\": \"Travel & Places\",\n\t\"Food & Drink\": \"Food & Drink\",\n\tObjects: \"Objects\",\n\t\"Search results\": \"Search results\",\n\tSymbols: \"Symbols\",\n\tBasic: \"Basic\",\n};\n"],"names":["webix","config","this","webixJet","_events","_subs","_data","params","extend","JetBase","_root","_detachEvents","_destroySubs","_container","app","_parent","id","value","url","_segment","update","show","parent","view","getParentView","getParam","suburl","toString","root_1","getRoot","queryView","obj","localId","$scope","name","code","attachEvent","push","key","kid","contains","sub","getSubViewInfo","subview","popup","events","i","length","detachEvent","subView","destructor","current","default","branch","child","_getDefaultSub","_routed_view","parse","substr","parts","split","chunks","test","result","pos","indexOf","params_1","_i","dchunk","decodeURIComponent","page","isNew","url2str","stack","stack_1","chunk","obj2str","join","str","encodeURIComponent","route","index","_next","path","Route","slice","setParams","old","kids","reset","concat","_join","Promise","res","rej","redirect","confirm","resolve","callEvent","NavigationBlocked","catch","err","then","_this","n","_super","_children","__extends","JetView","ui","container","jetview","createView","render","setParam","parent_1","target","_renderFrameLock","_show","segment","_init_url_data","_urlChange","linkRouter","getRouter","set","silent","_$view","_$","_$url","message","destroy","_destroyKids","plugin","getUrl","tagName","refresh","_render","root","document","body","toNode","cfg","_render_final","response","slot","$$","reject","copyConfig","oldui","parent_2","asWin","setPosition","isVisible","_init","_initUrl","ready","e","_initError","init","waits","frame","wait","all","urlChange","lock","_renderFrame","next","_createSubView","shift","_override","error","createFromURL","uis","_ui","JetViewRaw","cb","SubRouter","a","append","_once","window","version","start","_services","EventSystem","JetAppBase","_subSegment","handler","getSubView","prototype","$subview","addSubView","isArray","Array","method","point","DataCollection","RegExp","Map","Date","copy","$router","srcElement","getAttribute","trigger_1","_forView","trigger","cancelBubble","preventDefault","route_1","parentNode","clickHandler","views","_loadError","Error","hidden","replace","require","module","__esModule","loadView","over","override","dv","get","router","rest","apply","data","bind","er","debug","console","text","innerHTML","type","expire","event","_first_start","top","base","setTimeout","animation","node_1","html","addCss","removeCss","now","urlString","template","uid","_detectPrefix","onpopstate","HashRouter","routes","compare","history","pushState","prefix","sufix","_getRaw","routerPrefix","location","href","isPatched","patch","w","win","promise","freeze","some","$freeze","resize","baseAdd","baselayout","addView","baseRemove","removeView","jview_1","subs_1","arguments","subs","layout","protoUI","$init","$app","$ready","proxy","JetApp","UrlRouter","pathname","search","_$config","EmptyRouter","has","store","Object","hasOwnProperty","call","forEach","context","warn","x","String","russianPluralGroups","end","pluralTypes","arabic","lastTwo","bosnian_serbian","chinese","croatian","french","german","russian","lithuanian","czech","polish","icelandic","slovenian","pluralTypeToLanguages","pluralTypeName","locale","ret","langToPluralType","langs","lang","en","escape","token","dollarRegex","defaultTokenRegex","transformPhrase","phrase","substitutions","tokenRegex","TypeError","interpolationRegex","options","smart_count","texts","count","pluralTypeIndex","expression","argument","Polyglot","opts","phrases","currentLocale","allowMissing","onMissingKey","suffix","RangeError","constructTokenRegex","interpolation","newLocale","morePhrases","prefixedKey","unset","clear","newPhrases","t","_","webixPolyglot","plugins","_view","storage","setLangData","pconfig","polyglot","poly","service","put","locName","i18n","setLocale","setLang","getLang","setService","once","setSize","appView","appWidth","$width","appHeight","$height","_fillApp","define","width","height","left","setHandlers","$destructed","$view","enable","resizeEv","link","source","defineProperty","createState","handlers","out","observe","mask","undefined","queue","waitInQueue","notify","meta","list","keys","enumerable","configurable","values_1","sconfig","nested","reactive","$extend","val","valueOf","reportError","rtc","sendSignal","rtcConfig","node","iceServers","urls","username","credential","conn","RTCPeerConnection","action","onicecandidate","ev","candidate","ontrack","onnegotiationneeded","createOffer","offer","setLocalDescription","localDescription","oniceconnectionstatechange","iceConnectionState","onicegatheringstatechange","signalingState","final","onremovetrack","onremovestream","onsignalingstatechange","close","mediaValues","audio","echoCancellation","noiseSuppression","video","facingMode","mode","emode","restart","restartIce","status","remoteDescription","kind","defer","tracks","getSenders","map","track","reduce","p","c","filter","enabled","onOffer","msg","desc","RTCSessionDescription","setRemoteDescription","createAnswer","answer","onAnswer","upgrade","navigator","mediaDevices","getUserMedia","_a","local","getTracks","addTrack","alert","handleGetUserMediaError","onCandidate","RTCIceCandidate","addIceCandidate","setStream","nodes","tag","stream","MediaStream","srcObject","CallPanel","time","Helpers","getService","Back","callStatuses","State","LocalState","remoteVideo","remoteAudio","Initiator","callUsers","user","callStatus","AfterRefresh","users","_users","rows","css","animate","borderless","cells","GetAudioConfig","GetVideoConfig","minHeight","gravity","avatar","getItem","GetActionsConfig","localVideo","querySelector","localAvatar","on","pubsub","JSON","Phone","UpdateCallTime","$changes","HandleCallStatusChange","ShowVideo","batch","normalizeTime","cols","click","AcceptCall","RejectCall","Start","EndCall","icon","SetFullscreen","fullscreen","offIcon","onIcon","EnableVideo","EnableAudio","actions","showBatch","exit","head","isAfterRefresh","ControlVisibility","InitPhone","isInitiator","alist","querySelectorAll","vlist","role","baseConn","remote","stop","removeAttribute","getReceivers","active","finally","phone","SendSignal","v","updateCall","callId","payload","stringify","signalCall","toggle","setValue","visibility","style","display","CheckVideoVisibility","FormView","helpers","padding","margin","elementsConfig","labelWidth","labelAlign","elements","align","formAvatar","onClick","webix_chat_avatar","fileDialog","inputAlign","placeholder","onChange","NameChangedHandler","onTimedKeyPress","getValue","chat","setValues","upload","getUploader","UpdateAvatar","delay","focus","file","reader_1","FileReader","onload","SetLocalAvatar","readAsDataURL","AvatarChangedHandler","values","form","datafilter","umMasterCheckox","master","onclick","checked","className","each","columnId","masterCheckbox","PeopleView","selectedList","scroll","material","skin","$name","env","scrollSize","visibleBatch","rowHeight","headerRowHeight","Math","max","$active","barHeight","columns","GetColumns","scheme","$sort","by","dir","checkboxRefresh","onItemClick","Toggle","row","onCustomSave","UpdatePeopleList","table","Users","UsersStore","clearAll","serialize","sort","b","SortUsers","LoadPeopleList","sync","header","content","colspan","prepare","toLowerCase","GetCompare","cssFormat","selected","checkedIcon","notCheckedIcon","listAvatar","fillspace","searchValue","peopleList","ai","bi","item","updateItem","GetSelected","SetBatch","GetPeopleList","setHTML","GetSelectedIds","ids","users_1","Toolbar","toolbarHeight","state","toolbar","ButtonFactory","hotkey","inputHeight","cursor","label","BaseWindow","updateConfig","chats","messageId","group","direct_id","stages","Close","Save","ops","getValues","updateChat","$batch","FormBaseView","NewChatWin","LeaveChat","title","ok","cancel","leaveChat","ChatInfo","ShowAll","MemberListMaxCount","CanAddUsers","chatAvatar","membersList","autoheight","ListTemplate","webix_chat_list_item_delete","DeleteMemberClickHandler","addMembersButton","leaveChatButton","webix_chat_show_all_btn","ShowAllMembers","inputWidth","InitMembersList","Filter","members","Sort","youText","DeleteButtonTemplate","hide","MemberListCount","isDirect","groupMember","setUsers","PeopleBaseView","nextButton","disabled","ShowNextPage","disable","addGroupChat","cid","ListView","select","common","ApplySearchValue","SyncHandler","ShowChat","getState","Find","EscapedSearchText","EscapeRegExp","SearchCompare","getSelectedId","chatsView","limited","InitSelf","waitData","Select","unselectAll","emojis","Emojis","addTextMark","date","dateChatFormat","unread_count","message_type","replaceEmoji","$cssName","on_click","webix_input_icon","closeIcon","getInputNode","hideCloseIcon","setIcon","getElementsByClassName","showCloseIcon","defaults","SideBar","bottomOffset","ShowPanel","SideMenu","position","Parent","Show","updatePos","getBoundingClientRect","EmojiTemplate","bottom","right","CategoryMenuTemplate","ShowCategory","preventEvent","categories","layoutMargin","GetLists","mobile","Preview","ScrollHandler","_searchClickEvent","ShowSearchHeader","_backClickEvent","HideSearchHeader","getBody","getChildViews","sum","heights","_scrollEvent","y","scrollTop","emoji","category","ListConfig","basicEmojis","xCount","onMouseMove","ShowPreview","mouseEventDelay","ItemTemplate","unified","PreviewTemplate","findName","shortNameToTitle","find","names","includes","categoryId","findIndex","layoutId","showView","eventRemove","Master","EmojiSuggest","symbol","maxHeight","SuggestTemplate","FilterText","getItemText","Text","setValueHere","details","Popup","getList","BeforeFilterHandler","_keyEvent","KeyCode","keyCode","capture","inp","len","setSelectionRange","_lastCursorPosition","ShowHandler","getFirstId","linkInput","getSelectionRange","substring","lastIndexOf","match","LastFilterFail","Compact","Limited","TitleTemplate","webix_chat_title","ChatInfoHandler","tooltip","StartCallHandler","NewMembersHandler","ToggleMenu","chatId","Refresh","InitMenu","userId","calls","ToolbarMenu","autowidth","GetMenuData","ChatFormConfig","ChatListConfig","comments","h","inactiveHeight","texthighlight","MessagesView","Upload","UploadDelay","WithReactions","reactions","sendAction","currentUser","image","listItem","templateText","MessageTemplateText","templateLinks","MessageTemplateLink","templateMenu","MessageTemplateMenu","templateUser","MessageTemplateUser","templateAvatar","MessageTemplateAvatar","templateDate","MessageTemplateDate","files","conf","FormConfig","Comments","List","Local","serverEvents","Ops","getUsers","chat_id","userId_1","formatted","AddMessage","ScrollToBottom","addChat","IsUsersMessage","removeMessage","updateMessage","FilterUsers","pack","op","origin","exists","changeId","add","remove","LoadChat","InitUploader","getMenu","ShowMenuHandler","AddImageHandler","InitEmojis","user_id","msgId","reaction","addMessage","showItem","getLastId","Uploader","messages","resetCounter","Focus","FileLinkTemplate","outgoing","arrow","callMessages","ReactionsTemplate","size","FileNameTemplate","FormatBytes","preview","ImageErrorHandler","trg","s","withReactions","readonly","textarea","button","icons","ListUploadTemplate","listItemHeight","webix_icon","StopUpload","UploadIconTemplate","uploader","addDropZone","percent","xhr","addEventListener","getItemNode","UploadHandler","stopUpload","bytes","sizes","floor","log","parseFloat","pow","toFixed","menu","getContext","disableItem","enableItem","_emojiEvent","activeId","EmojiPopup","ReactionsMode","ReactionsActiveId","ShowEmojis","emojiStr","EmojiNameTemplate","AddReaction","Hide","PasteEmoji","LinkInput","caretPos","selectionEnd","oldVal","str1","str2","addReaction","GetReactionsList","name_1","r","reactedTooltipTemplate","webix_chat_reaction","ShowReactionsPopup","webix_chat_reaction_add","webix_chat_reaction_block","ReactionClickHandler","IsUsersReaction","removeReaction","parseInt","intId","isNaN","TopView","sizeTrigger","_compactValue","_compactHandler","_app","_forceCompact","forceCompact","_compactWidth","compactWidth","_checkTrigger","$setSize","isSingle","fCompact","isUndefined","SetCompactMode","ShowDefaultChat","ShowSidebar","ShowChatWindow","ShowChatInfo","ShowNewMembersWindow","StartCall","back","timer","callInfo","info","CallTimer","devices","device","callChatId","clearInterval","chatType","removed","startCall","setInterval","UsersView","m0","m1","m2","m3","m4","m5","m6","m7","m8","m9","m10","m11","m12","m13","m14","m15","m16","m17","m18","m19","m20","m21","_messages","d","u","_chats","$change","as","back_1","getIndexById","moveTop","backs","_url","_token","_mode","_seed","_queue","api","Accept","Content-Type","Remote-Token","credentials","headers","fetch","json","e_1","e_2","s_1","t_1","_wrapper","connect","_socket","onclose","protocol","host","o","WebSocket","onmessage","fire","_send","_resubscribe","onError","_uid","args","onCall","send","e_3","t_2","t_3","e_4","onResponse","splice","t_4","t_6","t_5","t_7","Client","_ready","load","_api","_pubsub","detach","accept","drop","ignore","lost","900","901","902","Backend","AddDirect","GetAll","Add","Remove","Update","ResetCounter","AddGroup","Leave","SetUsers","withUser","chatID","SetStatus","Signal","RemoveReaction","_local","_back","Operations","_getMessageText","limit","arr","emojiRegExp","min","leave","initUploader","maxFileSize","apiOnly","autosend","onBeforeFileAdd","configUpload","props","_chat","fileUploadUrl","avatarUploadUrl","urlData","statusMap","1","2","3","4","dateMask","weekMask","todayDateMask","cssClass","initials","pop","toUpperCase","today","datePart","day","equal","dateToStr","deleteIcon","groupUsers","seconds","sec","buildNameMap","_emojis","emData","getEmojiData","matches","emojiNameMap","_basicEmojis","findEmojiByName","em","_categories","compaсt","compact","appId","dynamic","appNode","addStyle","firstShow","defaultHandler","onShow","use","App","locales","jetapp","services","Add members","Are you sure to leave this chat?","Avatar","Are you sure to delete this member?","Cancel","Change avatar","Chat info","Chat name","Chats","Create group","Delete","Delete member","Edit chat","Leave chat","member","Members","New chat","No people to add","People","Search","Show all members","You","Ringing","Active call","Is calling you","Reject","Start call","Join call","End call","Ended call","Incoming call","Outgoing call","Rejected call","Missed call","Can't start the call","Could not find your","Error opening your","microphone","camera","Size","B","KB","MB","GB","File size exceeds the limit","File upload error","Smileys & People","Animals & Nature","Activity","Travel & Places","Food & Drink","Objects","Search results","Symbols","Basic"],"mappings":"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"}